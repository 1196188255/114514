{"version":3,"sources":["i18n.ts","Common/utils.ts","MappingScope/EditMap.ts","MappingScope/MapActions/AtomActions/types.ts","MappingScope/MapActions/AtomActions/SingleFlick.ts","MappingScope/MapActions/AtomActions/Slide.ts","MappingScope/MapActions/AtomActions/SlideNote.ts","MappingScope/MapActions/AtomActions/Timepoint.ts","MappingScope/MapActions/AtomHistory.ts","MappingScope/MapActions/CommonActions.ts","MappingScope/MapActions/MapAtionsBase.ts","MappingScope/MapActions/MapActions.ts","MappingScope/Meta.ts","MappingScope/Settings.ts","MappingScope/scope.ts","Common/AudioCtx/GlobalCtx.ts","Common/AudioCtx/MyEvent.ts","Common/AudioCtx/AudioSource.ts","Common/AudioCtx/AudioInstance.ts","Common/AudioCtx/AudioElInstance.ts","Common/AudioCtx/index.ts","MappingPage/states.ts","MappingPage/Components/BackgroundImage.tsx","MappingPage/theme.ts","MappingPage/Pages/MetaPage/CopyDialog.tsx","Common/Components/GlobalSnackbar.tsx","MapFormats/bestdori.ts","MappingPage/Pages/MetaPage/ConfirmDialog.tsx","MapFormats/bbbv1.ts","MappingPage/Pages/MetaPage/Actions.tsx","Common/Components/FileField.tsx","MappingPage/Pages/MetaPage/Inputs.tsx","MappingPage/Pages/MetaPage/index.tsx","MappingPage/Pages/TimingPage/sharedState.ts","MappingPage/Pages/TimingPage/LeftPanel.tsx","MappingPage/assets.ts","Common/hooks.ts","Common/animation.ts","MappingPage/Pages/TimingPage/RightPanel/ActionPart.tsx","MappingPage/Pages/TimingPage/RightPanel/TimingPad.tsx","MappingPage/Pages/TimingPage/RightPanel/MeasureBtn.tsx","Common/Components/NumberField.tsx","MappingPage/Pages/TimingPage/RightPanel/EditPart.tsx","MappingPage/Pages/TimingPage/RightPanel/index.tsx","MappingPage/Pages/TimingPage/index.tsx","MappingPage/Pages/SettingsPage/index.tsx","MappingPage/Pages/MappingPage/sharedState.ts","MappingPage/Pages/MappingPage/Tools.tsx","MappingPage/Pages/MappingPage/Track/styles.ts","MappingPage/Pages/MappingPage/Track/state.ts","MappingPage/Pages/MappingPage/Track/SVGs.tsx","MappingPage/Pages/MappingPage/Track/ActionPreview.tsx","MappingPage/Pages/MappingPage/Track/GridLayer.tsx","MappingPage/Pages/MappingPage/Track/NotesLayer.tsx","MappingPage/Pages/MappingPage/Track/ProgressLine.tsx","MappingPage/Pages/MappingPage/Track/InfoWindow.tsx","MappingPage/Pages/MappingPage/Track/BarLayer.tsx","MappingPage/Pages/MappingPage/Track/WarningLayer.tsx","Common/binarySearch.ts","MappingPage/Pages/MappingPage/Track/index.tsx","MappingPage/Pages/MappingPage/ScrollBar/drawCanvas.ts","MappingPage/Pages/MappingPage/ScrollBar/state.ts","MappingPage/Pages/MappingPage/ScrollBar/ProgressLine.tsx","MappingPage/Pages/MappingPage/ScrollBar/CanvasBar.tsx","MappingPage/Pages/MappingPage/ScrollBar/ViewPort.tsx","MappingPage/Pages/MappingPage/ScrollBar/index.tsx","MappingPage/Pages/MappingPage/soundEffect.ts","MappingPage/Pages/MappingPage/index.tsx","MappingPage/Pages/ToolsPage/BpmCalculator/index.tsx","MappingPage/Pages/ToolsPage/index.tsx","MappingPage/routes.tsx","MappingPage/Components/MainContent.tsx","GamePage/gamestate.ts","MappingPage/Components/HeaderBar.tsx","MappingPage/Components/FooterBar/ProgressBar.tsx","MappingPage/Components/FooterBar/Tools.tsx","MappingPage/Components/FooterBar/index.tsx","MappingPage/index.tsx","GamePage/index.tsx","MapFormats/bbbgame.ts","App.tsx","serviceWorker.ts","index.tsx"],"names":["missingKeys","Set","i18n","use","LanguageDetector","Backend","initReactI18next","init","fallbackLng","debug","nsSeparator","interpolation","escapeValue","backend","loadPath","process","react","useSuspense","saveMissing","missingKeyHandler","lngs","ns","key","add","global","window","RunIntoNeverError","Error","neverHappen","message","assert","v","undefined","randomId","Math","random","isObject","item","shallowPatch","obj","p","prev","changed","k","deepPatch","_deepPatch","changes","entryList","map","list","e","entries","push","itemList","_set","i","TimeToString","s","milis","minutes","seconds","toString","substr","once","fn","res","called","range","from","to","step","openFile","accept","Promise","rej","input","document","createElement","type","onchange","f","files","reader","FileReader","onload","result","onerror","readAsText","oncancel","click","EditMap","constructor","this","timepoints","slides","notes","Map","forJson","x","forEach","ticktimecache","realtimecache","JSON","stringify","json","parse","id","some","n","has","slide","timepoint","FreshTimepointCache","FreshNoteCache","observable","tp","bpm","get","time","offset","ResortSlide","hasEqual","sorted","slice","sort","a","b","lane","note","set","del","delete","setv","patch","SingleFlickActions","Add","Remove","flickend","length","SlideActions","filter","SlideNoteActions","bpb","newtp","TimepointActions","AtomHistory","state","act_done","act_todo","act_undo","callAtom","args","act","undoAtom","un","pop","redoAtom","doTransaction","startLen","doParallel","CommonActions","action","bound","history","changeListeners","listener","done","computed","MapActionsBase","findTimepoint","ignore","tps","timepointlist","tpindex","calcNearestPosition","division","tickcount","round","realtime","rtp","rtpindex","timepointIndex","patchNote","justifyFollowChanged","deleteOne","justifyFindNearest","deleteSlideNote","n1","n2","deleteMany","MapActions","addTimepoint","justifydivision","notelist","moveTimepoint","timechanged","removeTimepoint","size","addSingle","toggleFlick","addSlide","tp1","off1","lane1","tp2","off2","lane2","sid","toggleFlickend","addSlideMid","moveMany","timeoffset","min","max","laneoffset","targetTime","targetLane","copyMany","slideidmap","slideNoteCount","slideid","parseInt","removeNotes","DefaultMeta","name","DefaultSettings","general","song_volume","effect_volume","background_dim","editor","keep_pitch","justify_find_nearest","justify_grid_divisor","show_info_window","warn_for_same_pos_notes","autosave_interval","game","skin","judge_offset","visual_offset","speed","resolution","note_scale","bar_opaciry","show_sim_line","lane_effect","mirror","beat_note","StorageNames","scope","save","toJsonString","localStorage","setItem","lastSave","Date","reset","ResetState","create","getItem","editmap","fromJson","error","removeItem","console","meta","autorun","settings","setTimeout","now","getTime","timeout","AudioContext","webkitAudioContext","globalctx","_ctx","_output","createGain","connect","destination","currentTime","baseLatency","outputLatency","gain","MyEvent","listeners","dispatch","l","dispose","clear","AudioSource","buffer","onloaderr","load","ctx","sqrt","value","duration","getsource","err","data","Blob","onabort","ArrayBuffer","readAsArrayBuffer","decodeAudioData","src","Function","then","catch","AudioInstance","source","node","_playing","_starttime","_startpos","_playbackrate","onplay","onpause","onseek","onend","callstart","delay","startt","start","playedtime","handleNormalEnd","createnode","handlePauseEnd","position","handleSeekEnd","onended","createBufferSource","playbackRate","play","stop","pause","seek","setRate","rate","currentpos","AudioElInstance","_loaded","el","oncanplaythrough","preservesPitch","URL","createObjectURL","volume","async","loadFromUrl","url","fetch","arrayBuffer","Background","Music","musicfile","file","m","audio","playing","seekcounter","instance","playbackrate","remaintime","toggle","useStyles","makeStyles","theme","background","zIndex","top","left","right","bottom","backgroundPosition","backgroundRepeat","transition","backgroundSize","BackgroundImage","cn","useObserver","Box","className","style","backgroundImage","opacity","createMuiTheme","palette","primary","main","blue","contrastText","secondary","red","default","overrides","MuiButton","root","textTransform","MuiTab","minWidth","MuiSnackbarContent","color","MuiTableRow","MuiDivider","height","backgroundColor","paper","width","dialog","open","content","title","copy","openDialog","navigator","clipboard","writeText","onfocus","target","select","CopyDialog","t","useTranslation","Dialog","onClose","classes","DialogTitle","DialogContent","TextField","autoFocus","onFocus","fullWidth","multiline","rowsMax","variant","DialogActions","Button","onClick","variantIcon","success","CheckCircleIcon","warning","WarningIcon","ErrorIcon","info","InfoIcon","Message","lightGreen","lightBlue","orange","icon","fontSize","iconVariant","marginRight","spacing","display","alignItems","userMessage","handleClose","event","reason","GlobalSnackbar","Icon","Snackbar","anchorOrigin","vertical","horizontal","autoHideDuration","SnackbarContent","clsx","IconButton","aria-label","properBpmForSpan","preferred","beattime","beats","beatcount","d","toBestdoriFormat","tpsPut","dt","bdmap","lasttp","tpbasebeat","beat","inote","lastnotebeat","bdslides","lasttime","flick","sl","connections","bdn","beatA","beatB","strb","join","format","confirm","openConfirm","ConfirmDialog","DialogContentText","getTimepoint","items","parseFloat","getPos","parts","split","getSingle","getFlick","getSlideNotes","importBBBv1","lines","trim","line","fromBBBv1Format","exportBestdori","exportEditorMap","href","download","body","appendChild","removeChild","revokeObjectURL","downLoadFile","importEditorMap","uploading","upload","onProcess","axios","require","fileObj","FormData","append","uploadMusicResult","post","headers","uploadChartResult","params","encodeURI","Actions","uploadAyaTitle","setUploadAyaTitle","React","useState","uploadingAya","setUploadingAya","Grid","margin","container","direction","disabled","bgm","filename","FileField","forwardRef","props","ref","onFileSelected","inputProps","multiple","others","setDisplay","handleChange","useCallback","onSelected","fs","Array","useMemo","FileFieldWrapper","children","xs","MapName","label","onChange","musicfilename","selectM","SelectMusic","backgroundfilename","selectBg","SelectBackground","Inputs","panel","maxWidth","Links","Typography","align","Link","rel","Update","update","fontWeight","fontFamily","fontStyle","textAlign","MetaPage","TimingState","selected","muteticker","measuring","autoswitchtp","reaction","table","maxHeight","overflow","tablerow","cursor","TimepointTable","Table","TableHead","TableRow","TableCell","TableBody","hover","removeTp","RemoveBtn","LeftPanel","sm","assets","note_flick","note_long","note_normal","note_slide_among","timing_tack","timing_tick","perfect","long","createAnimLoop","unmounted","cancel","loop","requestAnimationFrame","addHotkey","handler","hotkey","unbind","Calibration","counter","stopAnimation","prop","unit","getComputedStyle","startAnimation","setInterval","addtp","settp","ActionPart","wrap","marginTop","FormControlLabel","marginLeft","control","Switch","checked","labelPlacement","padding","transform","flexGrow","border","borderRadius","borderColor","willChange","sounds","tick","tack","nosounduntil","lastbeat","animloop","pads","pos","currentBeat","floor","beatoff","beatnum","realbeattime","deltabeat","nexttimems","timeoutms","soundtime","performance","setsound","TimingPad","useRef","padcount","useEffect","current","firstChild","calcMeasureRaw","taps","sum","timeoutId","startMeasure","setLen","recalc","processed","last","calcMeasure","clearTimeout","MeasureBtn","disableRipple","count","NumberField","number","validator","test","numberDisplay","onNumberChange","onBlur","userBlur","userChange","propNumberDisplay","valid","setValid","isNaN","movebeat","secondFromString","cindex","indexOf","EditPart","InputProps","endAdornment","InputAdornment","DelayNotice","RightPanel","timing","TimingPage","SliderWrapper","component","FormLabel","SwitchWrapper","General","Slider","valueLabelDisplay","FormControl","InputLabel","Select","language","changeLanguage","MenuItem","changeKeepPitch","Editor","date","getHours","getMinutes","getSeconds","Game","SettingsPage","Divider","NoteSig","MappingState","timeHeightFactor","viewOffset","slidelist","sig","getViewposition","tracking","_viewposition","setViewposition","GridD1","endtime","bar","innerbeat","tools","flexShrink","overflowX","overflowY","toolimg","zoomin","zoomout","SelectTool","tool","my","Tooltip","placement","RadioGroup","Radio","alt","SelectDivisor","ZoomInOut","getElementById","ctrlKey","stopPropagation","preventDefault","deltaY","addEventListener","removeEventListener","OtherTools","Tools","track","layer","pointerEvents","useNoteStyles","minHeight","noevent","slidebar","selection","panelRef","getBoundingClientRect","pointerClientY","rect","pointerClientX","laneFromLeftPercent","pointerLeftPercent","pointerTime","draggingNote","selectedNotes","percent","getSelectedNotes","nid","selectingNotes","slideNote1Beat","useMirror","Cross","viewBox","stroke","strokeWidth","fill","Rect","createStyle","PointerPos","selecting","pointerLane","pointerBeat","SlideNote1","slideNote1Lane","DragOneNote","SelectedNotes","Selection","l1","selectingStartLeft","l2","t1","selectingStartTime","t2","abs","ActionPreview","vertline","borderLeft","beatline1","borderBottom","subline","beatline2","beatline3","beatline4","bottomstyle","vertlines","LaneAndTime","DivisorLines","index","GridD2","beat_3","GridD3","beat_2","GridD4","TimepointStart","GridLayer","useLayerStyle","dragPointer","downEventHandler","buttons","button","changedTouches","identifier","handleUp","draggingSelected","dl","before","preventClick","removeNote","Note","onMouseDown","onContextMenu","contextMenuHandler","onDoubleClick","doubleClickHandler","clickEventHandler","draggable","NotesLayer","progress","transY","viewTime","transpx","ProgressLine","div","userSelect","InfoWindow","gcd","c","calcGCD","divide","Bar","layerWidth","dh","dw","atan2","clickHandler","BarLayer","setLayerWidth","clientWidth","cb","forEachBar","WaringRect","noteid","WarningLayer","samePosNotes","binarySearch","listlen","r","handleScroll","flushPointerPos","clientX","clientY","touches","reduce","selectPointer","handleDown","activeElement","blur","stopSelect","handleMove","noteListOrdered","end","handleClick","nativeEvent","Track","paddedDuration","viewduration","onWheel","getX","getY","drawLine","xfrom","xto","y","beginPath","moveTo","lineTo","drawBar","fromx","fromy","tox","toy","drawDiamond","drawOval","arcTo","drawCircle","ellipse","PI","progressTransY","playtime","barTransY","viewtime","barHeight","containerHeight","viewTransY","h","canvas","getContext","timelist","clearRect","font","lineWidth","strokeStyle","fillStyle","fillText","drawScrollBar","drawWarning","Canvas","handelMouseTouch","currentTarget","viewportheight","CanvasBar","onTouchStart","viewport","touchState","offsetY","handelMouseTouchStart","parentElement","TimeYtoBottom","ViewPort","scrollbar","ScrollBar","clientHeight","images","blob","noSoundUntil","soundlist","toBeStopped","au","justifyContent","MappingPage","BpmCalculator","setBpm","setOffset","insert","setInsert","remove","setRemove","updateResult","accurateFloat","num","precision","toPrecision","secondPerBeat","up","ceil","down","toFixed","md","routes","router","path","location","hash","useHashRoutes","ContentComponent","wrapping","MainContent","Component","Fade","in","statelistener","startGame","pushState","tabs","HeaderTabs","Tabs","indicatorColor","NavigateTo","Object","keys","Tab","SaveIcon","noticed","setNoticed","lastsave","HeaderActions","Undo","Redo","actionlist1","canUndo","canRedo","actionlist2","HeaderBar","flex","center","midline","TimepointLines","PlayTime","innerText","handleMouse","pageX","offsetLeft","handleTouch","ProgressBar","onMouseMove","onTouchMove","loaded","ml","mr","marks","FooterBar","flexDirection","ThemeProvider","CssBaseline","GamePage","back","musicSrc","judgeOffset","visualOffset","noteScale","barOpacity","backgroundDim","effectVolume","showSimLine","laneEffect","beatNote","backgroundSrc","songName","sound","mapContent","slideIdIndex","onbeat","toGameContent","ondestroyed","App","gtag","setHash","useGameState","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","log","postMessage","onUpdate","onSuccess","ev","ReactDOM","render","origin","response","contentType","status","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.e6f5bf71.chunk.js","sourcesContent":["import i18n from \"i18next\"\r\nimport { initReactI18next } from \"react-i18next\"\r\nimport Backend from 'i18next-xhr-backend'\r\nimport LanguageDetector from 'i18next-browser-languagedetector'\r\n\r\nconst missingKeys = new Set<string>()\r\n\r\ni18n\r\n  .use(LanguageDetector)\r\n  .use(Backend)\r\n  .use(initReactI18next)\r\n  .init({\r\n    fallbackLng: 'en',\r\n    debug: false,//process.env.NODE_ENV === \"development\",\r\n\r\n    nsSeparator: \"::\",\r\n\r\n    interpolation: {\r\n      escapeValue: false\r\n    },\r\n\r\n    backend: {\r\n      loadPath: process.env.PUBLIC_URL + '/locales/{{lng}}.json',\r\n    },\r\n\r\n    react: {\r\n      useSuspense: false\r\n    },\r\n\r\n    saveMissing: true,\r\n    missingKeyHandler: function (lngs, ns, key) {\r\n      missingKeys.add(key)\r\n    }\r\n  })\r\n\r\nconst global = window as any\r\nglobal.i18n = i18n\r\nglobal.missingKeys = missingKeys\r\n\r\nexport default i18n\r\n","import { scope } from \"../MappingScope/scope\"\r\n\r\nexport class RunIntoNeverError extends Error { }\r\n\r\n/**\r\n * Describes a case will never happen  \r\n * throws a {@link RunIntoNeverError}  \r\n * @param message error message if happen\r\n */\r\nexport function neverHappen(message = \"Ran into never happen\"): never {\r\n  throw new RunIntoNeverError(message)\r\n}\r\n\r\n/**\r\n * gard value by a default value  \r\n */\r\nexport function gard<T>(v: T | null | undefined, d: T) {\r\n  return v === null || v === undefined ? d : v\r\n}\r\n\r\n/**\r\n * type gard for null | undefined assertion\r\n */\r\nexport function assert<T>(v: T): NonNullable<T> {\r\n  if (v === null || v === undefined) neverHappen(\"Assertion for not null or undefined fail\")\r\n  return v as NonNullable<T>\r\n}\r\n\r\n/**\r\n * generate a random positive int number\r\n */\r\nexport function randomId() {\r\n  return Math.random() * 0x80000000 | 0\r\n}\r\n\r\n/**\r\n * linear interpolation\r\n */\r\nexport function lerp(start: number, end: number, target: number, from: number, to: number) {\r\n  const r = (target - start) / (end - start)\r\n  return (to - from) * r + from\r\n}\r\n\r\nfunction isObject(item: any): item is object {\r\n  return (item && typeof item === 'object'/* && !Array.isArray(item) */)\r\n}\r\n\r\nfunction _patch(obj: any, p: any): any {\r\n  const prev: any = {}\r\n  let changed = false\r\n  for (const k in p) {\r\n    if (p[k] !== undefined) {\r\n      if (obj[k] !== p[k]) {\r\n        prev[k] = obj[k]\r\n        obj[k] = p[k]\r\n        changed = true\r\n      }\r\n    } else {\r\n      delete obj[k]\r\n    }\r\n  }\r\n  if (changed) return prev\r\n}\r\n\r\nfunction _deepPatch(obj: any, p: any): any {\r\n  if (!isObject(obj) && !isObject(p)) return\r\n  const prev: any = {}\r\n  let changed = false\r\n  for (const k in p) {\r\n    if (p[k] !== undefined) {\r\n      if (isObject(p[k]) && isObject(obj[k])) {\r\n        const changes = _deepPatch(obj[k], p[k])\r\n        if (changes) {\r\n          prev[k] = changes\r\n          changed = true\r\n        }\r\n      } else if (obj[k] !== p[k]) {\r\n        prev[k] = obj[k]\r\n        obj[k] = p[k]\r\n        changed = true\r\n      }\r\n    } else {\r\n      delete obj[k]\r\n    }\r\n  }\r\n  if (changed) return prev\r\n}\r\n\r\n/**\r\n * patch the object by another object  \r\n *  - shallow patch\r\n *  - iterable property only\r\n *  - ignores undefined patch property\r\n * @param obj - the object to patch\r\n * @param p   - the patch object\r\n * @returns previous value of changed items if any change applied, else undefined\r\n */\r\nexport const shallowPatch = _patch as <T extends {}, R extends Partial<T>>(obj: T, p: R) => Partial<R> | undefined\r\n\r\n/**\r\n * patch the object by another object \r\n *  - deep patch \r\n *  - iterable property only\r\n *  - ignores undefined patch property\r\n * @param obj - the object to patch\r\n * @param p   - the patch object\r\n * @returns previous value of changed items if any change applied, else undefined\r\n */\r\nexport const deepPatch = _deepPatch as <T extends {}, R extends Partial<T>>(obj: T, p: R) => Partial<R> | undefined\r\n\r\n/**\r\n * convert a map to entry list\r\n * @param map - the map to convert\r\n */\r\nexport function entryList<K, V>(map: Map<K, V> | DeepReadonly<Map<K, V>>) {\r\n  const list: [K, V][] = []\r\n  for (const e of map.entries()) {\r\n    list.push(e)\r\n  }\r\n  return list\r\n}\r\n\r\nexport function itemList<T>(_set: Set<T> | DeepReadonly<Set<T>>) {\r\n  const list: T[] = []\r\n  for (const i of _set.entries()) {\r\n    list.push(i[0])\r\n  }\r\n  return list\r\n}\r\n\r\nexport function TimeToString(s: number): string {\r\n  if (s < 0) return \"-\" + TimeToString(-s)\r\n  let milis = (s * 1000 + 0.5) | 0\r\n  let minutes = (milis / 60000) | 0\r\n  milis = (milis % 60000) | 0\r\n  minutes = (minutes + 100) | 0\r\n  let seconds = (milis / 1000) | 0\r\n  milis = (milis % 1000) | 0\r\n  seconds = (seconds + 100) | 0\r\n  milis = (milis + 1000) | 0\r\n  return minutes.toString().substr(1) + \":\" + seconds.toString().substr(1) + \".\" + milis.toString().substr(1)\r\n}\r\n\r\nexport function once<T>(fn: () => T) {\r\n  let res: T\r\n  let called = false\r\n  return function () {\r\n    if (!called) {\r\n      called = true\r\n      res = fn()\r\n    }\r\n    return res\r\n  }\r\n}\r\n\r\nexport function range(from: number, to?: number, step?: number) {\r\n  if (step === undefined) {\r\n    step = 1\r\n  }\r\n  if (to === undefined) {\r\n    to = from\r\n    from = 0\r\n  }\r\n  const res: number[] = []\r\n  while ((to - from) * step > 0) {\r\n    res.push(from)\r\n    from += step\r\n  }\r\n  return res\r\n}\r\n\r\nexport function downLoadFile(content: string | Blob) {\r\n  if (typeof content === \"string\")\r\n    content = new Blob([content])\r\n  const url = URL.createObjectURL(content)\r\n  const a = document.createElement(\"a\")\r\n  a.style.display = \"none\"\r\n  a.href = url\r\n  a.download = (scope.meta.name || \"No title\") + \" - bbbEditor.json\"\r\n  document.body.appendChild(a)\r\n  a.click()\r\n  document.body.removeChild(a)\r\n  URL.revokeObjectURL(url)\r\n}\r\n\r\nexport function openFile(accept: string) {\r\n  return new Promise<string>((res, rej) => {\r\n    const input = document.createElement(\"input\")\r\n    input.type = \"file\"\r\n    input.accept = accept\r\n    input.onchange = e => {\r\n      let f: File | null\r\n      if (input.files && (f = input.files.item(0))) {\r\n        const reader = new FileReader()\r\n        reader.onload = e => res(reader.result as string)\r\n        reader.onerror = e => rej(e)\r\n        reader.readAsText(f)\r\n      } else {\r\n        rej()\r\n      }\r\n    }\r\n    input.oncancel = e => rej()\r\n    input.click()\r\n  })\r\n}","import { neverHappen, assert, entryList } from \"../Common/utils\"\r\nimport { observable } from \"mobx\"\r\n\r\nexport type WithId = {\r\n  id: number\r\n}\r\n\r\nexport type TimedPosition = {\r\n  /**\r\n   * id of timepoint to measure time in gamemap\r\n   */\r\n  timepoint: number\r\n\r\n  /**\r\n   * the count of 1/48 beats from that timepoint\r\n   */\r\n  offset: number\r\n\r\n  /**\r\n   * the lane that the note lays on (left most: 0, right most: 6)\r\n   */\r\n  lane: number\r\n\r\n  /**\r\n   * the cached real time\r\n   * won't be update if timepoint changed\r\n   */\r\n  realtimecache: number\r\n} & WithId\r\n\r\nexport type SingleNote = {\r\n  type: \"single\"\r\n} & TimedPosition\r\n\r\nexport type FlickNote = {\r\n  type: \"flick\"\r\n} & TimedPosition\r\n\r\nexport type Slide = {\r\n  /**\r\n   * note id from first to last ordered\r\n   */\r\n  notes: number[]\r\n  flickend: boolean\r\n} & WithId\r\n\r\nexport type SlideNote = {\r\n  type: \"slide\"\r\n  /**\r\n   * slide id\r\n   */\r\n  slide: number\r\n} & TimedPosition\r\n\r\nexport type NoteType = SingleNote | FlickNote | SlideNote\r\n\r\nexport type Timepoint = {\r\n  /**\r\n   * the start time of this timepoint in seconds\r\n   */\r\n  time: number\r\n\r\n  /**\r\n   * beats per minute\r\n   */\r\n  bpm: number\r\n\r\n  /**\r\n   * the cached time of 1/48 beat\r\n   */\r\n  ticktimecache: number\r\n\r\n  /**\r\n   * beats per bar (assumes one beat = 1/4)\r\n   */\r\n  bpb: number\r\n} & WithId\r\n\r\ntype EditMapForJson = {\r\n  timepoints: Timepoint[]\r\n  slides: Slide[]\r\n  notes: NoteType[]\r\n}\r\n\r\n\r\nexport class EditMap {\r\n  /**\r\n   * id => timepoint\r\n   */\r\n  @observable timepoints: Map<number, Timepoint>\r\n\r\n  /**\r\n   * id => slide\r\n   */\r\n  @observable slides: Map<number, Slide>\r\n\r\n  /**\r\n   * id => note\r\n   */\r\n  @observable notes: Map<number, NoteType>\r\n\r\n  private constructor(map: EditMap) {\r\n    this.timepoints = map.timepoints\r\n    this.slides = map.slides\r\n    this.notes = map.notes\r\n  }\r\n\r\n  static create(): EditMap {\r\n    return new EditMap({\r\n      timepoints: new Map(),\r\n      slides: new Map(),\r\n      notes: new Map(),\r\n    })\r\n  }\r\n\r\n  static toJsonString(map: DeepReadonly<EditMap>) {\r\n    const { timepoints, slides, notes } = map as EditMap\r\n    const forJson: EditMapForJson = {\r\n      timepoints: entryList(timepoints).map(x => ({ ...x[1] })),\r\n      slides: entryList(slides).map(x => ({ ...x[1] })),\r\n      notes: entryList(notes).map(x => ({ ...x[1] }))\r\n    }\r\n    forJson.timepoints.forEach(x => delete x.ticktimecache)\r\n    forJson.notes.forEach(x => delete x.realtimecache)\r\n    return JSON.stringify(forJson)\r\n  }\r\n\r\n  static fromJson(json: string): EditMap {\r\n    const { timepoints, slides, notes } = JSON.parse(json) as EditMapForJson\r\n    const map: EditMap = {\r\n      timepoints: new Map(timepoints.map(x => [x.id, x])),\r\n      slides: new Map(slides.map(x => [x.id, x])),\r\n      notes: new Map(notes.map(x => [x.id, x])),\r\n    }\r\n    if (slides.some(x => x.notes.some(n => !map.notes.has(n)))) neverHappen()\r\n    if (notes.some(x => x.type === \"slide\" && !map.slides.has(x.slide))) neverHappen()\r\n    if (notes.some(x => !map.timepoints.has(x.timepoint))) neverHappen()\r\n    timepoints.forEach(x => FreshTimepointCache(x))\r\n    notes.forEach(x => FreshNoteCache(map, x))\r\n    return new EditMap(map)\r\n  }\r\n}\r\n\r\nexport function FreshTimepointCache(tp: Timepoint) {\r\n  tp.ticktimecache = 60 / tp.bpm / 48\r\n}\r\n\r\nexport function FreshNoteCache(map: EditMap, n: TimedPosition) {\r\n  const tp = assert(map.timepoints.get(n.timepoint))\r\n  n.realtimecache = tp.time + tp.ticktimecache * n.offset\r\n}\r\n\r\nexport function ResortSlide(map: EditMap, slide: Slide) {\r\n  let hasEqual = false\r\n  const sorted = slide.notes.slice().sort((a, b) => {\r\n    const res = assert(map.notes.get(a)).realtimecache - assert(map.notes.get(b)).realtimecache\r\n    if (res === 0) hasEqual = true\r\n    return res\r\n  })\r\n  slide.notes = sorted\r\n  return hasEqual\r\n}\r\n","\r\nexport type Immutable = (number | string | boolean | null | undefined | bigint | symbol)\r\n\r\ntype Extra = {\r\n  [key: string]: Immutable\r\n}\r\n\r\nexport type ImmutableArgs = (Immutable | Extra)[]\r\n\r\nexport type AtomAction<TState, TArgs extends ImmutableArgs> =\r\n  (state: TState, ...args: TArgs) => undefined | ((state: TState) => void)\r\n\r\nexport const makeAction = <TState, TArgs extends ImmutableArgs>(fn: AtomAction<TState, TArgs>) => fn","import { EditMap, SingleNote, FlickNote, FreshNoteCache } from \"../../EditMap\"\r\nimport { makeAction } from \"./types\"\r\nimport { neverHappen, shallowPatch, assert } from \"../../../Common/utils\"\r\nimport { observable } from \"mobx\"\r\n\r\ntype SingleOrFlick = (SingleNote | FlickNote)\r\n\r\nconst add = (map: EditMap, id: number, type: SingleOrFlick[\"type\"], timepoint: number, offset: number, lane: number) => {\r\n  const note =\r\n    observable({ type: type as \"single\", id, timepoint, offset, lane, realtimecache: 0 }) as SingleOrFlick\r\n\r\n  map.notes.set(note.id, note)\r\n\r\n  FreshNoteCache(map, note)\r\n  return note\r\n}\r\n\r\nconst del = (map: EditMap, id: number) => {\r\n  const note = assert(map.notes.get(id))\r\n  if (note.type !== \"single\" && note.type !== \"flick\") neverHappen()\r\n  \r\n  map.notes.delete(id)\r\n\r\n  return note\r\n}\r\n\r\ntype PatchType = Partial<Pick<SingleOrFlick, \"type\" | \"timepoint\" | \"offset\" | \"lane\">>\r\n\r\nconst setv = (map: EditMap, id: number, patch: PatchType) => {\r\n  const note = assert(map.notes.get(id))\r\n  if (note.type !== \"single\" && note.type !== \"flick\") neverHappen()\r\n  const changes = shallowPatch(note, patch)\r\n  if (changes) {\r\n\r\n    FreshNoteCache(map, note)\r\n    return changes\r\n  }\r\n}\r\n\r\nexport const SingleFlickActions = {\r\n  Add: makeAction((map: EditMap, id: number, type: SingleOrFlick[\"type\"], timepoint: number, offset: number, lane: number) => {\r\n    const res = add(map, id, type, timepoint, offset, lane)\r\n    if (res)\r\n      return (map: EditMap) => del(map, res.id)\r\n  }),\r\n  Remove: makeAction((map: EditMap, id: number) => {\r\n    const res = del(map, id)\r\n    if (res)\r\n      return (map: EditMap) => add(map, res.id, res.type as SingleOrFlick[\"type\"], res.timepoint, res.offset, res.lane)\r\n  }),\r\n  Set: makeAction((map: EditMap, id: number, patch: PatchType) => {\r\n    const res = setv(map, id, patch)\r\n    if (res)\r\n      return (map: EditMap) => setv(map, id, res)\r\n  })\r\n}\r\n","import { EditMap, Slide } from \"../../EditMap\"\r\nimport { assert, neverHappen, shallowPatch } from \"../../../Common/utils\"\r\nimport { makeAction } from \"./types\"\r\nimport { observable } from \"mobx\"\r\n\r\n\r\nconst add = (map: EditMap, id: number, flickend: boolean) => {\r\n  const slide: Slide = observable({\r\n    id, flickend, notes: []\r\n  })\r\n  map.slides.set(id, slide)\r\n\r\n  return slide\r\n}\r\n\r\nconst del = (map: EditMap, id: number) => {\r\n  const s = assert(map.slides.get(id))\r\n  if (s.notes.length > 0) neverHappen()\r\n\r\n  map.slides.delete(id)\r\n\r\n  return s\r\n}\r\n\r\ntype PatchType = Partial<Pick<Slide, \"flickend\">>\r\n\r\nconst set = (map: EditMap, id: number, patch: PatchType) => {\r\n  const s = assert(map.slides.get(id))\r\n  const changes = shallowPatch(s, patch)\r\n  if (changes) {\r\n\r\n    return changes\r\n  }\r\n}\r\n\r\nexport const SlideActions = {\r\n  Add: makeAction((map: EditMap, id: number, flickend: boolean) => {\r\n    const res = add(map, id, flickend)\r\n    if (res)\r\n      return (map: EditMap) => del(map, res.id)\r\n  }),\r\n  Remove: makeAction((map: EditMap, id: number) => {\r\n    const res = del(map, id)\r\n    if (res)\r\n      return (map: EditMap) => add(map, res.id, res.flickend)\r\n  }),\r\n  Set: makeAction((map: EditMap, id: number, patch: PatchType) => {\r\n    const res = set(map, id, patch)\r\n    if (res)\r\n      return (map: EditMap) => set(map, id, res)\r\n  })\r\n}\r\n","import { EditMap, SlideNote, FreshNoteCache, ResortSlide } from \"../../EditMap\"\r\nimport { assert, neverHappen, shallowPatch } from \"../../../Common/utils\"\r\nimport { makeAction } from \"./types\"\r\nimport { observable } from \"mobx\"\r\n\r\n\r\nconst add = (map: EditMap, id: number, slide: number, timepoint: number, offset: number, lane: number) => {\r\n  const note: SlideNote = observable({\r\n    type: \"slide\",\r\n    id, slide, timepoint, offset, lane,\r\n    realtimecache: 0\r\n  })\r\n\r\n  const s = assert(map.slides.get(slide))\r\n  s.notes.push(id)\r\n  map.notes.set(id, note)\r\n\r\n  FreshNoteCache(map, note)\r\n  ResortSlide(map, s)\r\n\r\n  return note\r\n}\r\n\r\nconst del = (map: EditMap, id: number) => {\r\n  const note = assert(map.notes.get(id))\r\n  if (note.type !== \"slide\") neverHappen()\r\n\r\n  const s = assert(map.slides.get(note.slide))\r\n  s.notes = s.notes.filter(x => x !== note.id)\r\n  map.notes.delete(id)\r\n  \r\n  ResortSlide(map, s)\r\n\r\n  return note\r\n}\r\n\r\ntype PatchType = Partial<Pick<SlideNote, \"timepoint\" | \"offset\" | \"lane\">>\r\n\r\nconst setv = (map: EditMap, id: number, patch: PatchType) => {\r\n  const note = assert(map.notes.get(id))\r\n  if (note.type !== \"slide\") neverHappen()\r\n  const changes = shallowPatch(note, patch)\r\n  if (changes) {\r\n\r\n    FreshNoteCache(map, note)\r\n\r\n    const s = assert(map.slides.get(note.slide))\r\n    ResortSlide(map, s)\r\n\r\n    return changes\r\n  }\r\n}\r\n\r\nexport const SlideNoteActions = {\r\n  Add: makeAction((map: EditMap, id: number, slide: number, timepoint: number, offset: number, lane: number) => {\r\n    const res = add(map, id, slide, timepoint, offset, lane)\r\n    if (res)\r\n      return (map: EditMap) => del(map, res.id)\r\n  }),\r\n  Remove: makeAction((map: EditMap, id: number) => {\r\n    const res = del(map, id)\r\n    if (res)\r\n      return (map: EditMap) => add(map, res.id, res.slide, res.timepoint, res.offset, res.lane)\r\n  }),\r\n  Set: makeAction((map: EditMap, id: number, patch: PatchType) => {\r\n    const res = setv(map, id, patch)\r\n    if (res)\r\n      return (map: EditMap) => setv(map, id, res)\r\n  })\r\n}\r\n","import { EditMap, Timepoint, FreshTimepointCache } from \"../../EditMap\"\r\nimport { assert, shallowPatch } from \"../../../Common/utils\"\r\nimport { makeAction } from \"./types\"\r\nimport { observable } from \"mobx\"\r\n\r\nconst add = (map: EditMap, id: number, time: number, bpm: number, bpb: number) => {\r\n  const newtp: Timepoint =\r\n    observable({ id, time, bpm, bpb, ticktimecache: 0 })\r\n\r\n  map.timepoints.set(newtp.id, newtp)\r\n\r\n  FreshTimepointCache(newtp)\r\n  return newtp\r\n}\r\n\r\nconst del = (map: EditMap, id: number) => {\r\n  const tp = assert(map.timepoints.get(id))\r\n  map.timepoints.delete(id)\r\n\r\n  return tp\r\n}\r\n\r\ntype PatchType = Partial<Pick<Timepoint, \"time\" | \"bpm\" | \"bpb\">>\r\n\r\nconst setv = (map: EditMap, id: number, patch: PatchType) => {\r\n  const tp = assert(map.timepoints.get(id))\r\n  const changes = shallowPatch(tp, patch)\r\n  if (changes) {\r\n\r\n    FreshTimepointCache(tp)\r\n    return changes\r\n  }\r\n}\r\n\r\nexport const TimepointActions = {\r\n  Add: makeAction((map: EditMap, id: number, time: number, bpm: number, bpb: number) => {\r\n    const res = add(map, id, time, bpm, bpb)\r\n    if (res)\r\n      return (map: EditMap) => del(map, res.id)\r\n  }),\r\n  Remove: makeAction((map: EditMap, id: number) => {\r\n    const res = del(map, id)\r\n    if (res)\r\n      return (map: EditMap) => add(map, res.id, res.time, res.bpm, res.bpb)\r\n  }),\r\n  Set: makeAction((map: EditMap, id: number, patch: PatchType) => {\r\n    const res = setv(map, id, patch)\r\n    if (res)\r\n      return (map: EditMap) => setv(map, id, res)\r\n  })\r\n}\r\n","import { ImmutableArgs, AtomAction } from \"./AtomActions/types\"\r\nimport { neverHappen } from \"../../Common/utils\"\r\n\r\ntype WithArgsAction<TState> =\r\n  (state: TState) => undefined | ((state: TState) => void)\r\n\r\nexport class AtomHistory<TState> {\r\n  constructor(private state: TState) { }\r\n\r\n  private act_done: WithArgsAction<TState>[] = []\r\n  private act_todo: WithArgsAction<TState>[] = []\r\n  private act_undo: ((state: TState) => void)[] = []\r\n\r\n  get canRedo() { return this.act_todo.length > 0 }\r\n  get canUndo() { return this.act_undo.length > 0 }\r\n\r\n  callAtom<TArgs extends ImmutableArgs>(fn: AtomAction<TState, TArgs>, ...args: TArgs) {\r\n    const act = (state: TState) => fn(state, ...args)\r\n    const res = act(this.state)\r\n    if (res) {\r\n      this.act_todo.length = 0\r\n      this.act_done.push(act)\r\n      this.act_undo.push(res)\r\n      return true\r\n    }\r\n    return false\r\n  }\r\n\r\n  undoAtom() {\r\n    const un = this.act_undo.pop()\r\n    const act = this.act_done.pop()\r\n    if (!un || !act) {\r\n      if (!un && !act) return false\r\n      neverHappen(\"Undo list and done list length not equal\")\r\n    }\r\n    un(this.state)\r\n    this.act_todo.push(act)\r\n    return true\r\n  }\r\n\r\n  redoAtom() {\r\n    const act = this.act_todo.pop()\r\n    if (!act) return false\r\n    const res = act(this.state)\r\n    if (res) {\r\n      this.act_done.push(act)\r\n      this.act_undo.push(res)\r\n      return true\r\n    }\r\n    neverHappen(\"Can not redo an action.\")\r\n  }\r\n\r\n  doTransaction(fn: () => boolean) {\r\n    const startLen = this.act_done.length\r\n    const res = fn()\r\n    if (res) {\r\n      return this.act_done.length - startLen\r\n    }\r\n    while (this.act_done.length > startLen) this.undoAtom()\r\n    return 0\r\n  }\r\n\r\n  doParallel(fn: () => any) {\r\n    const startLen = this.act_done.length\r\n    fn()\r\n    const done = this.act_done.length - startLen\r\n    return done\r\n  }\r\n}\r\n","import { AtomHistory } from \"./AtomHistory\"\r\nimport { action, observable, computed } from \"mobx\"\r\n\r\nexport class CommonActions<T> {\r\n  protected history: AtomHistory<T>\r\n  @observable protected state: T\r\n\r\n  @observable private act_done: number[] = []\r\n  @observable private act_todo: number[] = []\r\n\r\n  @computed get canUndo() { return this.act_done.length > 0 }\r\n  @computed get canRedo() { return this.act_todo.length > 0 }\r\n  \r\n  constructor(state: T) {\r\n    this.history = new AtomHistory(state)\r\n    this.state = state\r\n  }\r\n\r\n  readonly changeListeners = new Set<() => void>()\r\n\r\n  private changed() {\r\n    for (const listener of this.changeListeners) {\r\n      listener()\r\n    }\r\n  }\r\n\r\n  @action\r\n  ResetState = (state: T) => {\r\n    this.state = state\r\n    this.history = new AtomHistory(state)\r\n    this.act_done = []\r\n    this.act_todo = []\r\n    this.changed()\r\n  }\r\n\r\n  protected done(step: number) {\r\n    if (step > 0) {\r\n      this.act_todo.length = 0\r\n      this.act_done.push(step)\r\n      this.changed()\r\n      return true\r\n    }\r\n    return false\r\n  }\r\n\r\n  @action\r\n  Undo = () => {\r\n    const step = this.act_done.pop()\r\n    if (step === undefined) return\r\n    this.act_todo.push(step)\r\n\r\n    for (let i = 0; i < step; i++)\r\n      this.history.undoAtom()\r\n\r\n    this.changed()\r\n  }\r\n\r\n  @action.bound\r\n  Redo = () => {\r\n    const step = this.act_todo.pop()\r\n    if (step === undefined) return\r\n    this.act_done.push(step)\r\n\r\n    for (let i = 0; i < step; i++)\r\n      this.history.redoAtom()\r\n\r\n    this.changed()\r\n  }\r\n\r\n}","import { CommonActions } from \"./CommonActions\"\r\nimport { EditMap, NoteType, Slide, Timepoint, FreshNoteCache, SlideNote } from \"../EditMap\"\r\nimport { SingleFlickActions } from \"./AtomActions/SingleFlick\"\r\nimport { assert, entryList } from \"../../Common/utils\"\r\nimport { SlideNoteActions } from \"./AtomActions/SlideNote\"\r\nimport { SlideActions } from \"./AtomActions/Slide\"\r\nimport { computed } from \"mobx\"\r\n\r\n\r\nexport class MapActionsBase extends CommonActions<EditMap> {\r\n\r\n  @computed get timepointlist() {\r\n    return entryList(this.state.timepoints).map(x => x[1])\r\n      .sort((a, b) => (a.time - b.time) || (a.id - b.id))\r\n  }\r\n  @computed get slidelist() {\r\n    return entryList(this.state.slides).map(x => x[1])\r\n  }\r\n  @computed get notelist() {\r\n    return entryList(this.state.notes).map(x => x[1])\r\n  }\r\n\r\n  get timepoints() { return this.state.timepoints as ReadonlyMap<number, Timepoint> }\r\n  get slides() { return this.state.slides as ReadonlyMap<number, Slide> }\r\n  get notes() { return this.state.notes as ReadonlyMap<number, NoteType> }\r\n\r\n  findTimepoint(time: number, ignore?: number): [Timepoint | undefined, number] {\r\n    const tps = this.timepointlist.filter(x => x.id !== ignore)\r\n    if (tps.length <= 0) return [undefined, -1]\r\n    let tpindex = 0\r\n    while (tpindex < tps.length && time >= tps[tpindex].time) tpindex++\r\n    if (tpindex > 0) tpindex--\r\n    return [tps[tpindex], tpindex]\r\n  }\r\n\r\n  /**\r\n   * calculate the nearest timepoint position  \r\n   * divisions of one quarter beat  \r\n   * @param time     - the time to calculate\r\n   * @param division - the division \r\n   */\r\n  calcNearestPosition(time: number, division: number, ignore?: number) {\r\n    const tickcount = 48 / division\r\n    const [tp, tpindex] = this.findTimepoint(time, ignore)\r\n    if (!tp) return\r\n    const offset = Math.round((time - tp.time) / (tp.ticktimecache * tickcount)) * tickcount\r\n    const realtime = tp.time + tp.ticktimecache * offset\r\n    const [rtp, rtpindex] = this.findTimepoint(realtime + tp.ticktimecache, ignore) // when its very near to next tp, switch to next\r\n    if (rtp && rtp.id !== tp.id) return {\r\n      timepoint: rtp,\r\n      /** count of 1/48 quarter beat */\r\n      offset: 0, timepointIndex: rtpindex, realtime: rtp.time\r\n    }\r\n    return {\r\n      timepoint: tp,\r\n      /** count of 1/48 quarter beat */\r\n      offset, timepointIndex: tpindex, realtime\r\n    }\r\n  }\r\n\r\n  protected patchNote(note: NoteType, patch: { timepoint?: number, offset?: number, lane?: number }) {\r\n    if (note.type === \"slide\") {\r\n      return this.history.callAtom(SlideNoteActions.Set, note.id, patch)\r\n    }\r\n    return this.history.callAtom(SingleFlickActions.Set, note.id, patch)\r\n  }\r\n\r\n  /**\r\n   * try to keep the note's timepoint and offset  \r\n   * refresh note cache first  \r\n   * if the note still in its timepoint, no change  \r\n   * else find the proper position for it by division  \r\n   */\r\n  protected justifyFollowChanged(notes: NoteType[], division: number, ignore?: number) {\r\n    for (const n of notes) {\r\n      FreshNoteCache(this.state, n)\r\n      const res = this.calcNearestPosition(n.realtimecache, division, ignore)\r\n      if (!res) {\r\n        this.deleteOne(n)\r\n      } else if (res.timepoint.id !== n.timepoint || res.offset !== n.offset) {\r\n        this.patchNote(n, { timepoint: res.timepoint.id, offset: res.offset })\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * keep realtime cache  \r\n   * if note still in unchanged timepoint, no change  \r\n   * else find the proper position for it by division  \r\n   */\r\n  protected justifyFindNearest(notes: NoteType[], division: number, ignore?: number) {\r\n    for (const n of notes) {\r\n      const res = this.calcNearestPosition(n.realtimecache, division, ignore)\r\n      if (!res) {\r\n        this.deleteOne(n)\r\n      } else if (res.timepoint.id !== n.timepoint || res.offset !== n.offset) {\r\n        this.patchNote(n, { timepoint: res.timepoint.id, offset: res.offset })\r\n      }\r\n    }\r\n  }\r\n\r\n  protected deleteSlideNote(note: SlideNote) {\r\n    if (!this.state.notes.has(note.id)) return false\r\n    const s = assert(this.state.slides.get(note.slide))\r\n    if (s.notes.length > 2) {\r\n      return this.history.callAtom(SlideNoteActions.Remove, note.id)\r\n    } else {\r\n      const n1 = s.notes[0], n2 = s.notes[1]\r\n      return this.history.doTransaction(() =>\r\n        this.history.callAtom(SlideNoteActions.Remove, n1) &&\r\n        this.history.callAtom(SlideNoteActions.Remove, n2) &&\r\n        this.history.callAtom(SlideActions.Remove, s.id)\r\n      ) > 0\r\n    }\r\n  }\r\n\r\n  protected deleteOne(note: NoteType) {\r\n    if (!this.notes.has(note.id)) return false\r\n    if (note.type === \"slide\") {\r\n      return this.deleteSlideNote(note)\r\n    }\r\n    return this.history.callAtom(SingleFlickActions.Remove, note.id)\r\n  }\r\n\r\n  protected deleteMany(notes: NoteType[]) {\r\n    for (const n of notes) {\r\n      this.deleteOne(n)\r\n    }\r\n  }\r\n}\r\n","import { NoteType, SingleNote, FlickNote, FreshNoteCache } from \"../EditMap\"\r\nimport { SingleFlickActions } from \"./AtomActions/SingleFlick\"\r\nimport { randomId, assert, neverHappen } from \"../../Common/utils\"\r\nimport { SlideActions } from \"./AtomActions/Slide\"\r\nimport { SlideNoteActions } from \"./AtomActions/SlideNote\"\r\nimport { TimepointActions } from \"./AtomActions/Timepoint\"\r\nimport { MapActionsBase } from \"./MapAtionsBase\"\r\nimport { action } from \"mobx\"\r\n\r\n\r\nexport class MapActions extends MapActionsBase {\r\n\r\n  @action.bound\r\n  addTimepoint(time: number, bpm: number, bpb: number, justifydivision: number) {\r\n    return this.done(this.history.doParallel(() => {\r\n      if (this.history.callAtom(TimepointActions.Add, randomId(), time, bpm, bpb)) {\r\n        this.justifyFindNearest(this.notelist, justifydivision)\r\n      }\r\n    }))\r\n  }\r\n\r\n  @action.bound\r\n  moveTimepoint(timepoint: number, justifyFindNearest: boolean, justifydivision: number, time?: number, bpm?: number, bpb?: number) {\r\n    const tp = assert(this.state.timepoints.get(timepoint))\r\n    const timechanged =\r\n      (time !== undefined && tp.time !== time) ||\r\n      (bpm !== undefined && tp.bpm !== bpm)\r\n    return this.done(this.history.doParallel(() => {\r\n      if (this.history.callAtom(TimepointActions.Set, timepoint, { time, bpm, bpb })) {\r\n        if (timechanged)\r\n          if (justifyFindNearest) {\r\n            this.justifyFindNearest(this.notelist, justifydivision)\r\n          } else {\r\n            this.justifyFollowChanged(this.notelist, justifydivision)\r\n          }\r\n      }\r\n    }))\r\n  }\r\n\r\n  @action.bound\r\n  removeTimepoint(timepoint: number, justifydivision: number) {\r\n    if (this.state.timepoints.size > 1) {\r\n      return this.done(this.history.doParallel(() => {\r\n        this.justifyFindNearest(this.notelist, justifydivision, timepoint)\r\n        this.history.callAtom(TimepointActions.Remove, timepoint)\r\n      }))\r\n    } else {\r\n      return this.done(this.history.doParallel(() => {\r\n        this.deleteMany(this.notelist)\r\n        this.history.callAtom(TimepointActions.Remove, timepoint)\r\n        if (this.state.slides.size ||\r\n          this.state.notes.size ||\r\n          this.state.timepoints.size) neverHappen()\r\n      }))\r\n    }\r\n  }\r\n\r\n  @action.bound\r\n  addSingle(timepoint: number, offset: number, lane: number) {\r\n    return this.done(this.history.doTransaction(() =>\r\n      this.history.callAtom(SingleFlickActions.Add, randomId(), \"single\", timepoint, offset, lane)))\r\n  }\r\n\r\n  @action.bound\r\n  toggleFlick(note: SingleNote | FlickNote) {\r\n    return this.done(this.history.doTransaction(() =>\r\n      this.history.callAtom(SingleFlickActions.Set, note.id, {\r\n        type: note.type === \"single\" ? \"flick\" : \"single\"\r\n      })))\r\n  }\r\n\r\n  @action.bound\r\n  addSlide(tp1: number, off1: number, lane1: number, tp2: number, off2: number, lane2: number) {\r\n    const sid = randomId()\r\n    return this.done(this.history.doTransaction(() =>\r\n      this.history.callAtom(SlideActions.Add, sid, false) &&\r\n      this.history.callAtom(SlideNoteActions.Add, randomId(), sid, tp1, off1, lane1) &&\r\n      this.history.callAtom(SlideNoteActions.Add, randomId(), sid, tp2, off2, lane2)))\r\n  }\r\n\r\n  @action.bound\r\n  toggleFlickend(slide: number) {\r\n    const s = assert(this.state.slides.get(slide))\r\n    return this.done(this.history.doTransaction(() =>\r\n      this.history.callAtom(SlideActions.Set, slide, { flickend: !s.flickend })))\r\n  }\r\n\r\n  @action.bound\r\n  addSlideMid(slide: number, timepoint: number, offset: number, lane: number) {\r\n    return this.done(this.history.doTransaction(() =>\r\n      this.history.callAtom(SlideNoteActions.Add, randomId(), slide, timepoint, offset, lane)))\r\n  }\r\n\r\n  @action.bound\r\n  moveMany(notes: NoteType[], timeoffset: number, min: number, max: number, laneoffset: number, division: number) {\r\n    return this.done(this.history.doTransaction(() => {\r\n      for (const n of notes) {\r\n        const targetTime = n.realtimecache + timeoffset\r\n        const targetLane = n.lane + laneoffset\r\n        if (targetTime > max || targetTime < min || targetLane < 0 || targetLane > 6) {\r\n          for (const n of notes) FreshNoteCache(this.state, n)\r\n          return false\r\n        }\r\n        this.patchNote(n, { lane: targetLane })\r\n        n.realtimecache = targetTime\r\n      }\r\n      this.justifyFindNearest(notes, division)\r\n      return true\r\n    }))\r\n  }\r\n\r\n  @action.bound\r\n  copyMany(notes: NoteType[], timeoffset: number, min: number, max: number, laneoffset: number, division: number) {\r\n    return this.done(this.history.doTransaction(() => {\r\n      const slideidmap: { [key: number]: number } = {}\r\n      const slideNoteCount: { [key: number]: number } = {}\r\n      for (const n of notes) {\r\n        if (n.type === \"slide\")\r\n          slideNoteCount[n.slide] = (slideNoteCount[n.slide] && slideNoteCount[n.slide] + 1) || 1\r\n      }\r\n      for (const slide in slideNoteCount) {\r\n        const slideid = parseInt(slide)\r\n        if (slideNoteCount[slideid] >= 2) {\r\n          const id = randomId()\r\n          this.history.callAtom(SlideActions.Add, id,\r\n            assert(this.state.slides.get(slideid)).flickend)\r\n          slideidmap[slideid] = id\r\n        }\r\n      }\r\n\r\n      for (const n of notes) {\r\n        const targetTime = n.realtimecache + timeoffset\r\n        const targetLane = n.lane + laneoffset\r\n        if (targetTime > max || targetTime < min || targetLane < 0 || targetLane > 6) {\r\n          return false\r\n        }\r\n        const res = assert(this.calcNearestPosition(targetTime, division))\r\n        if (n.type === \"slide\") {\r\n          const slide = slideidmap[n.slide]\r\n          if (!slide) continue\r\n          const done = this.history.callAtom(SlideNoteActions.Add, randomId(), slide, res.timepoint.id, res.offset, targetLane)\r\n          if (!done) return false\r\n        } else {\r\n          const done = this.history.callAtom(SingleFlickActions.Add, randomId(), n.type, res.timepoint.id, res.offset, targetLane)\r\n          if (!done) return false\r\n        }\r\n      }\r\n      return true\r\n    }))\r\n  }\r\n\r\n  @action.bound\r\n  removeNotes(notes: NoteType[]) {\r\n    return this.done(this.history.doParallel(() => {\r\n      this.deleteMany(notes)\r\n    }))\r\n  }\r\n\r\n}\r\n","\r\n\r\nexport type Meta = {\r\n  name: string\r\n}\r\n\r\nexport const DefaultMeta: Meta = {\r\n  name: \"\"\r\n}\r\n","\r\n\r\nexport type Settings = {\r\n\r\n  general: {\r\n\r\n    song_volume: number\r\n    effect_volume: number\r\n\r\n    background_dim: number\r\n\r\n  }\r\n\r\n  editor: {\r\n\r\n    autosave_interval: number\r\n    // global\r\n\r\n    keep_pitch: boolean\r\n\r\n    // timing\r\n\r\n    justify_find_nearest: boolean\r\n    /** 1 | 2 | 3 | 4 | 6 | 8 | 16 | 48 */\r\n    justify_grid_divisor: number\r\n\r\n    show_info_window: boolean\r\n\r\n    warn_for_same_pos_notes: boolean\r\n  }\r\n\r\n  game: {\r\n    skin: string\r\n    judge_offset: number\r\n    visual_offset: number\r\n    speed: number\r\n    resolution: number\r\n    note_scale: number\r\n    bar_opaciry: number\r\n    show_sim_line: boolean\r\n    lane_effect: boolean\r\n    mirror: boolean\r\n    beat_note: boolean\r\n  }\r\n}\r\n\r\nexport const DefaultSettings: Settings = {\r\n  general: { song_volume: 1, effect_volume: 1, background_dim: 0.7 },\r\n  editor: {\r\n    keep_pitch: false, justify_find_nearest: true, justify_grid_divisor: 48, show_info_window: true,\r\n    warn_for_same_pos_notes: true, autosave_interval: 5,\r\n  },\r\n  game: {\r\n    skin: 'default', judge_offset: 0, visual_offset: 0, speed: 10, resolution: 1.25, note_scale: 1, bar_opaciry: 0.9,\r\n    show_sim_line: true, lane_effect: true, mirror: false, beat_note: true,\r\n  }\r\n}\r\n","import { MapActions } from \"./MapActions/MapActions\"\r\nimport { EditMap } from \"./EditMap\"\r\nimport { observable, autorun } from \"mobx\"\r\nimport { Meta, DefaultMeta } from \"./Meta\"\r\nimport { Settings, DefaultSettings } from \"./Settings\"\r\nimport { deepPatch } from \"../Common/utils\"\r\n\r\n\r\nconst StorageNames = {\r\n  meta: \"editor:meta\",\r\n  mapcontent: \"editor:mapcontent\",\r\n  settings: \"editor:settings\"\r\n}\r\n\r\nclass Scope {\r\n  constructor() {\r\n    const map = localStorage.getItem(StorageNames.mapcontent)\r\n    let editmap: EditMap | null = null\r\n    if (map) {\r\n      try {\r\n        editmap = EditMap.fromJson(map)\r\n      } catch (error) {\r\n        localStorage.removeItem(StorageNames.mapcontent)\r\n        console.error(error)\r\n      }\r\n    }\r\n    if (!editmap) {\r\n      editmap = EditMap.create()\r\n    }\r\n    this.map = new MapActions(editmap)\r\n\r\n    const meta = localStorage.getItem(StorageNames.meta)\r\n    this.meta = observable(DefaultMeta)\r\n    if (meta) deepPatch(this.meta, JSON.parse(meta))\r\n\r\n    autorun(() => {\r\n      const json = JSON.stringify(this.meta)\r\n      localStorage.setItem(StorageNames.meta, json)\r\n    })\r\n\r\n    const settings = localStorage.getItem(StorageNames.settings)\r\n    this.settings = observable(DefaultSettings)\r\n    if (settings) deepPatch(this.settings, JSON.parse(settings))\r\n\r\n    autorun(() => {\r\n      const json = JSON.stringify(this.settings)\r\n      localStorage.setItem(StorageNames.settings, json)\r\n    })\r\n\r\n\r\n    this.map.changeListeners.add(() => {\r\n      if (this.settings.editor.autosave_interval > 0)\r\n        setTimeout(() => {\r\n          const now = new Date().getTime()\r\n          const timeout = this.settings.editor.autosave_interval * 60 * 1000\r\n          if (!this.lastSave || now - this.lastSave.getTime() > timeout)\r\n            this.save()\r\n        }, this.settings.editor.autosave_interval * 60 * 1000 - 1000)\r\n    })\r\n  }\r\n\r\n  map: MapActions\r\n\r\n  @observable lastSave: Date | null = null\r\n\r\n  save = () => {\r\n    const json = EditMap.toJsonString((this.map as any).state)\r\n    localStorage.setItem(StorageNames.mapcontent, json)\r\n    this.lastSave = new Date()\r\n  }\r\n\r\n  @observable update = false\r\n\r\n  reset = (map?: EditMap) => {\r\n    this.map.ResetState(map || EditMap.create())\r\n  }\r\n\r\n  @observable meta: Meta\r\n  @observable settings: Settings\r\n}\r\n\r\n\r\nexport const scope = new Scope()\r\n","\r\nclass AudioCtx {\r\n  constructor() {\r\n    this._ctx = new AudioContext()\r\n    this._output = this._ctx.createGain()\r\n    this._output.connect(this._ctx.destination)\r\n  }\r\n  private _ctx: AudioContext\r\n  private _output: GainNode\r\n\r\n  get ctx() { return this._ctx }\r\n  get now() { return this._ctx.currentTime }\r\n  get latency() { return this._ctx.baseLatency + this._ctx.outputLatency }\r\n  get mastervolume() { return this._output.gain }\r\n  get destination() { return this._output }\r\n}\r\n\r\nwindow.AudioContext = window.AudioContext || (window as any).webkitAudioContext\r\n\r\nconst globalctx = AudioContext && new AudioCtx()\r\nexport default globalctx","\r\nexport type Listener<TArgs extends any[]> = (remove: () => boolean, ...args: TArgs) => unknown\r\n\r\nexport default class MyEvent<TArgs extends any[] = []> {\r\n  private listeners = new Set<Listener<TArgs>>()\r\n\r\n  add = (listener: Listener<TArgs>) => {\r\n    this.listeners.add(listener)\r\n    return () => this.listeners.delete(listener)\r\n  }\r\n\r\n  dispatch = (...args: TArgs) => {\r\n    const listeners: Listener<TArgs>[] = []\r\n    for (const l of this.listeners) listeners.push(l)\r\n    listeners.forEach(l => l(() => this.listeners.delete(l), ...args))\r\n  }\r\n\r\n  dispose = () => this.listeners.clear()\r\n}\r\n","import globalctx from \"./GlobalCtx\"\r\nimport MyEvent from \"./MyEvent\"\r\n\r\ntype Source = ArrayBuffer | Blob | Promise<ArrayBuffer | Blob>\r\n\r\nexport default class AudioSource {\r\n  private constructor() {\r\n    this.gain = globalctx.ctx.createGain()\r\n    this.gain.connect(globalctx.destination)\r\n  }\r\n  private gain: GainNode\r\n  get destination() { return this.gain }\r\n  get volume() { return Math.sqrt(this.gain.gain.value) }\r\n  set volume(v) { this.gain.gain.value = v * v }\r\n\r\n  buffer?: AudioBuffer\r\n  get loaded() { return !!this.buffer }\r\n\r\n  onload = new MyEvent()\r\n  onloaderr = new MyEvent<[any]>()\r\n\r\n  get duration() {\r\n    if (this.buffer) {\r\n      return this.buffer.duration\r\n    }\r\n    return 0\r\n  }\r\n\r\n  static from(getsource: (() => Source) | Source) {\r\n    const s = new AudioSource()\r\n\r\n    const onerror = (err: any) => s.onloaderr.dispatch(err)\r\n\r\n    const load = (data: ArrayBuffer | Blob) => {\r\n      if (data instanceof Blob) {\r\n        const reader = new FileReader()\r\n        reader.onabort = onerror\r\n        reader.onerror = onerror\r\n        reader.onload = e => {\r\n          if (reader.result instanceof ArrayBuffer) {\r\n            load(reader.result)\r\n          } else {\r\n            onerror(e)\r\n          }\r\n        }\r\n        reader.readAsArrayBuffer(data)\r\n      } else {\r\n        globalctx.ctx.decodeAudioData(data, buffer => {\r\n          s.buffer = buffer\r\n          s.onload.dispatch()\r\n        }, onerror)\r\n      }\r\n    }\r\n    s.load = () => {\r\n      const src = getsource instanceof Function\r\n        ? getsource() : getsource\r\n      if (src instanceof Promise) {\r\n        src.then(load).catch(onerror)\r\n      } else {\r\n        load(src)\r\n      }\r\n      return s\r\n    }\r\n    return s\r\n  }\r\n\r\n  load = () => this\r\n}\r\n","import AudioSource from \"./AudioSource\"\r\nimport globalctx from \"./GlobalCtx\"\r\nimport MyEvent from \"./MyEvent\"\r\n\r\nexport default class AudioInstance {\r\n  constructor(source: AudioSource) {\r\n    this.source = source\r\n    this.gain = globalctx.ctx.createGain()\r\n    this.gain.connect(source.destination)\r\n    this.node = this.createnode()\r\n  }\r\n  source: AudioSource\r\n\r\n  private gain: GainNode\r\n  get volume() { return Math.sqrt(this.gain.gain.value) }\r\n  set volume(v) { this.gain.gain.value = v * v }\r\n\r\n  private node: AudioBufferSourceNode\r\n  private createnode() {\r\n    const n = globalctx.ctx.createBufferSource()\r\n    n.buffer = this.source.buffer as AudioBuffer\r\n    n.connect(this.gain)\r\n    n.playbackRate.value = this._playbackrate\r\n    return n\r\n  }\r\n  private _playing = false\r\n  /**\r\n   * when sound is playing, keep it valid to (now - starttime) * playbackrate == position\r\n   * when not playing, it's not valid at all\r\n   */\r\n  private _starttime = 0\r\n  /**\r\n   * when sound is playing, it's not valid at all\r\n   * when not playing, it shows where to start sound\r\n   */\r\n  private _startpos = 0\r\n  private _playbackrate = 1\r\n\r\n  onplay = new MyEvent()\r\n  onpause = new MyEvent()\r\n  onseek = new MyEvent()\r\n  onend = new MyEvent()\r\n\r\n  get position() {\r\n    if (!this._playing) return this._startpos\r\n    const now = globalctx.now\r\n    const playedtime = now - this._starttime\r\n    // if (this._playbackrate !== 1) return playedtime * this._playbackrate - 0.016\r\n    return playedtime * this._playbackrate\r\n  }\r\n\r\n  /**\r\n   * set startpos before calling it\r\n   */\r\n  private callstart = (delay: number) => {\r\n    const startt = globalctx.now + delay\r\n    this.node.start(startt, this._startpos)\r\n    const playedtime = this._startpos / this._playbackrate\r\n    this._starttime = startt - playedtime\r\n    this._playing = true\r\n  }\r\n\r\n  private handleNormalEnd = () => {\r\n    this._startpos = 0\r\n    this._playing = false\r\n    this.node = this.createnode()\r\n\r\n    this.onend.dispatch()\r\n  }\r\n\r\n  private handlePauseEnd = () => {\r\n    this._startpos = this.position  // get before _playing is set to false\r\n    this._playing = false\r\n    this.node = this.createnode()\r\n\r\n    this.onpause.dispatch()\r\n  }\r\n\r\n  private handleSeekEnd = () => {\r\n\r\n    this.node = this.createnode()\r\n    this.node.onended = this.handleNormalEnd\r\n    this.callstart(0)\r\n\r\n    this.onseek.dispatch()\r\n  }\r\n\r\n  play(delay = 0) {\r\n    if (this._playing) return\r\n\r\n    this.callstart(delay)\r\n\r\n    // normal end\r\n    this.node.onended = this.handleNormalEnd\r\n\r\n    this.onplay.dispatch()\r\n  }\r\n\r\n  stop(delay = 0) {\r\n    if (!this._playing) {\r\n      this._startpos = 0\r\n      return\r\n    }\r\n\r\n    // normal end, maybe we have to override pause end handler\r\n    this.node.onended = this.handleNormalEnd\r\n\r\n    this.node.stop(globalctx.now + delay)\r\n  }\r\n\r\n  pause(delay = 0) {\r\n    if (!this._playing) return\r\n\r\n    // pause caused end\r\n    this.node.onended = this.handlePauseEnd\r\n\r\n    this.node.stop(globalctx.now + delay)\r\n  }\r\n\r\n  seek(position: number) {\r\n    position = Math.max(0, Math.min(this.source.duration, position))\r\n    if (!this._playing) {\r\n      this._startpos = position\r\n      this.onseek.dispatch()\r\n      return\r\n    }\r\n\r\n    this._startpos = position\r\n    const playedtime = this._startpos / this._playbackrate\r\n    this._starttime = globalctx.now - playedtime\r\n    // seek caused end\r\n    this.node.onended = this.handleSeekEnd\r\n\r\n    this.node.stop(globalctx.now)\r\n  }\r\n\r\n  get rate() { return this._playbackrate }\r\n\r\n  setRate(rate: number) {\r\n    rate = Math.max(0.25, Math.min(4, rate))\r\n\r\n    const currentpos = this.position // get currentpos before set playbackrate\r\n\r\n    this._playbackrate = rate\r\n    this.node.playbackRate.value = this._playbackrate\r\n\r\n    if (this._playing) {\r\n      const now = globalctx.now\r\n      const playedtime = currentpos / rate\r\n      this._starttime = now - playedtime\r\n    }\r\n  }\r\n}\r\n\r\n","import MyEvent from \"./MyEvent\"\r\n\r\nexport default class AudioElInstance {\r\n  constructor(source: Blob) {\r\n    this.source = source\r\n    this.el = document.createElement(\"audio\")\r\n    this.el.oncanplaythrough = e => {\r\n      this.el.oncanplaythrough = null\r\n      this._loaded = true\r\n      this.onload.dispatch()\r\n    }\r\n    this.el.onerror = e => this.onloaderr.dispatch(e)\r\n      ; (this.el as any).preservesPitch = true\r\n    this.el.onended = e => {\r\n      this.onend.dispatch()\r\n      this.el.currentTime = 0\r\n    }\r\n    this.el.src = URL.createObjectURL(source)\r\n    this.el.load()\r\n  }\r\n\r\n  private _loaded = false\r\n  get loaded() { return this._loaded }\r\n  onload = new MyEvent()\r\n  onloaderr = new MyEvent<[any]>()\r\n\r\n  get duration() { return this.el.duration }\r\n\r\n  source: Blob\r\n  private el: HTMLAudioElement\r\n\r\n  get volume() { return this.el.volume }\r\n  set volume(v) { this.el.volume = v }\r\n\r\n  onplay = new MyEvent()\r\n  onpause = new MyEvent()\r\n  onseek = new MyEvent()\r\n  onend = new MyEvent()\r\n\r\n  get position() {\r\n    return this.el.currentTime\r\n  }\r\n\r\n  play(delay = 0) {\r\n    this.el.play()\r\n    this.onplay.dispatch()\r\n  }\r\n\r\n  stop(delay = 0) {\r\n    this.el.pause()\r\n    this.el.currentTime = 0\r\n    this.onend.dispatch()\r\n  }\r\n\r\n  pause(delay = 0) {\r\n    this.el.pause()\r\n    this.onpause.dispatch()\r\n  }\r\n\r\n  seek(position: number) {\r\n    this.el.currentTime = position\r\n    this.onseek.dispatch()\r\n  }\r\n\r\n  get rate() { return this.el.playbackRate }\r\n\r\n  setRate(rate: number) {\r\n    rate = Math.max(0.25, Math.min(4, rate))\r\n    this.el.playbackRate = rate\r\n  }\r\n}\r\n\r\n","import globalctx from \"./GlobalCtx\"\r\nimport MyEvent from \"./MyEvent\"\r\nimport AudioSource from \"./AudioSource\"\r\nimport AudioInstance from \"./AudioInstance\"\r\nimport AudioElInstance from \"./AudioElInstance\"\r\n\r\nexport default globalctx\r\nexport { MyEvent, AudioSource, AudioInstance, AudioElInstance }\r\n\r\nexport async function loadFromUrl(url: string) {\r\n  const res = await fetch(url)\r\n  const buffer = await res.arrayBuffer()\r\n  return buffer\r\n}\r\n\r\n","import { scope } from \"../MappingScope/scope\"\r\nimport { observable, autorun } from \"mobx\"\r\nimport { AudioInstance, AudioSource, AudioElInstance } from \"../Common/AudioCtx\"\r\n\r\nclass BackgroundState {\r\n  @observable src = \"\"\r\n}\r\n\r\nexport const Background = new BackgroundState()\r\n\r\nclass MusicState {\r\n\r\n  constructor() {\r\n    autorun(() => {\r\n      if (this.audio) {\r\n        this.audio.setRate(this.playbackrate)\r\n        this.audio.volume = scope.settings.general.song_volume\r\n      }\r\n    })\r\n  }\r\n\r\n  @observable private audio = null as null | AudioInstance | AudioElInstance\r\n  get loaded() { return this.audio !== null }\r\n  @observable duration = 5\r\n  @observable playing = false\r\n  @observable playbackrate = 1\r\n  @observable private seekcounter = 1\r\n\r\n  musicfile: null | File = null\r\n\r\n  load = (file: File, onerror: () => void, onload: () => void) => {\r\n    const m = this\r\n    if (m.audio !== null) {\r\n      m.audio.stop()\r\n    }\r\n    m.audio = null\r\n    m.duration = 5\r\n    m.playing = false\r\n    m.seekcounter = 1\r\n    m.musicfile = null\r\n\r\n    if (scope.settings.editor.keep_pitch) {\r\n      const instance = new AudioElInstance(file)\r\n\r\n      instance.onload.add(() => {\r\n        this.musicfile = file\r\n        m.duration = instance.duration\r\n        instance.setRate(this.playbackrate)\r\n        onload()\r\n\r\n        this.audio = instance\r\n        this.audio.onend.add(() => {\r\n          this.playing = false\r\n        })\r\n      })\r\n\r\n      instance.onloaderr.add(err => {\r\n        console.error(err)\r\n        onerror()\r\n      })\r\n      return\r\n    }\r\n\r\n    const source = AudioSource.from(file)\r\n\r\n    source.onload.add(() => {\r\n      this.musicfile = file\r\n      m.duration = source.duration\r\n      onload()\r\n\r\n      this.audio = new AudioInstance(source)\r\n      this.audio.setRate(this.playbackrate)\r\n      this.audio.onend.add(() => {\r\n        this.playing = false\r\n      })\r\n    })\r\n\r\n    source.onloaderr.add(err => {\r\n      console.error(err)\r\n      onerror()\r\n    })\r\n\r\n    source.load()\r\n  }\r\n\r\n  position = () => {\r\n    // auto collect dependency for seekcounter\r\n    if (this.audio && this.seekcounter) return this.audio.position\r\n    return 1\r\n  }\r\n\r\n  /**\r\n   * valid only if playing\r\n   */\r\n  remaintime = () => {\r\n    return (this.duration - this.position()) / this.playbackrate\r\n  }\r\n\r\n  seek = (time: number) => {\r\n    if (!this.audio) return\r\n    const duration = this.duration\r\n    if (time < 0) time = 0\r\n    if (time >= duration) time = duration - 0.05\r\n    this.audio.seek(time)\r\n    this.seekcounter++\r\n  }\r\n\r\n  toggle = () => {\r\n    if (!this.audio) return\r\n    if (this.playing) {\r\n      this.audio.pause()\r\n      this.playing = false\r\n    } else {\r\n      this.audio.play()\r\n      this.playing = true\r\n    }\r\n  }\r\n\r\n  stop = () => {\r\n    if (this.audio)\r\n      this.audio.stop()\r\n  }\r\n}\r\n\r\nexport const Music = new MusicState()\r\n","import React from \"react\"\r\nimport Box from \"@material-ui/core/Box\"\r\nimport makeStyles from \"@material-ui/core/styles/makeStyles\"\r\nimport { Background } from \"../states\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\nimport { scope } from \"../../MappingScope/scope\"\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  background: {\r\n    position: \"absolute\", zIndex: -1, top: 0, left: 0, right: 0, bottom: 0,\r\n    backgroundPosition: \"center\", backgroundRepeat: \"no-repeat\", transition: \"opacity 0.3s\",\r\n    backgroundSize: \"cover\"\r\n  }\r\n}))\r\n\r\nconst BackgroundImage = () => {\r\n\r\n  const cn = useStyles()\r\n\r\n  return useObserver(() =>\r\n    <Box className={cn.background}\r\n      style={{\r\n        backgroundImage: Background.src ? `url(${Background.src})` : \"\",\r\n        opacity: 1 - scope.settings.general.background_dim\r\n      }}\r\n    />)\r\n}\r\n\r\nexport default BackgroundImage","import { createMuiTheme } from \"@material-ui/core/styles\"\r\nimport { red, blue } from \"@material-ui/core/colors\"\r\n\r\nexport const theme = createMuiTheme({\r\n  palette: {\r\n    primary: { main: blue[500], contrastText: \"white\" },\r\n    secondary: { main: red[\"A200\"] },\r\n    error: red,\r\n    type: \"dark\",\r\n    background: { default: \"#000\", }//paper: \"rgba(127,127,127,0.5)\" }\r\n  },\r\n  overrides: {\r\n    MuiButton: {\r\n      root: {\r\n        textTransform: \"inherit\",\r\n        transition: \"color 0.2s\"\r\n      }\r\n    },\r\n    MuiTab: {\r\n      root: {\r\n        textTransform: \"inherit\",\r\n        minWidth: \"96px !important\"\r\n      },\r\n    },\r\n    MuiSnackbarContent: {\r\n      root: { color: \"#fff\" }\r\n    },\r\n    MuiTableRow: {\r\n      root: {\r\n        \"&$selected\": {\r\n          background: \"rgb(128,216,255,0.16)\",\r\n          \"&:hover\": {\r\n            background: \"rgb(128,216,255,0.16)\",\r\n          }\r\n        },\r\n      }\r\n    },\r\n    MuiDivider: {\r\n      root: {\r\n        height: 2,\r\n        backgroundColor: \"rgba(127, 127, 127, 0.5)\"\r\n      }\r\n    }\r\n  }\r\n})\r\n","import React from \"react\"\r\nimport Dialog from \"@material-ui/core/Dialog\"\r\nimport { observable, action } from \"mobx\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\"\r\nimport DialogContent from \"@material-ui/core/DialogContent\"\r\nimport DialogActions from \"@material-ui/core/DialogActions\"\r\nimport Button from \"@material-ui/core/Button\"\r\nimport TextField from \"@material-ui/core/TextField\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  paper: { width: \"calc(60vw + 200px)\" }\r\n}))\r\n\r\nconst dialog = observable({\r\n  open: false,\r\n  content: \"\",\r\n  title: \"\",\r\n  copy: \"\"\r\n})\r\n\r\nexport const openDialog = action(function (title: string, content: string, copy = content as string) {\r\n  dialog.open = true\r\n  dialog.content = content\r\n  dialog.title = title\r\n  dialog.copy = copy\r\n})\r\n\r\nconst copy = () => {\r\n  navigator.clipboard.writeText(dialog.copy)\r\n}\r\n\r\nconst onfocus = (e: React.FocusEvent<HTMLTextAreaElement>) => {\r\n  e.target.select()\r\n}\r\n\r\nconst CopyDialog = () => {\r\n\r\n  const cn = useStyles()\r\n  const { t } = useTranslation()\r\n\r\n  return useObserver(() =>\r\n    <Dialog open={dialog.open} onClose={() => dialog.open = false} classes={{ paper: cn.paper }}>\r\n      <DialogTitle>{dialog.title}</DialogTitle>\r\n      <DialogContent>\r\n        <TextField autoFocus onFocus={onfocus} fullWidth multiline rowsMax={20} variant=\"outlined\" value={dialog.content} />\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={copy} color=\"primary\">\r\n          {t(\"Copy\")}\r\n        </Button>\r\n        <Button onClick={() => dialog.open = false} color=\"primary\">\r\n          {t(\"Close\")}\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog >)\r\n}\r\n\r\nexport default CopyDialog","import React from 'react'\r\nimport clsx from 'clsx'\r\nimport CheckCircleIcon from '@material-ui/icons/CheckCircle'\r\nimport ErrorIcon from '@material-ui/icons/Error'\r\nimport InfoIcon from '@material-ui/icons/Info'\r\nimport CloseIcon from '@material-ui/icons/Close'\r\nimport { orange, lightGreen, red, lightBlue } from '@material-ui/core/colors'\r\nimport IconButton from '@material-ui/core/IconButton'\r\nimport Snackbar from '@material-ui/core/Snackbar'\r\nimport SnackbarContent from '@material-ui/core/SnackbarContent'\r\nimport WarningIcon from '@material-ui/icons/Warning'\r\nimport { makeStyles } from '@material-ui/core/styles'\r\nimport { observable } from 'mobx'\r\nimport { useObserver } from 'mobx-react-lite'\r\n\r\nconst variantIcon = {\r\n  success: CheckCircleIcon,\r\n  warning: WarningIcon,\r\n  error: ErrorIcon,\r\n  info: InfoIcon,\r\n}\r\n\r\nconst Message = observable({\r\n  message: \"\",\r\n  open: false,\r\n  type: \"info\" as keyof typeof variantIcon,\r\n})\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  success: { backgroundColor: lightGreen[700], },\r\n  error: { backgroundColor: red[600], },\r\n  info: { backgroundColor: lightBlue[600], },\r\n  warning: { backgroundColor: orange[700], },\r\n  icon: { fontSize: 20, },\r\n  iconVariant: { opacity: 0.9, marginRight: theme.spacing(1), },\r\n  message: { display: 'flex', alignItems: 'center', },\r\n}))\r\n\r\nexport function userMessage(message: string, type = \"info\" as keyof typeof variantIcon) {\r\n  Message.message = message\r\n  Message.type = type\r\n  Message.open = true\r\n}\r\n\r\nconst handleClose = (event: any, reason?: string) => {\r\n  if (reason === 'clickaway') return\r\n  Message.open = false\r\n}\r\n\r\nconst GlobalSnackbar = () => {\r\n\r\n  const cn = useStyles()\r\n  const Icon = variantIcon[Message.type]\r\n\r\n  return useObserver(() => (\r\n    <Snackbar\r\n      anchorOrigin={{\r\n        vertical: 'bottom',\r\n        horizontal: 'center',\r\n      }}\r\n      open={Message.open}\r\n      autoHideDuration={5000}\r\n      onClose={handleClose}\r\n      key={Message.message + Message.type}\r\n    >\r\n      <SnackbarContent\r\n        className={cn[Message.type]}\r\n        message={\r\n          <span className={cn.message}>\r\n            <Icon className={clsx(cn.icon, cn.iconVariant)} />\r\n            {Message.message}\r\n          </span>\r\n        }\r\n        action={[\r\n          <IconButton key=\"close\" aria-label=\"close\" color=\"inherit\" onClick={handleClose}>\r\n            <CloseIcon className={cn.icon} />\r\n          </IconButton>,\r\n        ]}\r\n      />\r\n    </Snackbar>))\r\n}\r\n\r\nexport default GlobalSnackbar","import { EditMap, Timepoint } from \"../MappingScope/EditMap\"\r\nimport { entryList } from \"../Common/utils\"\r\n\r\ntype bdBpm = {\r\n  type: \"BPM\"\r\n  beat: number\r\n  bpm: number\r\n}\r\n\r\ntype bdNoteBase = {\r\n  type: \"Single\" | \"Slide\" | \"Long\" | \"Directional\"\r\n}\r\n\r\ntype bdSingleNote = bdNoteBase & {\r\n  type: \"Single\"\r\n  /**\r\n   * bpm:      60          120 at 3\r\n   * timeline: *---*---*---*-*-*-\r\n   * beat:     0   1   2   3 4 5\r\n   */\r\n  beat: number\r\n  /**\r\n   * from 0 to 6\r\n   */\r\n  lane: number\r\n  flick?: true\r\n  skill?: true\r\n}\r\n\r\ntype bdSlideNote = bdNoteBase & {\r\n  type: \"Slide\"\r\n  connections: {\r\n    beat: number\r\n    lane: number\r\n    flick?: true\r\n  }[]\r\n}\r\n\r\ntype bdMapItem = bdBpm | bdSingleNote | bdSlideNote\r\n\r\ntype bdMap = bdMapItem[]\r\n\r\n\r\n\r\nfunction format(map: bdMap) {\r\n  const strb: string[] = []\r\n  strb.push(\"[\")\r\n  for (let i = 0; i < map.length; i++) {\r\n    const item = map[i]\r\n    strb.push(JSON.stringify(item))\r\n    if (i !== map.length - 1) strb.push(\",\\n\")\r\n  }\r\n  strb.push(\"]\")\r\n  return strb.join(\"\")\r\n}\r\n\r\nfunction properBpmForSpan(time: number, preferred: number) {\r\n  for (let bpm = 30; bpm <= 60000; bpm++) {\r\n    const beattime = 60 / bpm\r\n    const beats = time / beattime\r\n    let beatcount = (beats + 0.5) | 0\r\n    const diff = beats > beatcount ? beats - beatcount : beatcount - beats\r\n    if (diff * beattime <= 1e-3) {\r\n      if (preferred % bpm === 0) {\r\n        const d = preferred / bpm\r\n        bpm *= d\r\n        beatcount *= d\r\n      }\r\n      return { bpm, beatcount }\r\n    }\r\n  }\r\n}\r\n\r\nexport function toBestdoriFormat(map: EditMap) {\r\n  const tps = entryList(map.timepoints).map(x => x[1]).sort((a, b) => a.time - b.time)\r\n  if (tps.length <= 0) return \"[]\"\r\n\r\n  const tpsPut = new Set<Timepoint>()\r\n\r\n  const notes = entryList(map.notes).map(x => x[1]).sort((a, b) => {\r\n    const dt = a.realtimecache - b.realtimecache\r\n    if (dt) return dt\r\n    return a.lane - b.lane\r\n  })\r\n\r\n  const bdmap: bdMap = []\r\n\r\n  let lasttp = tps[0]\r\n  let tpbasebeat = 0\r\n\r\n  {\r\n    if (lasttp.bpm !== (lasttp.bpm | 0)) throw new Error(\"Can not have float point bpm\")\r\n    const res = properBpmForSpan(lasttp.time, lasttp.bpm)\r\n    if (!res) throw new Error(\"Can not calculate bpm insertion\")\r\n    if (res.bpm === lasttp.bpm || res.beatcount <= 0) {\r\n      bdmap.push({ type: \"BPM\", beat: 0, bpm: lasttp.bpm })\r\n    } else {\r\n      bdmap.push({ type: \"BPM\", beat: 0, bpm: res.bpm })\r\n      bdmap.push({ type: \"BPM\", beat: res.beatcount, bpm: lasttp.bpm })\r\n    }\r\n    tpbasebeat = res.beatcount\r\n    tpsPut.add(lasttp)\r\n  }\r\n\r\n  let inote = 0\r\n  let lastnotebeat = tpbasebeat\r\n  let bdslides: Record<number, bdSlideNote> = {}\r\n\r\n  while (inote < notes.length) {\r\n    const n = notes[inote++]\r\n    const tp = map.timepoints.get(n.timepoint)\r\n    if (!tp) throw new Error(\"Map may be corrupted\")\r\n    if (!tpsPut.has(tp)) {\r\n\r\n      if (tp.bpm !== (tp.bpm | 0)) throw new Error(\"Can not have float point bpm\")\r\n      lastnotebeat = 0xfffff - ((0xfffff - lastnotebeat) | 0)\r\n      const lasttime = (lastnotebeat - tpbasebeat) * lasttp.ticktimecache * 48 + lasttp.time\r\n\r\n      const res = properBpmForSpan(tp.time - lasttime, tp.bpm)\r\n      if (!res) throw new Error(\"Can not calculate bpm insertion\")\r\n\r\n      if (res.bpm === tp.bpm || res.beatcount <= 0) {\r\n        tpbasebeat = lastnotebeat + res.beatcount\r\n        bdmap.push({ type: \"BPM\", beat: tpbasebeat, bpm: tp.bpm })\r\n      } else {\r\n        tpbasebeat = lastnotebeat + res.beatcount\r\n        bdmap.push({ type: \"BPM\", beat: lastnotebeat, bpm: res.bpm })\r\n        bdmap.push({ type: \"BPM\", beat: tpbasebeat, bpm: tp.bpm })\r\n      }\r\n\r\n      lasttp = tp\r\n      lastnotebeat = tpbasebeat\r\n      tpsPut.add(tp)\r\n\r\n    }\r\n    if (lasttp !== tp) throw new Error(\"Map may be corrupted\")\r\n\r\n    const beat = tpbasebeat + n.offset / 48\r\n    const lane = n.lane\r\n\r\n    lastnotebeat = beat\r\n\r\n    switch (n.type) {\r\n      case \"single\":\r\n        bdmap.push({ type: \"Single\", beat, lane  })\r\n        break\r\n      case \"flick\":\r\n        bdmap.push({ type: \"Single\", beat, lane, flick: true })\r\n        break\r\n      case \"slide\":\r\n        const sl = map.slides.get(n.slide)\r\n        if (!sl) {\r\n          console.error(`At note ${n.id}:\\rNo Slide ${n.slide}`)\r\n          throw new Error(\"Map may be corrupted\")\r\n        }\r\n        if (!bdslides[sl.id]) bdslides[sl.id] = {\r\n          type: \"Slide\", connections: []\r\n        }\r\n        const bdn: {\r\n          beat: number\r\n          lane: number\r\n          flick?: true\r\n        } = {\r\n          beat, lane\r\n        }\r\n        if (sl.notes[sl.notes.length - 1] === n.id && sl.flickend) bdn.flick = true\r\n        bdslides[sl.id].connections.push(bdn)\r\n        if (sl.notes[sl.notes.length - 1] === n.id) {\r\n          bdmap.push(bdslides[sl.id])\r\n          delete bdslides[sl.id]\r\n        }\r\n        break\r\n    }\r\n  }\r\n  bdmap.sort((a, b) => {\r\n    const beatA = a.type === \"Slide\" ? a.connections[0].beat : a.beat\r\n    const beatB = b.type === \"Slide\" ? b.connections[0].beat : b.beat\r\n    if (a.type === \"BPM\" || b.type === \"BPM\" || beatA !== beatB) return beatA - beatB\r\n    const laneA = a.type === \"Slide\" ? a.connections[0].lane : a.lane\r\n    const laneB = b.type === \"Slide\" ? b.connections[0].lane : b.lane\r\n    return laneA - laneB\r\n  })\r\n  return format(bdmap)\r\n}\r\n\r\n","import React from \"react\"\r\nimport Dialog from \"@material-ui/core/Dialog\"\r\nimport { observable, action } from \"mobx\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\"\r\nimport DialogContent from \"@material-ui/core/DialogContent\"\r\nimport DialogActions from \"@material-ui/core/DialogActions\"\r\nimport Button from \"@material-ui/core/Button\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport DialogContentText from \"@material-ui/core/DialogContentText\"\r\n\r\n\r\nconst dialog = observable({\r\n  open: false,\r\n  title: \"\",\r\n  content: \"\",\r\n  confirm: () => { }\r\n})\r\n\r\nexport const openConfirm = action((title: string, content: string, confirm: () => void) => {\r\n  dialog.open = true\r\n  dialog.content = content\r\n  dialog.title = title\r\n  dialog.confirm = confirm\r\n})\r\n\r\nconst ConfirmDialog = () => {\r\n\r\n  const { t } = useTranslation()\r\n\r\n  return useObserver(() =>\r\n    <Dialog open={dialog.open} onClose={() => dialog.open = false}>\r\n      <DialogTitle>{dialog.title}</DialogTitle>\r\n      <DialogContent>\r\n        <DialogContentText>{dialog.content}</DialogContentText>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={() => dialog.open = false} color=\"primary\" autoFocus>\r\n          {t(\"Cancel\")}\r\n        </Button>\r\n        <Button onClick={() => { dialog.confirm(); dialog.open = false }} color=\"secondary\">\r\n          {t(\"Reset\")}\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog >)\r\n}\r\n\r\nexport default ConfirmDialog","import { Timepoint, Slide, NoteType, FreshTimepointCache, SingleNote, FlickNote, SlideNote, EditMap } from \"../MappingScope/EditMap\"\r\nimport { randomId } from \"../Common/utils\"\r\n\r\nfunction getTimepoint(items: string[]): Timepoint {\r\n  const time = parseFloat(items[1])\r\n  const bpm = parseFloat(items[2])\r\n  const bpb = parseInt(items[3])\r\n  return { time, bpm, bpb, id: randomId(), ticktimecache: 0 }\r\n}\r\n\r\nfunction getPos(item: string) {\r\n  const parts = item.split(\":\")\r\n  const offset = parseInt(parts[0]) * 2\r\n  const lane = parseInt(parts[1])\r\n  return { offset, lane }\r\n}\r\n\r\nfunction getSingle(items: string[], timepoint: number): SingleNote {\r\n  return { type: \"single\", id: randomId(), timepoint, ...getPos(items[1]), realtimecache: 0 }\r\n}\r\n\r\nfunction getFlick(items: string[], timepoint: number): FlickNote {\r\n  return { type: \"flick\", id: randomId(), timepoint, ...getPos(items[1]), realtimecache: 0 }\r\n}\r\n\r\nfunction getSlideNotes(items: string[], timepoint: number): [Slide, SlideNote[]] {\r\n  const slide: Slide = { id: randomId(), flickend: items[1] === \"1\", notes: [] }\r\n  const notes: SlideNote[] = []\r\n  for (let i = 2; i < items.length; i++) {\r\n    const n: SlideNote = { type: \"slide\", id: randomId(), timepoint, ...getPos(items[i]), realtimecache: 0, slide: slide.id }\r\n    slide.notes.push(n.id)\r\n    notes.push(n)\r\n  }\r\n  return [slide, notes]\r\n}\r\n\r\nexport function fromBBBv1Format(content: string): EditMap {\r\n  const lines = content.split(/\\r?\\n/).map(x => x.trim()).filter(x => x)\r\n  const timepoints: Timepoint[] = []\r\n  const slides: Slide[] = []\r\n  const notes: NoteType[] = []\r\n  let lasttp!: Timepoint\r\n  for (const line of lines) {\r\n    const items = line.split(\"|\")\r\n    switch (items[0]) {\r\n      case \"+\": {\r\n        lasttp = getTimepoint(items)\r\n        FreshTimepointCache(lasttp)\r\n        timepoints.push(lasttp)\r\n        break\r\n      }\r\n      case \"s\": {\r\n        notes.push(getSingle(items, lasttp.id))\r\n        break\r\n      }\r\n      case \"f\": {\r\n        notes.push(getFlick(items, lasttp.id))\r\n        break\r\n      }\r\n      case \"l\": {\r\n        const [s, ns] = getSlideNotes(items, lasttp.id)\r\n        slides.push(s)\r\n        notes.push(...ns)\r\n        break\r\n      }\r\n    }\r\n  }\r\n  return EditMap.fromJson(JSON.stringify({ timepoints, slides, notes }))\r\n}","import React from \"react\"\r\nimport Grid from \"@material-ui/core/Grid\"\r\nimport {useTranslation} from \"react-i18next\"\r\nimport Button from \"@material-ui/core/Button\"\r\nimport {openDialog} from \"./CopyDialog\"\r\nimport {userMessage} from \"../../../Common/Components/GlobalSnackbar\"\r\nimport {toBestdoriFormat} from \"../../../MapFormats/bestdori\"\r\nimport {scope} from \"../../../MappingScope/scope\"\r\nimport {openConfirm} from \"./ConfirmDialog\"\r\nimport {openFile, downLoadFile} from \"../../../Common/utils\"\r\nimport {fromBBBv1Format} from \"../../../MapFormats/bbbv1\"\r\nimport {EditMap} from \"../../../MappingScope/EditMap\"\r\nimport i18n from \"../../../i18n\"\r\nimport {Music} from \"../../../MappingPage/states\"\r\n\r\nconst importBBBv1 = async () => {\r\n    try {\r\n        const content = await openFile(\"*\")\r\n        scope.reset(fromBBBv1Format(content))\r\n        userMessage(i18n.t(\"Import success\"), \"success\")\r\n    } catch (error) {\r\n        if (!error) return\r\n        userMessage(i18n.t(\"Error import\"), \"error\")\r\n        throw error\r\n    }\r\n}\r\n\r\nconst exportBestdori = () => {\r\n    try {\r\n        const content = toBestdoriFormat((scope.map as any).state)\r\n        openDialog(i18n.t(\"Export Bestdori format map\"), content)\r\n    } catch (error) {\r\n        openDialog(i18n.t(\"An error occurred during export\"), i18n.t(\"\" + error))\r\n        userMessage(i18n.t(\"Error export\"), \"error\")\r\n        throw error\r\n    }\r\n}\r\n\r\nconst reset = () => {\r\n    openConfirm(\r\n        i18n.t(\"Are you sure to reset current map?\"),\r\n        i18n.t(\"This action can not be reverted. Please make sure you have backed up your map.\"),\r\n        () => {\r\n            scope.reset()\r\n            userMessage(i18n.t(\"Reset success\"), \"success\")\r\n        })\r\n}\r\n\r\nconst exportEditorMap = () => {\r\n    const content = EditMap.toJsonString(scope.map as any)\r\n    downLoadFile(content)\r\n}\r\n\r\nconst importEditorMap = async () => {\r\n    try {\r\n        const content = await openFile(\"*\")\r\n        scope.reset(EditMap.fromJson(content))\r\n        userMessage(i18n.t(\"Import success\"), \"success\")\r\n    } catch (error) {\r\n        if (!error) return\r\n        userMessage(i18n.t(\"Error import\"), \"error\")\r\n        throw error\r\n    }\r\n}\r\n\r\nlet uploading = false;\r\n\r\nconst upload = async () => {\r\n    let onProcess = false;\r\n    try {\r\n        if (uploading) throw new Error('There is already a chart being uploaded')\r\n        onProcess = true;\r\n        uploading = true;\r\n        if (!Music.musicfile) throw new Error('No audio import')\r\n        userMessage(i18n.t('Uploading audio'), 'info')\r\n        const axios = require('axios');\r\n        const fileObj = new FormData();\r\n        fileObj.append('file', Music.musicfile as Blob);\r\n        let uploadMusicResult = (await axios.post('https://editor.reikohaku.fun/test/upload/music', fileObj, {\r\n            headers: {\r\n                'Content-Type': 'multipart/form-data'\r\n            }\r\n        })).data;\r\n        if (!uploadMusicResult.result) throw new Error(uploadMusicResult.error);\r\n        userMessage(i18n.t('Uploading chart'), 'info')\r\n        let uploadChartResult =\r\n            (await axios.post('https://editor.reikohaku.fun/test/upload/chart', (scope.map as any).state, {\r\n                params: {\r\n                    title: encodeURI(scope.meta.name),\r\n                    audio: uploadMusicResult.id\r\n                }\r\n            })).data;\r\n        if (!uploadChartResult.result) throw new Error(uploadChartResult.error);\r\n        uploading = false;\r\n        userMessage(i18n.t('Upload successfully', {id: uploadChartResult.id}), 'success')\r\n        openDialog(i18n.t(\"Test in BanG Player\"), i18n.t(\"Test Tips\", {id: uploadChartResult.id}), `${uploadChartResult.id}`);\r\n    } catch (error) {\r\n        if (onProcess) uploading = false;\r\n        if (!error) return\r\n        userMessage(i18n.t(error.message), \"error\")\r\n        throw error\r\n    }\r\n}\r\n\r\nconst Actions = () => {\r\n    const [uploadAyaTitle, setUploadAyaTitle] = React.useState(\"Upload to Aya Sonolus server\");\r\n    const [uploadingAya, setUploadingAya] = React.useState(false);\r\n    const {t} = useTranslation()\r\n\r\n    const uploadToAyaSonolus = async () => {\r\n        try {\r\n            setUploadingAya(true)\r\n            const notes = JSON.parse(toBestdoriFormat((scope.map as any).state))\r\n            if (!Music.musicfile) throw new Error('No audio import')\r\n            setUploadAyaTitle(\"Uploading audio\")\r\n            userMessage(i18n.t('Uploading audio'), 'info')\r\n            const axios = require('axios');\r\n            const fileObj = new FormData();\r\n            fileObj.append('file', Music.musicfile as Blob);\r\n            let uploadMusicResult = (await axios.post('https://service-mdom0qq6-1300838857.gz.apigw.tencentcs.com/upload', fileObj, {\r\n                headers: {\r\n                    'Content-Type': 'multipart/form-data'\r\n                }\r\n            })).data;\r\n            if (!uploadMusicResult.result) throw new Error(uploadMusicResult.error);\r\n            setUploadAyaTitle(\"Uploading chart\")\r\n            userMessage(i18n.t('Uploading chart'), 'info')\r\n            let uploadChartResult =\r\n                (await axios.post('https://api.ayachan.fun/Sonolus/Upload', {\r\n                    notes,\r\n                    bgm: uploadMusicResult.filename,\r\n                    title: scope.meta.name,\r\n                    \"g-recaptcha-response\": \"77A22C8B6AE99D04\"\r\n                })).data;\r\n            if (!uploadChartResult.result) throw new Error(uploadChartResult.error);\r\n            userMessage(i18n.t('Upload successfully', {id: uploadChartResult.id}), 'success')\r\n            openDialog(i18n.t(\"Test in Aya Sonolus Server\"), i18n.t(\"Test Tips of Aya Sonolus Server\", {id: uploadChartResult.id}), `${uploadChartResult.id}`);\r\n        } catch (error) {\r\n            userMessage(i18n.t(error.message), \"error\")\r\n            throw error\r\n        } finally {\r\n            setUploadingAya(false)\r\n            setUploadAyaTitle(\"Upload to Aya Sonolus server\")\r\n        }\r\n    }\r\n\r\n\r\n    return (\r\n        <Grid style={{margin: \"20px 0\"}} item container direction=\"column\" spacing={2}>\r\n            <Grid item>\r\n                <Button fullWidth variant=\"outlined\" onClick={importBBBv1}>\r\n                    {t(\"Import bangbangboom format v1 (current map will loss)\")}\r\n                </Button>\r\n            </Grid>\r\n            <Grid item>\r\n                <Button fullWidth variant=\"outlined\" onClick={exportBestdori}>\r\n                    {t(\"Export Bestdori format map\")}\r\n                </Button>\r\n            </Grid>\r\n            <Grid item>\r\n                <Button fullWidth variant=\"outlined\" onClick={exportEditorMap}>\r\n                    {t(\"Download editor format map\")}\r\n                </Button>\r\n            </Grid>\r\n            <Grid item>\r\n                <Button fullWidth variant=\"outlined\" onClick={importEditorMap}>\r\n                    {t(\"Import editor format map (current map will loss)\")}\r\n                </Button>\r\n            </Grid>\r\n            <Grid item>\r\n                <Button fullWidth variant=\"outlined\" onClick={reset}>\r\n                    {t(\"Reset current map\")}\r\n                </Button>\r\n            </Grid>\r\n            <Grid item>\r\n                <Button fullWidth variant=\"outlined\" disabled={true} onClick={upload}>\r\n                    {t(\"Upload to test server\")}\r\n                </Button>\r\n            </Grid>\r\n            <Grid item>\r\n                <Button fullWidth variant=\"outlined\" disabled={uploadingAya} onClick={uploadToAyaSonolus}>\r\n                    {t(uploadAyaTitle)}\r\n                </Button>\r\n            </Grid>\r\n        </Grid>)\r\n}\r\n\r\nexport default Actions\r\n","import React, { forwardRef, useState, useCallback, useMemo } from \"react\"\r\nimport TextField, { TextFieldProps } from \"@material-ui/core/TextField\"\r\n\r\nexport type FileInputProps = { accept?: string, multiple?: boolean, onFileSelected?: (f: File[]) => any } & TextFieldProps\r\n\r\nconst FileField = forwardRef<HTMLDivElement, FileInputProps>((props, ref) => {\r\n\r\n  const {\r\n    onFileSelected,\r\n    inputProps,\r\n    multiple = false,\r\n    accept,\r\n    value = \"\",\r\n    ...others\r\n  } = props\r\n\r\n  const [display, setDisplay] = useState(value)\r\n\r\n  const handleChange = useCallback((input: HTMLInputElement, onSelected?: (f: File[]) => any) => {\r\n    if (input.files && input.files.length) {\r\n      const fs = Array.from(input.files)\r\n      setDisplay(fs.map(f => f.name).join(\", \"))\r\n      if (onSelected) onSelected(fs)\r\n    }\r\n  }, [])\r\n\r\n  const input = useMemo(() => {\r\n    const i = document.createElement(\"input\")\r\n    i.type = \"file\"\r\n    return i\r\n  }, [])\r\n\r\n  const handleClick = () => {\r\n    input.accept = accept || \"*\"\r\n    input.multiple = multiple\r\n    input.onchange = () => handleChange(input, onFileSelected)\r\n    input.click()\r\n  }\r\n  return (\r\n    <TextField {...others} ref={ref}\r\n      inputProps={{\r\n        ...inputProps,\r\n        onClick: handleClick,\r\n      }}\r\n      value={display} />)\r\n})\r\n\r\nexport default FileField","import React from \"react\"\r\nimport Grid from \"@material-ui/core/Grid\"\r\nimport AttachFileIcon from '@material-ui/icons/AttachFile'\r\nimport QueueMusicIcon from '@material-ui/icons/QueueMusic'\r\nimport FileField from \"../../../Common/Components/FileField\"\r\nimport { Music, Background } from \"../../states\"\r\nimport { userMessage } from \"../../../Common/Components/GlobalSnackbar\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\nimport { scope } from \"../../../MappingScope/scope\"\r\nimport TextField from \"@material-ui/core/TextField\"\r\nimport i18n from \"../../../i18n\"\r\n\r\nconst FileFieldWrapper = ({ children }: { children: React.ReactNode }) => {\r\n  return (\r\n    <Grid item container spacing={2} alignItems=\"flex-end\">\r\n      <Grid item><AttachFileIcon /></Grid>\r\n      <Grid item xs>\r\n        {children}\r\n      </Grid>\r\n    </Grid>)\r\n}\r\n\r\nconst MapName = () => {\r\n\r\n  const { t } = useTranslation()\r\n\r\n  return useObserver(() =>\r\n    <Grid item container spacing={2} alignItems=\"flex-end\">\r\n      <Grid item><QueueMusicIcon /></Grid>\r\n      <Grid item xs>\r\n        <TextField fullWidth label={t(\"Map name\")} value={scope.meta.name}\r\n          onChange={e => scope.meta.name = e.target.value} />\r\n      </Grid>\r\n    </Grid>)\r\n}\r\n\r\n\r\nlet musicfilename = \"\"\r\nconst selectM = (files: File[]) => {\r\n  musicfilename = files[0].name\r\n  Music.load(files[0],\r\n    () => userMessage(i18n.t(\"Load failed\"), \"error\"),\r\n    () => userMessage(i18n.t(\"Load success\"), \"success\"))\r\n}\r\nconst SelectMusic = () => {\r\n  const { t } = useTranslation()\r\n\r\n  return (\r\n    <FileFieldWrapper>\r\n      <FileField fullWidth value={musicfilename} label={t(\"Load music\")}\r\n        accept=\"audio/*\" onFileSelected={selectM} />\r\n    </FileFieldWrapper>)\r\n}\r\n\r\nlet backgroundfilename = \"\"\r\nconst selectBg = (files: File[]) => {\r\n  backgroundfilename = files[0].name\r\n  const src = URL.createObjectURL(files[0])\r\n  Background.src = src\r\n}\r\nconst SelectBackground = () => {\r\n  const { t } = useTranslation()\r\n\r\n  return (\r\n    <FileFieldWrapper>\r\n      <FileField fullWidth value={backgroundfilename} label={t(\"Load background\")}\r\n        accept=\"image/*\" onFileSelected={selectBg} />\r\n    </FileFieldWrapper>)\r\n}\r\n\r\nconst Inputs = () => <>\r\n  <MapName />\r\n  <SelectMusic />\r\n  <SelectBackground />\r\n</>\r\n\r\nexport default Inputs","import React from \"react\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\nimport Grid from \"@material-ui/core/Grid\"\r\nimport CopyDialog from \"./CopyDialog\"\r\nimport Actions from \"./Actions\"\r\nimport ConfirmDialog from \"./ConfirmDialog\"\r\nimport Inputs from \"./Inputs\"\r\nimport Typography from \"@material-ui/core/Typography\"\r\nimport Link from \"@material-ui/core/Link\"\r\nimport Box from \"@material-ui/core/Box\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport { scope } from \"../../../MappingScope/scope\"\r\n\r\nconst useStyles = makeStyles(() => ({\r\n  panel: { width: \"100%\", maxWidth: 600, margin: \"64px auto\", },\r\n}))\r\n\r\nconst Links = () =>\r\n  <Grid item>\r\n    <Typography align=\"right\" color=\"textSecondary\">\r\n      <Link target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://bestdori.com\">\r\n        Bestdori\r\n    </Link>&nbsp;|&nbsp;\r\n    <Link target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://cn.bangplayer.live\">\r\n        BanG Player v2 \r\n    </Link>&nbsp;|&nbsp;\r\n    <Link target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://github.com/K024/bangbangboom-editor\">\r\n        About bangbangboom editor & translations\r\n    </Link>\r\n    </Typography>\r\n  </Grid>\r\n\r\nconst Update = () => {\r\n  const { t } = useTranslation()\r\n  const update = useObserver(() => scope.update)\r\n  if (update) return (\r\n    <Grid item>\r\n      <Box p={1} fontWeight=\"fontWeightLight\" fontFamily=\"sans-serif\" fontStyle=\"italic\" textAlign=\"center\">\r\n        {t(\"An update is available. Please close ALL tabs of this site or press Ctrl + F5 reload.\")}</Box>\r\n    </Grid>)\r\n  return null\r\n}\r\n\r\nconst MetaPage = () => {\r\n\r\n  const cn = useStyles()\r\n\r\n  return (\r\n    <Grid className={cn.panel} container direction=\"column\" spacing={4}>\r\n      <Update />\r\n      <Inputs />\r\n      <Actions />\r\n      <Links />\r\n      <CopyDialog />\r\n      <ConfirmDialog />\r\n    </Grid>)\r\n\r\n}\r\n\r\nexport default MetaPage","import { observable, reaction, action } from \"mobx\"\r\nimport { scope } from \"../../../MappingScope/scope\"\r\n\r\n\r\nexport const TimingState = observable({\r\n  bpm: 90,\r\n  bpb: 4,\r\n  time: 0,\r\n\r\n  selected: null as null | number,\r\n\r\n  muteticker: false,\r\n  measuring: false,\r\n\r\n  autoswitchtp: true, // in Timing pad, anim loop\r\n})\r\n\r\nreaction(() => TimingState.selected, action(selected => {\r\n  if (selected !== null) {\r\n    const tp = scope.map.timepoints.get(selected)\r\n    if (!tp) {\r\n      TimingState.selected = null\r\n      return\r\n    }\r\n    TimingState.bpm = tp.bpm\r\n    TimingState.bpb = tp.bpb\r\n    TimingState.time = tp.time\r\n  }\r\n}))\r\n","import React from \"react\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\nimport Grid from \"@material-ui/core/Grid\"\r\nimport Typography from \"@material-ui/core/Typography\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\nimport Table from \"@material-ui/core/Table\"\r\nimport TableHead from \"@material-ui/core/TableHead\"\r\nimport TableRow from \"@material-ui/core/TableRow\"\r\nimport TableCell from \"@material-ui/core/TableCell\"\r\nimport TableBody from \"@material-ui/core/TableBody\"\r\nimport { scope } from \"../../../MappingScope/scope\"\r\nimport { TimeToString } from \"../../../Common/utils\"\r\nimport { TimingState } from \"./sharedState\"\r\nimport Button from \"@material-ui/core/Button\"\r\n\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  table: { maxHeight: \"60vh\", overflow: \"auto\", \"-webkit-overflow-scrolling\": \"touch\" },\r\n  tablerow: { cursor: \"pointer\" }\r\n}))\r\n\r\nconst TimepointTable = () => {\r\n\r\n  const cn = useStyles()\r\n  const { t } = useTranslation()\r\n  return useObserver(() =>\r\n    <Table className={cn.table}>\r\n      <TableHead>\r\n        <TableRow>\r\n          <TableCell>{t(\"Start time\")}</TableCell>\r\n          <TableCell>BPM</TableCell>\r\n          <TableCell>{(t(\"Meter\"))}</TableCell>\r\n        </TableRow>\r\n      </TableHead>\r\n      <TableBody>\r\n        {scope.map.timepointlist.map(tp => (\r\n          <TableRow key={tp.id} selected={tp.id === TimingState.selected} hover\r\n            onClick={() => TimingState.selected = tp.id === TimingState.selected ? null : tp.id}\r\n            classes={{ root: cn.tablerow }}>\r\n            <TableCell>{TimeToString(tp.time)}</TableCell>\r\n            <TableCell>{tp.bpm}</TableCell>\r\n            <TableCell>{tp.bpb}/4</TableCell>\r\n          </TableRow>))}\r\n      </TableBody>\r\n    </Table>)\r\n}\r\n\r\nconst removeTp = () => {\r\n  if (TimingState.selected === null) return\r\n  scope.map.removeTimepoint(TimingState.selected, scope.settings.editor.justify_grid_divisor)\r\n  TimingState.selected = null\r\n}\r\nconst RemoveBtn = () => {\r\n\r\n  const { t } = useTranslation()\r\n\r\n  return useObserver(() =>\r\n    <Button color=\"secondary\" disabled={TimingState.selected === null} onClick={removeTp}>\r\n      {t(\"Remove\")}\r\n    </Button>)\r\n}\r\n\r\nconst LeftPanel = () => {\r\n\r\n  const { t } = useTranslation()\r\n\r\n  return useObserver(() =>\r\n    <Grid item xs={12} sm container spacing={2} direction=\"column\">\r\n      <Grid item><Typography>{t(\"Timepoints\")}</Typography></Grid>\r\n      <Grid item>\r\n        <TimepointTable />\r\n      </Grid>\r\n      <Grid item>\r\n        <RemoveBtn />\r\n      </Grid>\r\n    </Grid>)\r\n}\r\n\r\nexport default LeftPanel","\r\nconst assets = {\r\n  note_flick: \"/assets/mapping/note_flick.png\",\r\n  note_long: \"/assets/mapping/note_long.png\",\r\n  note_normal: \"/assets/mapping/note_normal.png\",\r\n  note_slide_among: \"/assets/mapping/note_slide_among.png\",\r\n  timing_tack: \"/assets/mapping/timing_tack.wav\",\r\n  timing_tick: \"/assets/mapping/timing_tick.wav\",\r\n  perfect: \"/assets/mapping/perfect.mp3\",\r\n  flick: \"/assets/mapping/flick.mp3\",\r\n  long: \"/assets/mapping/long.mp3\",\r\n}\r\n\r\nfor (const k in assets) {\r\n  assets[(k as keyof typeof assets)] = process.env.PUBLIC_URL + assets[(k as keyof typeof assets)]\r\n}\r\n\r\nexport default assets\r\n\r\n","\r\nimport hotkey, { KeyHandler } from \"hotkeys-js\"\r\n\r\nexport function createAnimLoop(fn: (cancel: () => void) => void) {\r\n  let unmounted = false\r\n  const cancel = () => {\r\n    unmounted = true\r\n  }\r\n  const loop = () => {\r\n    if (unmounted) return\r\n    requestAnimationFrame(loop)\r\n    fn(cancel)\r\n  }\r\n  requestAnimationFrame(loop)\r\n  return cancel\r\n}\r\n\r\nexport function addHotkey(key: string, handler: KeyHandler) {\r\n  hotkey(key, handler)\r\n  return function () {\r\n    hotkey.unbind(key, handler)\r\n  }\r\n}\r\n","import { observable } from \"mobx\"\r\n\r\nexport type AssignableCSSProps = Exclude<keyof CSSStyleDeclaration, \"length\" | \"parentRule\">\r\n\r\nconst Calibration = observable({\r\n  counter: 1\r\n})\r\n\r\nsetInterval(() => {\r\n  Calibration.counter++\r\n}, 500)\r\n\r\nexport function stopAnimation(el: HTMLElement, prop: AssignableCSSProps, value: number, unit: string | ((value: number) => string)) {\r\n  el.style[prop] = unit instanceof Function ? unit(value) : value + unit\r\n  el.style.transition = \"none\"\r\n  if (getComputedStyle(el)[prop]) {\r\n    // trigger computation\r\n  }\r\n}\r\n\r\nexport function startAnimation(el: HTMLElement, prop: AssignableCSSProps, from: number, to: number, unit: string | ((value: number) => string), duration: number) {\r\n  el.style[prop] = unit instanceof Function ? unit(from) : from + unit\r\n  el.style.transition = \"none\"\r\n  if (getComputedStyle(el)[prop] && Calibration.counter) {\r\n    // trigger computation, auto collect calibration dependency\r\n  }\r\n  el.style[prop] = unit instanceof Function ? unit(to) : to + unit\r\n  el.style.transition = prop + \" \" + duration + \"s linear\"\r\n}\r\n\r\n","import React from \"react\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\nimport Grid from \"@material-ui/core/Grid\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport Button from \"@material-ui/core/Button\"\r\nimport { TimingState } from \"../sharedState\"\r\nimport { scope } from \"../../../../MappingScope/scope\"\r\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\"\r\nimport Switch from \"@material-ui/core/Switch\"\r\n\r\nconst addtp = () => {\r\n  scope.map.addTimepoint(\r\n    TimingState.time,\r\n    TimingState.bpm,\r\n    TimingState.bpb,\r\n    scope.settings.editor.justify_grid_divisor)\r\n}\r\n\r\nconst settp = () => {\r\n  const selected = TimingState.selected\r\n  if (selected === null) return\r\n  scope.map.moveTimepoint(selected,\r\n    scope.settings.editor.justify_find_nearest,\r\n    scope.settings.editor.justify_grid_divisor,\r\n    TimingState.time,\r\n    TimingState.bpm,\r\n    TimingState.bpb)\r\n}\r\n\r\nexport const changed = () => {\r\n  const selected = TimingState.selected\r\n  if (selected === null) return false\r\n  const tp = scope.map.timepoints.get(selected)\r\n  if (!tp) {\r\n    TimingState.selected = null\r\n    return false\r\n  }\r\n  return tp.bpb !== TimingState.bpb || tp.bpm !== TimingState.bpm || tp.time !== TimingState.time\r\n}\r\n\r\nconst ActionPart = () => {\r\n\r\n  const { t } = useTranslation()\r\n\r\n  return useObserver(() =>\r\n    <Grid item container wrap=\"wrap\" spacing={2}>\r\n      <Grid item xs>\r\n        <Button fullWidth onClick={addtp} disabled={TimingState.selected !== null} color=\"primary\">\r\n          {t(\"Add timepoint\")}\r\n        </Button></Grid>\r\n      <Grid item xs>\r\n        <Button fullWidth onClick={settp} disabled={!changed()} color=\"primary\">\r\n          {t(\"Apply changes\")}\r\n        </Button></Grid>\r\n      <Grid item container style={{ marginTop: 16 }}>\r\n        <FormControlLabel style={{ marginLeft: \"auto\" }}\r\n          control={<Switch checked={TimingState.muteticker}\r\n            onChange={(e, v) => TimingState.muteticker = v} />}\r\n          label={t(\"Mute metronome\")} labelPlacement=\"start\" />\r\n      </Grid>\r\n      <Grid item container>\r\n        <FormControlLabel style={{ marginLeft: \"auto\" }}\r\n          control={<Switch checked={TimingState.autoswitchtp}\r\n            onChange={(e, v) => TimingState.autoswitchtp = v} />}\r\n          label={t(\"Auto switch selected timepoint\")} labelPlacement=\"start\" />\r\n      </Grid>\r\n    </Grid>)\r\n}\r\n\r\nexport default ActionPart","import React, { useEffect, useRef } from \"react\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\nimport assets from \"../../../assets\"\r\nimport { once, range } from \"../../../../Common/utils\"\r\nimport { createAnimLoop } from \"../../../../Common/hooks\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\nimport { TimingState } from \"../sharedState\"\r\nimport { Music } from \"../../../states\"\r\nimport { stopAnimation, startAnimation } from \"../../../../Common/animation\"\r\nimport { AudioSource, loadFromUrl, AudioInstance } from \"../../../../Common/AudioCtx\"\r\nimport { autorun } from \"mobx\"\r\nimport { scope } from \"../../../../MappingScope/scope\"\r\nimport { changed } from \"./ActionPart\"\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  root: {\r\n    display: \"flex\", alignItems: \"center\", height: 80, padding: 10, transform: \"translate(0, 0)\",\r\n    \"&>*\": {\r\n      flexGrow: 1, height: \"100%\", margin: 10, border: \"solid 3px cornflowerblue\", borderRadius: 6, overflow: \"hidden\",\r\n    },\r\n    \"& :first-child\": { borderColor: \"darkorange\", },\r\n    \"&>*>*\": {\r\n      width: \"100%\", height: \"100%\", backgroundColor: \"cornflowerblue\", willChange: \"opacity\", opacity: 0,\r\n    },\r\n    \"& :first-child>*\": { backgroundColor: \"darkorange\", },\r\n  }\r\n}))\r\n\r\nconst sounds = once(() => ({\r\n  tick: AudioSource.from(loadFromUrl(assets.timing_tick)).load(),\r\n  tack: AudioSource.from(loadFromUrl(assets.timing_tack)).load(),\r\n}))\r\n\r\nlet nosounduntil = 0\r\nfunction setsound(tick: boolean, timeoutms: number) {\r\n  if (TimingState.measuring || TimingState.muteticker) return\r\n  const soundtime = performance.now() + timeoutms\r\n  if (soundtime <= nosounduntil) return\r\n  const s = sounds()\r\n  nosounduntil = soundtime + 100 // no sound until 100 ms after sound played\r\n\r\n  new AudioInstance(tick ? s.tick : s.tack).play(timeoutms / 1000)\r\n}\r\n\r\nlet lastbeat = -1\r\nfunction animloop(pads: HTMLDivElement[]) {\r\n\r\n  const pos = Music.position()\r\n  /**\r\n   * only if not measuring and selected a timepoint and playing and no changes on editor\r\n   */\r\n  if (!TimingState.measuring && TimingState.autoswitchtp && TimingState.selected !== null && Music.playing) {\r\n    if (!changed()) {\r\n      const [tp] = scope.map.findTimepoint(pos)\r\n      if (!tp) return\r\n      if (tp.id !== TimingState.selected) {\r\n        TimingState.selected = tp.id\r\n      }\r\n    }\r\n  }\r\n\r\n  const { time, bpm, bpb } = TimingState\r\n  const beattime = 60 / bpm\r\n  const currentBeat = (pos - time) / beattime\r\n  const beatcount = Math.floor(currentBeat)\r\n  const beatoff = currentBeat - beatcount\r\n  const beatnum = beatcount % bpb\r\n\r\n  const realbeattime = beattime / Music.playbackrate\r\n\r\n  if (Music.playing) {\r\n\r\n    let deltabeat = currentBeat - lastbeat\r\n    if (deltabeat > 0.3) {\r\n      // clearsound()\r\n      deltabeat = 0\r\n    }\r\n\r\n    if (beatoff - deltabeat < 0) { // play animation\r\n      for (let i = 0; i < pads.length; i++) {\r\n        if (i === beatnum) {\r\n          startAnimation(pads[i], \"opacity\", 1, 0, \"\", realbeattime / 2)\r\n        } else {\r\n          stopAnimation(pads[i], \"opacity\", 0, \"\")\r\n        }\r\n      }\r\n    }\r\n\r\n    const nexttimems = (1 - beatoff) * realbeattime * 1000\r\n    if (nexttimems < 50)\r\n      setsound(beatnum === bpb - 1, nexttimems)\r\n\r\n\r\n  } else {\r\n    // clearsound()\r\n\r\n    for (let i = 0; i < pads.length; i++) {\r\n      if (i === beatnum) {\r\n        stopAnimation(pads[i], \"opacity\", Math.max(0, (0.5 - beatoff) * 2), \"\")\r\n      } else {\r\n        stopAnimation(pads[i], \"opacity\", 0, \"\")\r\n      }\r\n    }\r\n  }\r\n\r\n  lastbeat = currentBeat\r\n}\r\n\r\nconst TimingPad = () => {\r\n\r\n  const cn = useStyles()\r\n\r\n  const ref = useRef<HTMLDivElement>(null)\r\n  const padcount = useObserver(() => TimingState.bpb)\r\n\r\n  useEffect(() => createAnimLoop(() => {\r\n    if (ref.current) {\r\n      const pads = Array.from(ref.current.children).map(x => x.firstChild as HTMLDivElement)\r\n      animloop(pads)\r\n    }\r\n  }), [])\r\n\r\n  useEffect(() => autorun(() => {\r\n    const s = sounds()\r\n    s.tick.volume = scope.settings.general.effect_volume\r\n    s.tack.volume = scope.settings.general.effect_volume\r\n  }), [])\r\n\r\n  return (\r\n    <div className={cn.root} ref={ref}>\r\n      {range(padcount).map(v =>\r\n        <div key={v}>\r\n          <div></div>\r\n        </div>)}\r\n    </div>)\r\n}\r\n\r\nexport default TimingPad","import React, { useState, useEffect } from \"react\"\r\nimport Button from \"@material-ui/core/Button\"\r\nimport { TimingState } from \"../sharedState\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport { Music } from \"../../../states\"\r\nimport { addHotkey } from \"../../../../Common/hooks\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\n\r\nfunction calcMeasureRaw(taps: number[]) {\r\n  const d = (taps.length / 2) | 0\r\n  let sum = 0\r\n  let i = 0\r\n  for (; i + d < taps.length; i++) {\r\n    sum += taps[i + d] - taps[i]\r\n  }\r\n  const beattime = sum / d / i\r\n  const bpm = 60 / beattime\r\n  sum = 0\r\n  i = 0\r\n  for (; i < taps.length; i++) {\r\n    sum += taps[i] - i * beattime\r\n  }\r\n  const offset = sum / i\r\n  return { bpm, offset }\r\n}\r\n\r\nfunction calcMeasure(taps: number[]) {\r\n  const res = calcMeasureRaw(taps)\r\n  let recalc = false\r\n  const beattime = 60 / res.bpm\r\n  const processed = [taps[0]]\r\n  for (let i = 1; i < taps.length; i++) {\r\n    const current = taps[i]\r\n    const last = processed[processed.length - 1]\r\n    const dt = current - last\r\n    if (dt < beattime * 0.3) {\r\n      recalc = true                 // ignore multi taps in one beat\r\n    } else if (dt > beattime * 1.7) {\r\n      processed.push(last + beattime) // push missed taps\r\n      i--\r\n      recalc = true\r\n    } else {\r\n      processed.push(current)\r\n    }\r\n  }\r\n  if (recalc) return calcMeasureRaw(processed)\r\n  return res\r\n}\r\n\r\nconst state = {\r\n  taps: [] as number[],\r\n  timeoutId: undefined as any,\r\n}\r\n\r\nconst startMeasure = (setLen: (v: number) => void) => {\r\n  const currentpos = Music.position()\r\n\r\n  state.taps.push(currentpos)\r\n  setLen(state.taps.length)\r\n  if (state.taps.length >= 5) {\r\n    const res = calcMeasure(state.taps)\r\n    TimingState.bpm = res.bpm\r\n    TimingState.time = res.offset\r\n  }\r\n  TimingState.measuring = true\r\n\r\n  clearTimeout(state.timeoutId)\r\n  state.timeoutId = setTimeout(() => {\r\n    state.taps.length = 0\r\n    TimingState.measuring = false\r\n    setLen(0)\r\n  }, 3000)\r\n}\r\nconst MeasureBtn = () => {\r\n\r\n  const [length, setLen] = useState(0)\r\n\r\n  useEffect(() => addHotkey(\"t\", () => [\r\n    startMeasure(setLen)\r\n  ]), [])\r\n\r\n  const { t } = useTranslation()\r\n\r\n  return useObserver(() =>\r\n    <Button fullWidth disableRipple onClick={() => startMeasure(setLen)} disabled={!Music.playing}\r\n      title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"t\" })}>\r\n      {!Music.playing\r\n        ? t(\"Play the music to start measure\")\r\n        : length <= 0\r\n          ? t(\"Click here or press 'T' to measure\")\r\n          : length < 5\r\n            ? t(\"More {{ count }} times\", { count: 5 - length })\r\n            : t(\"Keep stable\")}\r\n    </Button>)\r\n}\r\n\r\nexport default MeasureBtn","import React, { useState, forwardRef } from \"react\"\r\nimport TextField, { TextFieldProps } from \"@material-ui/core/TextField\"\r\n\r\nexport type NumberFieldProps = TextFieldProps & {\r\n  number: number,\r\n  validator?: (s: string) => number | boolean,\r\n  numberDisplay?: (v: number) => string,\r\n  onNumberChange?: (e: React.ChangeEvent, v: number) => void\r\n}\r\n\r\nconst NumberField = forwardRef<HTMLDivElement, NumberFieldProps>((props, ref) => {\r\n\r\n  const {\r\n    number,\r\n    validator = (s: string) => /^-?([0-9]+(\\.[0-9]+)?)$/.test(s) && parseFloat(s),\r\n    numberDisplay = (v: number) => v.toString(),\r\n    onNumberChange,\r\n    onBlur: userBlur,\r\n    onChange: userChange,\r\n    ...others\r\n  } = props\r\n\r\n  const propNumberDisplay = numberDisplay(number)\r\n\r\n  const [display, setDisplay] = useState(propNumberDisplay)\r\n  const [valid, setValid] = useState(true)\r\n\r\n  // received new number, should update to new display\r\n  if (valid && validator(propNumberDisplay) !== validator(display))\r\n    setDisplay(propNumberDisplay)\r\n\r\n  const onChange: typeof userChange = e => {\r\n    setDisplay(e.target.value)\r\n    if (userChange) userChange(e)\r\n\r\n    const v = validator(e.target.value)\r\n    if (typeof v === \"number\" && !isNaN(v)) {\r\n      setValid(true)\r\n      if (v !== number && onNumberChange)   // the number is valid and changed\r\n        onNumberChange(e, v)\r\n    } else {\r\n      setValid(false)\r\n    }\r\n  }\r\n\r\n  const onBlur: typeof userBlur = e => {\r\n    if (userBlur) userBlur(e)\r\n    if (!valid) {\r\n      setDisplay(propNumberDisplay)\r\n      setValid(true)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <TextField {...others} ref={ref}\r\n      value={display} onChange={onChange} onBlur={onBlur}\r\n      color={valid ? \"primary\" : \"secondary\"}>\r\n    </TextField>)\r\n})\r\n\r\nexport default NumberField","import React from \"react\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\nimport Grid from \"@material-ui/core/Grid\"\r\nimport NumberField from \"../../../../Common/Components/NumberField\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport { TimingState } from \"../sharedState\"\r\nimport NavigateBeforeIcon from '@material-ui/icons/NavigateBefore'\r\nimport NavigateNextIcon from '@material-ui/icons/NavigateNext'\r\nimport IconButton from \"@material-ui/core/IconButton\"\r\nimport Button from \"@material-ui/core/Button\"\r\nimport { Music } from \"../../../states\"\r\nimport InputAdornment from \"@material-ui/core/InputAdornment\"\r\nimport { TimeToString } from \"../../../../Common/utils\"\r\n\r\nconst movebeat = (beats: number) => {\r\n  TimingState.time += beats * 60 / TimingState.bpm\r\n}\r\n\r\nfunction secondFromString(s: string) {\r\n  if (!/^-?([0-9]+:[0-9]{2}(.[0-9]+)?|[0-9]+(.[0-9]+)?)$/.test(s)) return false\r\n  const cindex = s.indexOf(\":\")\r\n  if (cindex < 0) return parseFloat(s)\r\n  const minutes = parseInt(s.substr(0, cindex))\r\n  const seconds = parseFloat(s.substr(cindex + 1))\r\n  return minutes * 60 + seconds\r\n}\r\n\r\nconst EditPart = () => {\r\n\r\n  const { t } = useTranslation()\r\n\r\n  return useObserver(() =>\r\n    <Grid item container spacing={2}>\r\n      <Grid item xs={12} sm={6}>\r\n        <NumberField fullWidth label={t(\"Time\")}\r\n          numberDisplay={TimeToString} validator={secondFromString}\r\n          number={TimingState.time} onNumberChange={(e, v) => TimingState.time = v} />\r\n      </Grid>\r\n      <Grid item xs={12} container alignItems=\"center\">\r\n        <Grid item>\r\n          <IconButton onClick={() => movebeat(-1)} title={t(\"Backward one beat\")} >\r\n            <NavigateBeforeIcon />\r\n          </IconButton>\r\n          <IconButton onClick={() => movebeat(1)} title={t(\"Forward one beat\")}>\r\n            <NavigateNextIcon />\r\n          </IconButton>\r\n        </Grid>\r\n        <Grid item xs>\r\n          <Button fullWidth onClick={() => TimingState.time = Music.position()}>\r\n            {t(\"Set to current player time\")}\r\n          </Button>\r\n        </Grid>\r\n      </Grid>\r\n      <Grid item xs={12} sm={6}>\r\n        <NumberField fullWidth label=\"BPM\" inputProps={{ type: \"number\", step: \"0.001\" }}\r\n          number={TimingState.bpm}\r\n          onNumberChange={(e, v) => TimingState.bpm = v} />\r\n      </Grid>\r\n      <Grid item xs={12} sm={6}>\r\n        <NumberField\r\n          InputProps={{ endAdornment: <InputAdornment position=\"end\">/ 4</InputAdornment> }}\r\n          fullWidth label={t(\"Meter\")} inputProps={{ type: \"number\", step: \"1\" }}\r\n          number={TimingState.bpb}\r\n          validator={s => /^[0-9]+$/.test(s) && parseInt(s)}\r\n          onNumberChange={(e, v) => TimingState.bpb = v} />\r\n      </Grid>\r\n    </Grid>)\r\n}\r\n\r\nexport default EditPart","import React from \"react\"\r\nimport Grid from \"@material-ui/core/Grid\"\r\nimport Box from \"@material-ui/core/Box\"\r\nimport TimingPad from \"./TimingPad\"\r\nimport MeasureBtn from \"./MeasureBtn\"\r\nimport EditPart from \"./EditPart\"\r\nimport ActionPart from \"./ActionPart\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\nimport { scope } from \"../../../../MappingScope/scope\"\r\nimport { useTranslation } from \"react-i18next\"\r\n\r\nconst DelayNotice = () => {\r\n  const { t } = useTranslation()\r\n  return useObserver(() => {\r\n    if (scope.settings.editor.keep_pitch)\r\n      return (\r\n        <Grid item>\r\n          <Box p={1} fontWeight=\"fontWeightLight\" fontFamily=\"sans-serif\" fontStyle=\"italic\" textAlign=\"center\">\r\n            {t(\"Some unstable delay may be caused by setting \\\"Keep pitch\\\"\")}</Box>\r\n        </Grid>)\r\n    return null\r\n  })\r\n}\r\n\r\nconst RightPanel = () => {\r\n\r\n  return (\r\n    <Grid item xs={12} sm container spacing={2} direction=\"column\">\r\n      <Grid item>\r\n        <TimingPad />\r\n      </Grid>\r\n      <DelayNotice />\r\n      <Grid item>\r\n        <MeasureBtn />\r\n      </Grid>\r\n      <EditPart />\r\n      <ActionPart />\r\n    </Grid>)\r\n}\r\n\r\nexport default RightPanel","import React from \"react\"\r\nimport makeStyles from \"@material-ui/core/styles/makeStyles\"\r\nimport Grid from \"@material-ui/core/Grid\"\r\nimport LeftPanel from \"./LeftPanel\"\r\nimport RightPanel from \"./RightPanel\"\r\n\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  timing: { width: \"100%\", maxWidth: 1000, margin: \"32px auto\" },\r\n}))\r\n\r\nconst TimingPage = () => {\r\n\r\n  const cn = useStyles()\r\n\r\n  return (\r\n    <Grid className={cn.timing} container spacing={3}>\r\n      <LeftPanel />\r\n      <RightPanel />\r\n    </Grid>)\r\n}\r\n\r\nexport default TimingPage","import React from \"react\"\r\nimport {makeStyles} from \"@material-ui/core/styles\"\r\nimport {useObserver} from \"mobx-react-lite\"\r\nimport Grid from \"@material-ui/core/Grid\"\r\nimport Typography from \"@material-ui/core/Typography\"\r\nimport {useTranslation} from \"react-i18next\"\r\nimport Slider from \"@material-ui/core/Slider\"\r\nimport {scope} from \"../../../MappingScope/scope\"\r\nimport FormControl from \"@material-ui/core/FormControl\"\r\nimport InputLabel from \"@material-ui/core/InputLabel\"\r\nimport Select from \"@material-ui/core/Select\"\r\nimport MenuItem from \"@material-ui/core/MenuItem\"\r\nimport Divider from \"@material-ui/core/Divider\"\r\nimport Switch from \"@material-ui/core/Switch\"\r\nimport {userMessage} from \"../../../Common/Components/GlobalSnackbar\"\r\nimport FormLabel from \"@material-ui/core/FormLabel\"\r\nimport NumberField from \"../../../Common/Components/NumberField\"\r\nimport i18n from \"../../../i18n\"\r\n\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    panel: {width: \"100%\", maxWidth: 600, margin: \"32px auto\",},\r\n}))\r\n\r\nfunction timeFormat(date: Date) {\r\n    const hh = (date.getHours() + 100).toString().substr(1)\r\n    const mm = (date.getMinutes() + 100).toString().substr(1)\r\n    const ss = (date.getSeconds() + 100).toString().substr(1)\r\n    return `${hh}:${mm}:${ss}`\r\n}\r\n\r\nconst SliderWrapper = (props: { children: React.ReactNode, label: React.ReactNode }) =>\r\n    <Grid item container spacing={2} alignItems=\"center\">\r\n        <Grid component={FormLabel} item style={{width: 150}}>\r\n            <Typography>{props.label}</Typography></Grid>\r\n        <Grid item xs>\r\n            {props.children}\r\n        </Grid>\r\n    </Grid>\r\n\r\nconst SwitchWrapper = (props: { children: React.ReactNode, label: React.ReactNode }) =>\r\n    <Grid component={FormLabel} item container spacing={2} alignItems=\"center\">\r\n        <Grid item xs>\r\n            <Typography>{props.label}</Typography></Grid>\r\n        <Grid item>\r\n            {props.children}\r\n        </Grid>\r\n    </Grid>\r\n\r\nconst General = () => {\r\n    const {t} = useTranslation()\r\n    return useObserver(() => <>\r\n        <Grid item>\r\n            <Typography variant=\"h6\">{t(\"General\")}</Typography>\r\n        </Grid>\r\n        <SliderWrapper label={t(\"Song volume\")}>\r\n            <Slider value={scope.settings.general.song_volume} min={0} max={1} step={0.01} valueLabelDisplay=\"auto\"\r\n                    onChange={(e, v) => scope.settings.general.song_volume = v as number}/>\r\n        </SliderWrapper>\r\n        <SliderWrapper label={t(\"Effect volume\")}>\r\n            <Slider value={scope.settings.general.effect_volume} min={0} max={1} step={0.01} valueLabelDisplay=\"auto\"\r\n                    onChange={(e, v) => scope.settings.general.effect_volume = v as number}/>\r\n        </SliderWrapper>\r\n        <SliderWrapper label={t(\"Background dim\")}>\r\n            <Slider value={scope.settings.general.background_dim} min={0} max={1} step={0.01} valueLabelDisplay=\"auto\"\r\n                    onChange={(e, v) => scope.settings.general.background_dim = v as number}/>\r\n        </SliderWrapper>\r\n        <Grid item>\r\n            <FormControl fullWidth>\r\n                <InputLabel>{t(\"Preferred language (some items maybe missing)\")}</InputLabel>\r\n                <Select value={i18n.language}\r\n                        onChange={e => i18n.changeLanguage(e.target.value as string)}>\r\n                    <MenuItem value=\"en\">English</MenuItem>\r\n                    <MenuItem value=\"zh\"></MenuItem>\r\n                    <MenuItem value=\"ja\"></MenuItem>\r\n                </Select>\r\n            </FormControl>\r\n        </Grid>\r\n    </>)\r\n}\r\n\r\nconst changeKeepPitch = (e: any, v: boolean) => {\r\n    scope.settings.editor.keep_pitch = v\r\n    if (v) {\r\n        userMessage(i18n.t(\"This may cause unstable delay of song.\") + \" \" + i18n.t(\"Please reload the music to activate\"), \"warning\")\r\n    } else {\r\n        userMessage(i18n.t(\"Please reload the music to activate\"), \"warning\")\r\n    }\r\n}\r\n\r\nconst Editor = () => {\r\n    const {t} = useTranslation()\r\n\r\n    return useObserver(() => <>\r\n        <Grid item>\r\n            <Typography variant=\"h6\">{t(\"Editor\")}</Typography>\r\n        </Grid>\r\n        <Grid item container spacing={2}>\r\n            <Grid component={FormLabel} item xs={12}>\r\n                <Typography>\r\n                    {t(\"Auto save interval (minutes, 0 to disable)\")} &nbsp;&nbsp;\r\n                    {t(\"Last save: {{ time }}\", {\r\n                        time: scope.lastSave ? timeFormat(scope.lastSave) : t(\"Never\")\r\n                    })}\r\n                </Typography></Grid>\r\n            <Grid item xs>\r\n                <Slider value={scope.settings.editor.autosave_interval} min={0} max={10} step={0.5}\r\n                        valueLabelDisplay=\"auto\"\r\n                        onChange={(e, v) => scope.settings.editor.autosave_interval = v as number}/>\r\n            </Grid>\r\n        </Grid>\r\n        <SwitchWrapper label={t(\"Keep pitch when changing playback rate\")}>\r\n            <Switch checked={scope.settings.editor.keep_pitch}\r\n                    onChange={changeKeepPitch}/>\r\n        </SwitchWrapper>\r\n        <Grid item>\r\n            <FormControl fullWidth>\r\n                <InputLabel>{t(\"When changes applied, try to keep notes at\")}</InputLabel>\r\n                <Select value={scope.settings.editor.justify_find_nearest ? 1 : 0}\r\n                        onChange={e => scope.settings.editor.justify_find_nearest = !!e.target.value}>\r\n                    <MenuItem value={1}>{t(\"Previous time\")}</MenuItem>\r\n                    <MenuItem value={0}>{t(\"Previous beat\")}</MenuItem>\r\n                </Select>\r\n            </FormControl>\r\n        </Grid>\r\n        <Grid item>\r\n            <FormControl fullWidth>\r\n                <InputLabel>{t(\"Grid divisor (of a quarter) to justify notes when justifying timepoint\")}</InputLabel>\r\n                <Select value={scope.settings.editor.justify_grid_divisor}\r\n                        onChange={e => scope.settings.editor.justify_grid_divisor = e.target.value as number}>\r\n                    <MenuItem value={1}>1 / 1</MenuItem>\r\n                    <MenuItem value={2}>1 / 2</MenuItem>\r\n                    <MenuItem value={3}>1 / 3</MenuItem>\r\n                    <MenuItem value={4}>1 / 4</MenuItem>\r\n                    <MenuItem value={6}>1 / 6</MenuItem>\r\n                    <MenuItem value={8}>1 / 8</MenuItem>\r\n                    <MenuItem value={16}>1 / 16</MenuItem>\r\n                    <MenuItem value={48}>1 / 48</MenuItem>\r\n                </Select>\r\n            </FormControl>\r\n        </Grid>\r\n        <SwitchWrapper label={t(\"Show cursor information in mapping\")}>\r\n            <Switch checked={scope.settings.editor.show_info_window}\r\n                    onChange={(e, v) => scope.settings.editor.show_info_window = v}/>\r\n        </SwitchWrapper>\r\n        <SwitchWrapper label={t(\"Show warning for same position notes\")}>\r\n            <Switch checked={scope.settings.editor.warn_for_same_pos_notes}\r\n                    onChange={(e, v) => scope.settings.editor.warn_for_same_pos_notes = v}/>\r\n        </SwitchWrapper>\r\n    </>)\r\n}\r\nlet v: number\r\nconst Game = () => {\r\n    const {t} = useTranslation()\r\n    return useObserver(() => <>\r\n        <Grid item>\r\n            <Typography variant=\"h6\">{t(\"Game\")}</Typography>\r\n        </Grid>\r\n        <Grid item>\r\n            <FormControl fullWidth>\r\n                <InputLabel>{t(\"Skin\")}</InputLabel>\r\n                <Select value={scope.settings.game.skin}\r\n                        onChange={e => scope.settings.game.skin = e.target.value as string}>\r\n                    <MenuItem value={'default'}></MenuItem>\r\n                    <MenuItem value={'skin04'}>5</MenuItem>\r\n                    <MenuItem value={'persona'}>persona[]</MenuItem>\r\n                    <MenuItem value={'cafe'}></MenuItem>\r\n                    <MenuItem value={'miku'}></MenuItem>\r\n                    <MenuItem value={'maid'}>Re</MenuItem>\r\n                    <MenuItem value={'april_fool'}></MenuItem>\r\n                    <MenuItem value={'coin'}>T</MenuItem>\r\n                </Select>\r\n            </FormControl>\r\n        </Grid>\r\n        <Grid item container spacing={2}>\r\n            <Grid component={FormLabel} item xs={12}>\r\n                <Typography>{t(\"Judge offset (ms, smaller means you have to tap earlier)\")}</Typography></Grid>\r\n            <Grid item xs>\r\n                <Slider value={scope.settings.game.judge_offset} min={-1000} max={1000} step={1}\r\n                        valueLabelDisplay=\"auto\"\r\n                        onChange={(e, v) => scope.settings.game.judge_offset = v as number}/>\r\n            </Grid>\r\n            <Grid item style={{width: 72}}>\r\n                <NumberField inputProps={{type: \"number\", step: \"1\", max: \"1000\", min: \"-1000\"}}\r\n                             number={scope.settings.game.judge_offset}\r\n                             validator={s => /^-?[0-9]+$/.test(s) && (v = parseInt(s), v <= 1000 && v >= -1000 && v)}\r\n                             onNumberChange={(e, v) => scope.settings.game.judge_offset = v}/>\r\n            </Grid>\r\n        </Grid>\r\n        <Grid item container spacing={2}>\r\n            <Grid component={FormLabel} item xs={12}>\r\n                <Typography>{t(\"Visual offset (ms, smaller means notes fall earlier)\")}</Typography></Grid>\r\n            <Grid item xs>\r\n                <Slider value={scope.settings.game.visual_offset} min={-1000} max={1000} step={1}\r\n                        valueLabelDisplay=\"auto\"\r\n                        onChange={(e, v) => scope.settings.game.visual_offset = v as number}/>\r\n            </Grid>\r\n            <Grid item style={{width: 72}}>\r\n                <NumberField inputProps={{type: \"number\", step: \"1\", max: \"1000\", min: \"-1000\"}}\r\n                             number={scope.settings.game.visual_offset}\r\n                             validator={s => /^-?[0-9]+$/.test(s) && (v = parseInt(s), v <= 1000 && v >= -1000 && v)}\r\n                             onNumberChange={(e, v) => scope.settings.game.visual_offset = v}/>\r\n            </Grid>\r\n        </Grid>\r\n        <Grid item container spacing={2}>\r\n            <Grid component={FormLabel} item style={{width: 150}}>\r\n                <Typography>{t(\"Fall speed\")}</Typography></Grid>\r\n            <Grid item xs>\r\n                <Slider value={scope.settings.game.speed} min={1} max={11} step={0.1} valueLabelDisplay=\"auto\"\r\n                        onChange={(e, v) => scope.settings.game.speed = v as number}/>\r\n            </Grid>\r\n            <Grid item style={{width: 72}}>\r\n                <NumberField inputProps={{type: \"number\", step: \"0.1\", max: \"11\", min: \"1\"}}\r\n                             number={scope.settings.game.speed}\r\n                             validator={s => /^[0-9]+(.[0-9]?)?$/.test(s) && (v = parseFloat(s), v <= 11 && v >= 1 && v)}\r\n                             onNumberChange={(e, v) => scope.settings.game.speed = v}/>\r\n            </Grid>\r\n        </Grid>\r\n        <SliderWrapper label={t(\"Resolution\")}>\r\n            <Slider value={scope.settings.game.resolution} min={0.2} max={4} step={0.05} valueLabelDisplay=\"auto\"\r\n                    onChange={(e, v) => scope.settings.game.resolution = v as number}/>\r\n        </SliderWrapper>\r\n        <SliderWrapper label={t(\"Slide bar opacity\")}>\r\n            <Slider value={scope.settings.game.bar_opaciry} min={0} max={1} step={0.01} valueLabelDisplay=\"auto\"\r\n                    onChange={(e, v) => scope.settings.game.bar_opaciry = v as number}/>\r\n        </SliderWrapper>\r\n        <SwitchWrapper label={t(\"Show simultaneous line\")}>\r\n            <Switch checked={scope.settings.game.show_sim_line}\r\n                    onChange={(e, v) => scope.settings.game.show_sim_line = v}/>\r\n        </SwitchWrapper>\r\n        <SwitchWrapper label={t(\"Lane tap effect\")}>\r\n            <Switch checked={scope.settings.game.lane_effect}\r\n                    onChange={(e, v) => scope.settings.game.lane_effect = v}/>\r\n        </SwitchWrapper>\r\n        <SwitchWrapper label={t(\"Mirror\")}>\r\n            <Switch checked={scope.settings.game.mirror}\r\n                    onChange={(e, v) => scope.settings.game.mirror = v}/>\r\n        </SwitchWrapper>\r\n        <SwitchWrapper label={t(\"Rhythm visual assist\")}>\r\n            <Switch checked={scope.settings.game.beat_note}\r\n                    onChange={(e, v) => scope.settings.game.beat_note = v}/>\r\n        </SwitchWrapper>\r\n    </>)\r\n}\r\n\r\n\r\nconst SettingsPage = () => {\r\n\r\n    const cn = useStyles()\r\n\r\n    return (\r\n        <Grid className={cn.panel} container direction=\"column\" spacing={4}>\r\n            <General/>\r\n            <Divider style={{margin: \"32px -24px\", width: \"30%\"}}/>\r\n            <Editor/>\r\n            <Divider style={{margin: \"32px -24px\", width: \"30%\"}}/>\r\n            <Game/>\r\n        </Grid>)\r\n}\r\n\r\nexport default SettingsPage\r\n","import { observable, computed, reaction } from \"mobx\"\r\nimport { Music } from \"../../states\"\r\nimport { scope } from \"../../../MappingScope/scope\"\r\nimport { assert } from \"../../../Common/utils\"\r\nimport { NoteType } from \"../../../MappingScope/EditMap\"\r\n\r\nexport type ToolTypes = \"none\" | \"single\" | \"slide\" | \"delete\"\r\n\r\nconst NoteSig = (n: NoteType) => `${n.timepoint}:${n.offset}:${n.lane}`\r\n\r\nclass State {\r\n\r\n  @observable private _viewposition = 0\r\n\r\n  // some offset that let the progress line can be a little higher than view port bottom\r\n  @computed get viewOffset() { return 100 / this.timeHeightFactor }\r\n\r\n  @computed get viewduration() {\r\n    return Music.duration - this.viewOffset\r\n  }\r\n  getViewposition = () => {\r\n    if (this.tracking) return Music.position() - this.viewOffset\r\n    return this._viewposition\r\n  }\r\n  setViewposition = (v: number) => {\r\n    const offset = this.viewOffset\r\n    if (v < -offset) v = -offset\r\n    if (v > Music.duration - offset) v = Music.duration - 0.05 - offset\r\n    if (this.tracking) Music.seek(v + offset)\r\n    else this._viewposition = v\r\n  }\r\n  @observable tracking = false\r\n  @observable timeHeightFactor = 400\r\n  @observable division = 1\r\n  @observable tool = \"none\" as ToolTypes\r\n\r\n  // we mirror 1. notes layer (and bar layer) 2. action preview layer 3. input event handler\r\n  @observable mirror = false\r\n\r\n  @computed get paddedDuration() {\r\n    return Music.duration * 1.2\r\n  }\r\n\r\n  @computed get samePosNotes() {\r\n    const notes = new Set<number>()\r\n    for (const slide of scope.map.slidelist) {\r\n      let from = assert(scope.map.notes.get(slide.notes[0]))\r\n      for (let i = 1; i < slide.notes.length; i++) {\r\n        const to = assert(scope.map.notes.get(slide.notes[i]))\r\n        if (from.timepoint === to.timepoint && from.offset === to.offset) {\r\n          notes.add(from.id)\r\n          notes.add(to.id)\r\n        }\r\n        from = to\r\n      }\r\n    }\r\n    const set = new Set<string>()\r\n    for (const n of scope.map.notelist) {\r\n      const sig = NoteSig(n)\r\n      if (set.has(sig)) notes.add(n.id)\r\n      set.add(sig)\r\n    }\r\n    return notes\r\n  }\r\n\r\n  @computed get noteListOrdered() {\r\n    return scope.map.notelist.slice().sort((a, b) => a.realtimecache - b.realtimecache)\r\n  }\r\n\r\n  constructor() {\r\n    reaction(() => this.tracking, t => {\r\n      const offset = 100 / this.timeHeightFactor\r\n      if (!t) this._viewposition = Music.position() - offset\r\n    })\r\n  }\r\n}\r\n\r\nexport const MappingState = new State()\r\n\r\nexport function GridD1() {\r\n  const tps = scope.map.timepointlist\r\n  const list: Array<{ time: number; name: string }> = []\r\n  let endtime = 0\r\n  for (let i = 0; i < tps.length; i++) {\r\n    const tp = tps[i]\r\n    endtime = (i < tps.length - 1 ? tps[i + 1].time : Music.duration) - 0.01\r\n    let beat = 1\r\n    while (true) {\r\n      const time = tp.time + tp.ticktimecache * 48 * beat\r\n      if (time >= endtime) break\r\n      const bar = ((beat / tp.bpb) | 0) + 1\r\n      const innerbeat = (beat % tp.bpb) + 1\r\n      list.push({\r\n        time,\r\n        name: `${i + 1}:${bar}:${innerbeat}`\r\n      })\r\n      beat++\r\n    }\r\n  }\r\n  return list\r\n}\r\n\r\n\r\nexport function GridD2() {\r\n  const tps = scope.map.timepointlist\r\n  const list: number[] = []\r\n  let endtime = 0\r\n  for (let i = 0; i < tps.length; i++) {\r\n    const tp = tps[i]\r\n    endtime = (i < tps.length - 1 ? tps[i + 1].time : Music.duration) - 0.01\r\n    let beat = 0\r\n    const offset = tp.ticktimecache * 24\r\n    while (true) {\r\n      const time = tp.time + tp.ticktimecache * 48 * beat + offset\r\n      if (time >= endtime) break\r\n      list.push(time)\r\n      beat++\r\n    }\r\n  }\r\n  return list\r\n}\r\n\r\nexport function GridD3() {\r\n  const tps = scope.map.timepointlist\r\n  const list: number[] = []\r\n  let endtime = 0\r\n  for (let i = 0; i < tps.length; i++) {\r\n    const tp = tps[i]\r\n    endtime = (i < tps.length - 1 ? tps[i + 1].time : Music.duration) - 0.01\r\n    let beat_3 = 1\r\n    while (true) {\r\n      const time = tp.time + tp.ticktimecache * 16 * beat_3\r\n      if (time >= endtime) break\r\n      list.push(time)\r\n      beat_3++\r\n      if (beat_3 % 3 === 0) beat_3++\r\n    }\r\n  }\r\n  return list\r\n}\r\n\r\nexport function GridD4() {\r\n  const tps = scope.map.timepointlist\r\n  const list: number[] = []\r\n  let endtime = 0\r\n  for (let i = 0; i < tps.length; i++) {\r\n    const tp = tps[i]\r\n    endtime = (i < tps.length - 1 ? tps[i + 1].time : Music.duration) - 0.01\r\n    let beat_2 = 0.5\r\n    while (true) {\r\n      const time = tp.time + tp.ticktimecache * 24 * beat_2\r\n      if (time >= endtime) break\r\n      list.push(time)\r\n      beat_2++\r\n    }\r\n  }\r\n  return list\r\n}\r\n","import React, { useEffect } from \"react\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\nimport { MappingState, ToolTypes } from \"./sharedState\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\nimport Box from \"@material-ui/core/Box\"\r\nimport Grid from \"@material-ui/core/Grid\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport RadioGroup from \"@material-ui/core/RadioGroup\"\r\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\"\r\nimport Radio from \"@material-ui/core/Radio\"\r\nimport assets from \"../../assets\"\r\nimport HelpIcon from '@material-ui/icons/Help'\r\nimport ZoomInIcon from '@material-ui/icons/ZoomIn'\r\nimport ZoomOutIcon from '@material-ui/icons/ZoomOut'\r\nimport FormLabel from \"@material-ui/core/FormLabel\"\r\nimport Tooltip from \"@material-ui/core/Tooltip\"\r\nimport FormControl from \"@material-ui/core/FormControl\"\r\nimport InputLabel from \"@material-ui/core/InputLabel\"\r\nimport Select from \"@material-ui/core/Select\"\r\nimport MenuItem from \"@material-ui/core/MenuItem\"\r\nimport IconButton from \"@material-ui/core/IconButton\"\r\nimport Switch from \"@material-ui/core/Switch\"\r\nimport Typography from \"@material-ui/core/Typography\"\r\nimport { addHotkey } from \"../../../Common/hooks\"\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  tools: {\r\n    position: \"relative\", flexGrow: 0.5, flexShrink: 1.5, maxWidth: \"calc(40% - 100px)\", overflowX: \"hidden\", overflowY: \"auto\",\r\n    \"-webkit-overflow-scrolling\": \"touch\",\r\n    \"&>*\": { maxWidth: 300, position: \"absolute\", right: 0, top: 30 }\r\n  },\r\n  toolimg: { width: 80 }\r\n}))\r\n\r\nexport const zoomin = () => {\r\n  let f = MappingState.timeHeightFactor * 1.414\r\n  if (f > 1580) f = 1600\r\n  MappingState.timeHeightFactor = f\r\n}\r\nexport const zoomout = () => {\r\n  let f = MappingState.timeHeightFactor / 1.414\r\n  if (f < 120) f = 100\r\n  MappingState.timeHeightFactor = f\r\n}\r\n\r\nconst SelectTool = () => {\r\n  const cn = useStyles()\r\n  const { t } = useTranslation()\r\n\r\n  useEffect(() => addHotkey(\"1\", () => MappingState.tool = \"none\"), [])\r\n  useEffect(() => addHotkey(\"2\", () => MappingState.tool = \"single\"), [])\r\n  useEffect(() => addHotkey(\"3\", () => MappingState.tool = \"slide\"), [])\r\n  useEffect(() => addHotkey(\"4\", () => MappingState.tool = \"delete\"), [])\r\n\r\n  return useObserver(() =>\r\n    <Grid item>\r\n      <Box display=\"block\" my={2} component={FormLabel}>\r\n        <Grid container alignItems=\"center\" spacing={2}>\r\n          <Grid item>{t(\"Tool\")}</Grid>\r\n          <Grid item>\r\n            <Tooltip placement=\"right\"\r\n              title={<Typography variant=\"body2\">\r\n                {t(\"Double click to switch flick\")} <br />\r\n                {t(\"Right click to delete note(s)\")} <br />\r\n                {t(\"Click the slide bar to add mid note\")} <br />\r\n                {t(\"Hold ctrl and drag to multi-select & copy notes\")}\r\n              </Typography>}>\r\n              <HelpIcon fontSize=\"small\" />\r\n            </Tooltip></Grid>\r\n        </Grid>\r\n      </Box>\r\n      <RadioGroup value={MappingState.tool}\r\n        onChange={(e, v) => MappingState.tool = v as ToolTypes}>\r\n        <FormControlLabel value=\"none\" control={<Radio />}\r\n          label={t(\"None\")} title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"1\" })} />\r\n        <FormControlLabel value=\"single\" control={<Radio />}\r\n          label={<img className={cn.toolimg} src={assets.note_normal} alt=\"Single / Flick\" />}\r\n          title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"2\" })} />\r\n        <FormControlLabel value=\"slide\" control={<Radio />}\r\n          label={<img className={cn.toolimg} src={assets.note_long} alt=\"Slide\" />}\r\n          title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"3\" })} />\r\n        <FormControlLabel value=\"delete\" control={<Radio />}\r\n          label={t(\"Delete\")} title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"4 / Right click\" })} />\r\n      </RadioGroup>\r\n    </Grid>)\r\n}\r\n\r\nconst SelectDivisor = () => {\r\n  const { t } = useTranslation()\r\n  return useObserver(() =>\r\n    <Grid item>\r\n      <FormControl fullWidth>\r\n        <InputLabel>{t(\"Grid divisor (of a quarter note)\")}</InputLabel>\r\n        <Select fullWidth value={MappingState.division}\r\n          onChange={e => MappingState.division = e.target.value as number} >\r\n          <MenuItem value={1}>1 / 1</MenuItem>\r\n          <MenuItem value={2}>1 / 2</MenuItem>\r\n          <MenuItem value={3}>1 / 3</MenuItem>\r\n          <MenuItem value={4}>1 / 4</MenuItem>\r\n          <MenuItem value={6}>1 / 6</MenuItem>\r\n          <MenuItem value={8}>1 / 8</MenuItem>\r\n          <MenuItem value={16}>1 / 16</MenuItem>\r\n          <MenuItem value={48}>1 / 48</MenuItem>\r\n        </Select>\r\n      </FormControl>\r\n    </Grid>)\r\n}\r\n\r\nconst ZoomInOut = () => {\r\n  const { t } = useTranslation()\r\n\r\n  useEffect(() => addHotkey(\"+,=\", zoomin), [])\r\n  useEffect(() => addHotkey(\"-,_\", zoomout), [])\r\n\r\n  useEffect(() => {\r\n    const el = document.getElementById(\"root\")\r\n    const listener = (e: WheelEvent) => {\r\n      if (e.ctrlKey) {\r\n        e.stopPropagation()\r\n        e.preventDefault()\r\n        if (e.deltaY < 0) zoomin()\r\n        else zoomout()\r\n      }\r\n    }\r\n    el?.addEventListener(\"wheel\", listener)\r\n    return () => el?.removeEventListener(\"wheel\", listener)\r\n  }, [])\r\n\r\n  return useObserver(() =>\r\n    <Grid item container spacing={2}>\r\n      <Grid item>\r\n        <IconButton onClick={zoomin} disabled={MappingState.timeHeightFactor > 1580}\r\n          title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"+ / ctrl + wheel\" })}>\r\n          <ZoomInIcon /></IconButton>\r\n      </Grid>\r\n      <Grid item>\r\n        <IconButton onClick={zoomout} disabled={MappingState.timeHeightFactor < 120}\r\n          title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"- / ctrl + wheel\" })}>\r\n          <ZoomOutIcon /></IconButton>\r\n      </Grid>\r\n    </Grid>)\r\n}\r\n\r\nconst OtherTools = () => {\r\n  const { t } = useTranslation()\r\n\r\n  useEffect(() => addHotkey(\"f\", () => MappingState.tracking = !MappingState.tracking), [])\r\n  useEffect(() => addHotkey(\"tab\", (e) => {\r\n    MappingState.mirror = !MappingState.mirror; e.stopPropagation(); e.preventDefault()\r\n  }), [])\r\n\r\n  return useObserver(() =>\r\n    <Grid item container spacing={2}>\r\n      <Grid item>\r\n        <FormControlLabel label={t(\"Follow\")} title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"f\" })}\r\n          control={<Switch checked={MappingState.tracking}\r\n            onChange={(e, v) => MappingState.tracking = v} />} />\r\n      </Grid>\r\n      <Grid item>\r\n        <FormControlLabel label={t(\"Mirror\")} title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"tab\" })}\r\n          control={<Switch checked={MappingState.mirror}\r\n            onChange={(e, v) => MappingState.mirror = v} />} />\r\n      </Grid>\r\n    </Grid>)\r\n}\r\n\r\nconst Tools = () => {\r\n  const cn = useStyles()\r\n  return (\r\n    <Box className={cn.tools}>\r\n      <Grid container spacing={4} direction=\"column\">\r\n        <SelectTool />\r\n        <SelectDivisor />\r\n        <ZoomInOut />\r\n        <OtherTools />\r\n      </Grid>\r\n    </Box>)\r\n}\r\n\r\nexport default Tools","import { makeStyles } from \"@material-ui/core/styles\"\r\n\r\nexport const useStyles = makeStyles(theme => ({\r\n  track: { position: \"relative\", flexGrow: 1, maxWidth: 600, },\r\n  panel: { width: \"100%\", position: \"absolute\", bottom: 0, willChange: \"transform\" },\r\n  layer: { width: \"100%\", height: \"100%\", position: \"absolute\", pointerEvents: \"none\", },\r\n}))\r\n\r\nexport const useNoteStyles = makeStyles(theme => ({\r\n  note: {\r\n    transform: \"translateY(50%) scale(1.2)\", width: \"10%\", position: \"absolute\",\r\n    pointerEvents: \"auto\", minHeight: \"10px\",\r\n  },\r\n  noevent: { pointerEvents: \"none\" },\r\n  slidebar: {\r\n    background: \"greenyellow\", opacity: 0.2, width: \"10%\", position: \"absolute\", pointerEvents: \"auto\",\r\n  },\r\n  selection: {\r\n    position: \"absolute\", pointerEvents: \"none\", background: \"gray\",\r\n    opacity: 0.3, border: \"2px solid rgba(80, 182, 255, 0.8)\"\r\n  }\r\n}))","import { observable, computed, autorun, reaction } from \"mobx\"\r\nimport { MappingState } from \"../sharedState\"\r\nimport { scope } from \"../../../../MappingScope/scope\"\r\nimport { useRef, useEffect } from \"react\"\r\nimport { itemList } from \"../../../../Common/utils\"\r\nimport { NoteType } from \"../../../../MappingScope/EditMap\"\r\n\r\nclass State {\r\n\r\n  @observable pointerClientX = 0\r\n  @observable pointerClientY = 0\r\n\r\n  @observable panelRef: React.MutableRefObject<HTMLDivElement | null> = {\r\n    current: null\r\n  }\r\n\r\n  @computed get pointerTime() {\r\n    const panel = this.panelRef.current\r\n    if (!panel) return 0\r\n    const rect = panel.getBoundingClientRect()\r\n    let res = (rect.bottom - this.pointerClientY) / MappingState.timeHeightFactor\r\n    return res\r\n  }\r\n\r\n  @computed get pointerLeftPercent() {\r\n    const panel = this.panelRef.current\r\n    if (!panel) return -1\r\n    const rect = panel.getBoundingClientRect()\r\n    if (MappingState.mirror)\r\n      return (rect.right - this.pointerClientX) / rect.width * 100\r\n    else\r\n      return (this.pointerClientX - rect.left) / rect.width * 100\r\n  }\r\n\r\n  laneFromLeftPercent = (percent: number) => {\r\n    const left = percent - 15\r\n    if (left < 0) return -1\r\n    if (left >= 70) return -1\r\n    return (left / 10) | 0\r\n  }\r\n\r\n  @computed get pointerLane() {\r\n    return this.laneFromLeftPercent(this.pointerLeftPercent)\r\n  }\r\n\r\n  @computed get pointerBeat() {\r\n    return scope.map.calcNearestPosition(this.pointerTime, MappingState.division)\r\n  }\r\n\r\n  @observable slideNote1Beat: State[\"pointerBeat\"]\r\n  @observable slideNote1Lane = -1\r\n\r\n  @observable preventClick = 0\r\n\r\n  @observable draggingNote = -1\r\n\r\n  @observable selecting = false\r\n  @observable selectingStartTime = 0\r\n  @observable selectingStartLeft = 0\r\n  @observable selectingNotes: number[] = []\r\n\r\n  @observable selectedNotes = new Set<number>()\r\n\r\n  getSelectedNotes = () => {\r\n    const selected = new Set<NoteType>()\r\n    for (const nid of this.selectedNotes) {\r\n      const n = scope.map.notes.get(nid)\r\n      if (n) selected.add(n)\r\n    }\r\n    for (const nid of this.selectingNotes) {\r\n      const n = scope.map.notes.get(nid)\r\n      if (n) selected.add(n)\r\n    }\r\n    return itemList(selected)\r\n  }\r\n\r\n  @computed get draggingSelected() {\r\n    const n = scope.map.notes.get(this.draggingNote)\r\n    if (!n) return false\r\n    return this.selectedNotes.has(n.id)\r\n  }\r\n\r\n  constructor() {\r\n    reaction(() => MappingState.tool, tool => {\r\n      this.slideNote1Beat = undefined\r\n    })\r\n  }\r\n}\r\n\r\nexport const state = new State()\r\n\r\nexport function useMirror() {\r\n\r\n  const layer = useRef<HTMLDivElement>(null)\r\n\r\n  useEffect(() => autorun(() => {\r\n    if (layer.current) {\r\n      if (MappingState.mirror)\r\n        layer.current.style.transform = `scaleX(-1)`\r\n      else\r\n        layer.current.style.transform = `none`\r\n    }\r\n  }), [])\r\n\r\n  return layer\r\n}\r\n","import React from \"react\"\r\n\r\nexport const Cross = (props: React.SVGProps<SVGSVGElement>) => {\r\n  return (\r\n    <svg viewBox=\"0 0 500 500\" {...props}>\r\n      <g stroke={props.color || props.style?.color} strokeWidth=\"20\" fill=\"none\">\r\n        <path d=\"M 0 250 H 500\"></path>\r\n        <path d=\"M 250 0 V 500\"></path>\r\n      </g>\r\n    </svg>)\r\n}\r\n\r\nexport const Rect = (props: React.SVGProps<SVGSVGElement>) => {\r\n  return (\r\n    <svg viewBox=\"0 0 500 200\" {...props}>\r\n      <g stroke={props.color || props.style?.color} strokeWidth=\"40\" fill=\"none\">\r\n        <path d=\"M 0 0 H 500 V 200 H 0 V 0\"></path>\r\n      </g>\r\n    </svg>)\r\n}","import React from \"react\"\r\nimport { useStyles, useNoteStyles } from \"./styles\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\nimport { state, useMirror } from \"./state\"\r\nimport { MappingState } from \"../sharedState\"\r\nimport { Cross, Rect } from \"./SVGs\"\r\nimport { entryList } from \"../../../../Common/utils\"\r\nimport { scope } from \"../../../../MappingScope/scope\"\r\n\r\nconst createStyle = (time: number, lane: number) => {\r\n  return {\r\n    bottom: time * MappingState.timeHeightFactor + \"px\",\r\n    left: lane * 10 + 15 + \"%\"\r\n  }\r\n}\r\n\r\nconst PointerPos = () => {\r\n  const cn = useNoteStyles()\r\n  const style = useObserver(() => {\r\n    if (state.selecting) return\r\n    if (state.pointerLane < 0) return\r\n    const beat = state.pointerBeat\r\n    if (!beat) return\r\n    let color = \"#afafaf\"\r\n    switch (MappingState.tool) {\r\n      case \"single\": color = \"#0088ff\"; break\r\n      case \"slide\": color = \"#00ff88\"; break\r\n      case \"delete\": color = \"#ff4444\"; break\r\n    }\r\n    return {\r\n      ...createStyle(beat.realtime, state.pointerLane), color\r\n    }\r\n  })\r\n  if (!style) return null\r\n  return <Cross className={cn.note + \" \" + cn.noevent} style={style} />\r\n}\r\n\r\nconst SlideNote1 = () => {\r\n  const cn = useNoteStyles()\r\n  const style = useObserver(() => {\r\n    if (!state.slideNote1Beat) return\r\n    const time = state.slideNote1Beat.timepoint.time + state.slideNote1Beat.timepoint.ticktimecache * state.slideNote1Beat.offset\r\n    return {\r\n      ...createStyle(time, state.slideNote1Lane), color: \"#00ff88\"\r\n    }\r\n  })\r\n  if (!style) return null\r\n  return <Rect className={cn.note + \" \" + cn.noevent} style={style} />\r\n}\r\n\r\nconst DragOneNote = () => {\r\n  const cn = useNoteStyles()\r\n  const style = useObserver(() => {\r\n    if (state.draggingNote < 0) return\r\n    if (state.pointerLane < 0) return\r\n    const n = scope.map.notes.get(state.draggingNote)\r\n    if (!n) return\r\n    const beat = state.pointerBeat\r\n    if (!beat) return\r\n    const time = beat.realtime\r\n    if (time === n.realtimecache && state.pointerLane === n.lane) return\r\n    return {\r\n      from: { ...createStyle(n.realtimecache, n.lane), color: \"#a0a0a0\" },\r\n      to: { ...createStyle(time, state.pointerLane), color: \"#e0e0e0\" }\r\n    }\r\n  })\r\n  if (!style) return null\r\n  return <>\r\n    <Rect className={cn.note + \" \" + cn.noevent} style={style.from} />\r\n    <Rect className={cn.note + \" \" + cn.noevent} style={style.to} />\r\n  </>\r\n}\r\n\r\nconst SelectedNotes = () => {\r\n  const cn = useNoteStyles()\r\n  const props = useObserver(() => {\r\n    const className = cn.note + \" \" + cn.noevent\r\n    const map = new Map<number, React.SVGProps<SVGSVGElement>>()\r\n    for (const n of state.getSelectedNotes()) {\r\n      map.set(n.id, {\r\n        key: n.id, style: { ...createStyle(n.realtimecache, n.lane), color: \"rgba(102, 183, 255, 0.8)\" }, className\r\n      })\r\n    }\r\n    return entryList(map).map(x => x[1])\r\n  })\r\n  if (props.length <= 0) return null\r\n  return <>\r\n    {props.map(p => <Rect {...p} />)}\r\n  </>\r\n}\r\n\r\nconst Selection = () => {\r\n  const cn = useNoteStyles()\r\n  const style = useObserver(() => {\r\n    if (!state.selecting) return\r\n    const l1 = state.selectingStartLeft\r\n    const l2 = state.pointerLeftPercent\r\n    const t1 = state.selectingStartTime\r\n    const t2 = state.pointerTime\r\n    return {\r\n      left: Math.min(l1, l2) + \"%\",\r\n      width: Math.abs(l1 - l2) + \"%\",\r\n      bottom: Math.min(t1, t2) * MappingState.timeHeightFactor + \"px\",\r\n      height: Math.abs(t1 - t2) * MappingState.timeHeightFactor + \"px\",\r\n    }\r\n  })\r\n  if (!style) return null\r\n  return <div className={cn.selection} style={style}></div>\r\n}\r\n\r\nconst ActionPreview = () => {\r\n\r\n  const cn = useStyles()\r\n  const layer = useMirror()\r\n\r\n  return (\r\n    <div className={cn.layer} ref={layer}>\r\n      <SlideNote1 />\r\n      <SelectedNotes />\r\n      <DragOneNote />\r\n      <Selection />\r\n      <PointerPos />\r\n    </div>)\r\n}\r\n\r\nexport default ActionPreview","import React from \"react\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\nimport { GridD1, MappingState, GridD2, GridD3, GridD4 } from \"../sharedState\"\r\nimport { Music } from \"../../../states\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\nimport { range, TimeToString } from \"../../../../Common/utils\"\r\nimport { useStyles as useLayerStyle } from \"./styles\"\r\nimport { scope } from \"../../../../MappingScope/scope\"\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  vertline: { borderLeft: \"1.2px solid lightgray\", height: \"100%\", position: \"absolute\", pointerEvents: \"none\" },\r\n  beatline1: {\r\n    position: \"absolute\", textAlign: \"right\", width: \"80%\", right: \"5%\", borderBottom: \"1.2px lightgray solid\",\r\n  },\r\n  subline: { position: \"absolute\", width: \"70%\", left: \"15%\", },\r\n  beatline2: { borderBottom: \"1.2px solid gray\" },\r\n  beatline3: { borderBottom: \"1.2px solid firebrick\" },\r\n  beatline4: { borderBottom: \"1.2px solid darkslateblue\" },\r\n  time: { position: \"absolute\", left: 0 },\r\n  bpm: { position: \"absolute\", right: 0 },\r\n  timepoint: {\r\n    position: \"absolute\", color: \"aquamarine\", width: \"95%\",\r\n    borderBottom: \"1.2px aquamarine solid\", height: \"1.5em\"\r\n  },\r\n}))\r\n\r\nconst bottomstyle = (time: number) => ({ bottom: (MappingState.timeHeightFactor * time) + \"px\" })\r\n\r\nconst vertlines = range(15, 90, 10)\r\n\r\nconst LaneAndTime = () => {\r\n  const cn = useStyles()\r\n\r\n  return useObserver(() => <>\r\n    <>\r\n      {vertlines.map(left =>\r\n        <div key={left} className={cn.vertline} style={{ left: left + \"%\" }} />)}\r\n    </><>\r\n      {range(0, Music.duration, 2).map(time =>\r\n        <div key={time} className={cn.time} style={bottomstyle(time)}>{TimeToString(time)}</div>)}\r\n    </>\r\n  </>)\r\n}\r\n\r\nconst DivisorLines = () => {\r\n\r\n  const cn = useStyles()\r\n\r\n  return useObserver(() => <>\r\n    <>\r\n      {GridD1().map(({ time, name }, index) =>\r\n        <div key={index} className={cn.beatline1} style={bottomstyle(time)}>{name}</div>)}\r\n    </><>\r\n      {MappingState.division % 2 === 0 && GridD2().map((time, index) =>\r\n        <div key={index} className={cn.subline + \" \" + cn.beatline2} style={bottomstyle(time)} />)}\r\n    </><>\r\n      {MappingState.division % 3 === 0 && GridD3().map((time, index) =>\r\n        <div key={index} className={cn.subline + \" \" + cn.beatline3} style={bottomstyle(time)} />)}\r\n    </><>\r\n      {MappingState.division % 4 === 0 && GridD4().map((time, index) =>\r\n        <div key={index} className={cn.subline + \" \" + cn.beatline4} style={bottomstyle(time)} />)}\r\n    </>\r\n  </>)\r\n}\r\n\r\nconst TimepointStart = () => {\r\n\r\n  const cn = useStyles()\r\n\r\n  return useObserver(() => <>\r\n    {scope.map.timepointlist.map(tp =>\r\n      <div className={cn.timepoint} key={tp.id} style={bottomstyle(tp.time)}>\r\n        <div className={cn.time}>{TimeToString(tp.time)}</div>\r\n        <div className={cn.bpm}>{tp.bpm}</div>\r\n      </div>)}\r\n  </>)\r\n}\r\n\r\n\r\nconst GridLayer = () => {\r\n  const cn = useLayerStyle()\r\n  return (\r\n    <div className={cn.layer}>\r\n      <LaneAndTime />\r\n      <DivisorLines />\r\n      <TimepointStart />\r\n    </div>)\r\n}\r\n\r\nexport default GridLayer","import React, { useMemo } from \"react\"\r\nimport { NoteType } from \"../../../../MappingScope/EditMap\"\r\nimport { MappingState } from \"../sharedState\"\r\nimport { useStyles, useNoteStyles } from \"./styles\"\r\nimport assets from \"../../../assets\"\r\nimport { assert, neverHappen } from \"../../../../Common/utils\"\r\nimport { scope } from \"../../../../MappingScope/scope\"\r\nimport { Music } from \"../../../states\"\r\nimport { useMirror, state } from \"./state\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\nimport { action } from \"mobx\"\r\n\r\nlet dragPointer = -1\r\nconst downEventHandler = action((nid: number) => {\r\n  return action((e: React.MouseEvent<HTMLImageElement> | React.TouchEvent<HTMLImageElement>) => {\r\n    e.stopPropagation()\r\n    e.preventDefault()\r\n    const note = assert(scope.map.notes.get(nid))\r\n    if (dragPointer < 0) {\r\n      if (\"buttons\" in e) {\r\n        if (!(e.buttons & 3)) return\r\n        dragPointer = e.button\r\n      } else {\r\n        dragPointer = e.changedTouches[0].identifier\r\n      }\r\n    }\r\n    state.draggingNote = nid\r\n    if (!e.ctrlKey && !state.selectedNotes.has(note.id))\r\n      state.selectedNotes.clear()\r\n    state.slideNote1Beat = undefined\r\n  })\r\n})\r\n\r\nconst handleUp = action((e: MouseEvent | TouchEvent) => {\r\n  if (\"buttons\" in e) {\r\n    if (e.button !== dragPointer) return\r\n  } else {\r\n    if (e.changedTouches[0].identifier !== dragPointer) return\r\n  }\r\n  dragPointer = -1\r\n  if (state.draggingNote >= 0) {\r\n    const note = assert(scope.map.notes.get(state.draggingNote))\r\n    const draggingSelected = state.draggingSelected\r\n    state.draggingNote = -1 // important: after get draggingselected !!!\r\n    if (!state.pointerBeat) return\r\n    if (state.pointerLane < 0) return\r\n    const dt = state.pointerBeat.realtime - note.realtimecache\r\n    const dl = state.pointerLane - note.lane\r\n    if (!dt && !dl) return\r\n\r\n    const before = new Set<number>()\r\n    const copy = e.ctrlKey\r\n    if (copy)\r\n      for (const n of scope.map.notelist) before.add(n.id)\r\n\r\n    if (draggingSelected) {\r\n      if (copy)\r\n        scope.map.copyMany(state.getSelectedNotes(), dt, 0, Music.duration, dl, MappingState.division)\r\n      else\r\n        scope.map.moveMany(state.getSelectedNotes(), dt, 0, Music.duration, dl, MappingState.division)\r\n    } else {\r\n      if (copy)\r\n        scope.map.copyMany([note], dt, 0, Music.duration, dl, MappingState.division)\r\n      else\r\n        scope.map.moveMany([note], dt, 0, Music.duration, dl, MappingState.division)\r\n    }\r\n\r\n    setTimeout(action(() => {\r\n      if (copy && scope.map.notes.size !== before.size) {\r\n        state.selectedNotes.clear()\r\n        for (const n of scope.map.notelist) {\r\n          if (!before.has(n.id)) {\r\n            state.selectedNotes.add(n.id)\r\n          }\r\n        }\r\n      }\r\n    }))\r\n\r\n    state.preventClick++\r\n    setTimeout(() => state.preventClick--, 50)\r\n  }\r\n})\r\nwindow.addEventListener(\"mouseup\", handleUp)\r\nwindow.addEventListener(\"touchend\", handleUp)\r\n\r\nconst removeNote = (note: NoteType) => {\r\n  if (state.selectedNotes.has(note.id)) {\r\n    scope.map.removeNotes(state.getSelectedNotes())\r\n  } else {\r\n    scope.map.removeNotes([note])\r\n  }\r\n}\r\n\r\nconst clickEventHandler = (nid: number) => {\r\n  return (e: React.MouseEvent) => {\r\n    e.stopPropagation()\r\n    e.preventDefault()\r\n    // if (state.preventClick) return\r\n    const note = assert(scope.map.notes.get(nid))\r\n    if (e.ctrlKey) {\r\n      if (state.selectedNotes.has(note.id)) state.selectedNotes.delete(note.id)\r\n      else state.selectedNotes.add(note.id)\r\n    } else {\r\n      switch (MappingState.tool) {\r\n        case \"delete\":\r\n          removeNote(note)\r\n          break\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nconst doubleClickHandler = (nid: number) => {\r\n  return (e: React.MouseEvent) => {\r\n    e.stopPropagation()\r\n    e.preventDefault()\r\n    if (state.preventClick) return\r\n    const note = assert(scope.map.notes.get(nid))\r\n    if (note.type === \"slide\") {\r\n      const s = assert(scope.map.slides.get(note.slide))\r\n      if (note.id === s.notes[s.notes.length - 1])\r\n        scope.map.toggleFlickend(s.id)\r\n    } else {\r\n      scope.map.toggleFlick(note)\r\n    }\r\n  }\r\n}\r\n\r\nconst contextMenuHandler = (nid: number) => {\r\n  return (e: React.MouseEvent<HTMLImageElement>) => {\r\n    e.stopPropagation()\r\n    e.preventDefault()\r\n    if (state.preventClick) return\r\n    const note = assert(scope.map.notes.get(nid))\r\n    removeNote(note)\r\n  }\r\n}\r\n\r\nconst Note = ({ note }: { note: NoteType }) => {\r\n\r\n  const cn = useNoteStyles()\r\n\r\n  const onMouseDown = useMemo(() => downEventHandler(note.id), [note.id])\r\n  const onContextMenu = useMemo(() => contextMenuHandler(note.id), [note.id])\r\n  const onDoubleClick = useMemo(() => doubleClickHandler(note.id), [note.id])\r\n  const onClick = useMemo(() => clickEventHandler(note.id), [note.id])\r\n\r\n  const props = useObserver(() => {\r\n    const left = (note.lane * 10 + 15) + \"%\"\r\n    const bottom = (MappingState.timeHeightFactor * note.realtimecache) + \"px\"\r\n    let src: string\r\n    const n = scope.map.notes.get(note.id)\r\n    if (!n) {\r\n      // something strange with mobx action\r\n      return {}\r\n    }\r\n    switch (note.type) {\r\n      case \"single\": src = assets.note_normal; break\r\n      case \"flick\": src = assets.note_flick; break\r\n      case \"slide\":\r\n        const slide = assert(scope.map.slides.get(note.slide))\r\n        if (note.id === slide.notes[0]) {\r\n          src = assets.note_long\r\n        } else if (note.id === slide.notes[slide.notes.length - 1]) {\r\n          if (slide.flickend)\r\n            src = assets.note_flick\r\n          else\r\n            src = assets.note_long\r\n        } else {\r\n          src = assets.note_slide_among\r\n        }\r\n        break\r\n      default: neverHappen()\r\n    }\r\n    return {\r\n      style: { left, bottom }, src,\r\n      draggable: false, className: cn.note,\r\n      onMouseDown, onContextMenu, onDoubleClick, onClick\r\n    }\r\n  })\r\n\r\n  return <img alt=\"\" {...props} />\r\n}\r\n\r\nconst NotesLayer = () => {\r\n\r\n  const cn = useStyles()\r\n  const layer = useMirror()\r\n\r\n  return useObserver(() =>\r\n    <div className={cn.layer} ref={layer}>\r\n      {scope.map.notelist.map(n => <Note key={n.id} note={n} />)}\r\n    </div>)\r\n}\r\n\r\nexport default NotesLayer","import React, { useRef, useEffect } from \"react\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\nimport { autorun } from \"mobx\"\r\nimport { Music } from \"../../../states\"\r\nimport { startAnimation, stopAnimation } from \"../../../../Common/animation\"\r\nimport { MappingState } from \"../sharedState\"\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  progress: {\r\n    position: \"absolute\", width: \"80%\", left: \"10%\", borderBottom: \"2px solid red\",\r\n    bottom: 0, willChange: \"transform\", opacity: 0.7,\r\n  }\r\n}))\r\n\r\nconst transY = (time: number, viewTime: number) => MappingState.timeHeightFactor * (viewTime - time)\r\n\r\nconst transpx = (t: number) => `translateY(${t}px)`\r\n\r\nconst ProgressLine = () => {\r\n  const cn = useStyles()\r\n  const div = useRef<HTMLDivElement>(null)\r\n\r\n  useEffect(() => autorun(() => {\r\n    if (div.current) {\r\n      const time = Music.position()\r\n      const viewTime = MappingState.getViewposition()\r\n      const current = transY(time, viewTime)\r\n      const target = transY(Music.duration, viewTime)\r\n      if (Music.playing && !MappingState.tracking) {\r\n        startAnimation(div.current, \"transform\", current, target, transpx, Music.remaintime())\r\n      } else {\r\n        stopAnimation(div.current, \"transform\", current, transpx)\r\n      }\r\n    }\r\n  }), [])\r\n\r\n  return <div className={cn.progress} ref={div} />\r\n}\r\n\r\nexport default ProgressLine","import React from \"react\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\nimport { state } from \"./state\"\r\nimport { TimeToString } from \"../../../../Common/utils\"\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  root: { position: \"absolute\", width: 0, left: 0, height: 0, bottom: 0, color: \"lightgray\", userSelect: \"text\" },\r\n  window: {\r\n    position: \"absolute\", width: 100, height: 84, right: \"calc(12px + 3vw)\", bottom: 48, padding: 12,\r\n    background: \"rgba(127, 127, 127, 0.15)\", borderRadius: 4, textAlign: \"right\"\r\n  }\r\n}))\r\n\r\nfunction calcGCD(a: number, b: number) {\r\n  a = a | 0\r\n  b = b | 0\r\n  if (a < 0 || b <= 0) throw new Error(\"Can not get gcd\")\r\n  while (true) {\r\n    const c = (a % b) | 0\r\n    if (c === 0) return b\r\n    a = b\r\n    b = c\r\n  }\r\n}\r\n\r\nconst InfoWindow = () => {\r\n\r\n  const cn = useStyles()\r\n\r\n  const info = useObserver(() => {\r\n    const beat = state.pointerBeat\r\n    if (!beat || beat.offset < 0) return\r\n    const bpb = beat.timepoint.bpb\r\n    const beatcount = (beat.offset / 48) | 0\r\n    let offset = beat.offset % 48\r\n    while (offset < 0) offset += 48\r\n    const gcd = calcGCD(offset, 48)\r\n    return {\r\n      time: beat.realtime,\r\n      name: `${beat.timepointIndex + 1} : ${((beatcount / bpb) | 0) + 1} : ${(beatcount % bpb) + 1}`,\r\n      divide: `${offset / gcd} / ${48 / gcd}`\r\n    }\r\n  })\r\n\r\n  return (\r\n    <div className={cn.root}>\r\n      <div className={cn.window}>\r\n        {info && <>\r\n          <div>{TimeToString(info.time)}</div>\r\n          <div>{info.name}</div>\r\n          <div>{info.divide}</div>\r\n        </>}\r\n      </div>\r\n    </div>)\r\n}\r\n\r\nexport default InfoWindow","import React, { useEffect, useMemo, useState } from \"react\"\r\nimport { NoteType, SlideNote } from \"../../../../MappingScope/EditMap\"\r\nimport { MappingState } from \"../sharedState\"\r\nimport { useStyles, useNoteStyles } from \"./styles\"\r\nimport { autorun } from \"mobx\"\r\nimport { scope } from \"../../../../MappingScope/scope\"\r\nimport { assert } from \"../../../../Common/utils\"\r\nimport { state, useMirror } from \"./state\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\n\r\nconst clickHandler = (slide: number) => {\r\n  return (e: React.MouseEvent<HTMLDivElement>) => {\r\n    const beat = state.pointerBeat\r\n    const lane = state.pointerLane\r\n    if (!beat || lane < 0) return\r\n    e.stopPropagation()\r\n\r\n    scope.map.addSlideMid(slide, beat.timepoint.id, beat.offset, lane)\r\n  }\r\n}\r\n\r\nconst Bar = ({ from, to, layerWidth }: { from: NoteType, to: NoteType, layerWidth: number }) => {\r\n\r\n  const cn = useNoteStyles()\r\n\r\n  const style = useObserver(() => {\r\n    const bottom = from.realtimecache * MappingState.timeHeightFactor\r\n    const top = to.realtimecache * MappingState.timeHeightFactor\r\n    const dh = top - bottom\r\n    const dw = layerWidth * (from.lane - to.lane) * 0.1\r\n    return {\r\n      bottom: bottom + \"px\",\r\n      height: dh + \"px\",\r\n      transform: `skew(${Math.atan2(dw, dh)}rad)`,\r\n      left: (from.lane + to.lane) * 5 + 15 + \"%\",\r\n    }\r\n  })\r\n\r\n  const slide = (from as SlideNote).slide\r\n\r\n  const handler = useMemo(() => clickHandler(slide), [slide])\r\n\r\n  return <div className={cn.slidebar} onClick={handler} style={style}></div>\r\n}\r\n\r\nconst forEachBar = (cb: (from: SlideNote, to: SlideNote) => any) => {\r\n  for (const slide of scope.map.slidelist) {\r\n    let from = assert(scope.map.notes.get(slide.notes[0]))\r\n    for (let i = 1; i < slide.notes.length; i++) {\r\n      const to = assert(scope.map.notes.get(slide.notes[i]))\r\n      cb(from as SlideNote, to as SlideNote)\r\n      from = to\r\n    }\r\n  }\r\n}\r\n\r\nconst BarLayer = () => {\r\n\r\n  const cn = useStyles()\r\n  const layer = useMirror()\r\n  const [layerWidth, setLayerWidth] = useState(100)\r\n\r\n  useEffect(() => {\r\n    const listener = () => state.panelRef.current && setLayerWidth(state.panelRef.current.clientWidth)\r\n    const dispose = autorun(listener)\r\n    window.addEventListener(\"resize\", listener)\r\n    return () => { window.removeEventListener(\"resize\", listener); dispose() }\r\n  }, [])\r\n\r\n  const list = useObserver(() => {\r\n    const list: React.ReactNode[] = []\r\n    forEachBar((from, to) =>\r\n      list.push(<Bar key={from.id + \":\" + to.id} from={from} to={to} layerWidth={layerWidth} />))\r\n    return list\r\n  })\r\n\r\n  return (\r\n    <div className={cn.layer} ref={layer}>\r\n      {list}\r\n    </div>)\r\n}\r\n\r\nexport default BarLayer","import React, { useEffect } from \"react\"\r\nimport { useStyles, useNoteStyles } from \"./styles\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\nimport { useMirror } from \"./state\"\r\nimport { MappingState } from \"../sharedState\"\r\nimport { Rect } from \"./SVGs\"\r\nimport { itemList } from \"../../../../Common/utils\"\r\nimport { scope } from \"../../../../MappingScope/scope\"\r\nimport i18n from \"../../../../i18n\"\r\nimport { userMessage } from \"../../../../Common/Components/GlobalSnackbar\"\r\n\r\nconst WaringRect = ({ noteid }: { noteid: number }) => {\r\n  const cn = useNoteStyles()\r\n  const style = useObserver(() => {\r\n    const note = scope.map.notes.get(noteid)\r\n    if (!note) return\r\n    const time = note.realtimecache\r\n    return {\r\n      bottom: time * MappingState.timeHeightFactor + \"px\",\r\n      left: note.lane * 10 + 15 + \"%\",\r\n      color: \"#ff8800\",\r\n      transform: \"translateY(50%) scale(1.4)\"\r\n    }\r\n  })\r\n  if (!style) return null\r\n  return <Rect className={cn.note + \" \" + cn.noevent} style={style} />\r\n}\r\n\r\nconst WarningLayer = () => {\r\n\r\n  const cn = useStyles()\r\n  const layer = useMirror()\r\n\r\n  const notes = useObserver(() => MappingState.samePosNotes)\r\n\r\n  useEffect(() => {\r\n    if (notes.size > 0)\r\n      userMessage(i18n.t(\"Some notes are in the same position\"), \"warning\")\r\n  }, [notes.size])\r\n\r\n  return (\r\n    <div className={cn.layer} ref={layer}>\r\n      {itemList(notes).map(id => <WaringRect key={id} noteid={id} />)}\r\n    </div>)\r\n}\r\n\r\nexport default WarningLayer","\r\ntype FuncList<T = number> = (index: number) => T\r\n\r\n/**\r\n * find the index to insert the item makes the list still ordered\r\n * @param list    - a function represets the list\r\n * @param listlen - list length\r\n * @param target  - search target\r\n * @returns `[ index, equal ]`\r\n */\r\nexport function binarySearch(list: FuncList, listlen: number, target: number): [number, boolean] {\r\n  let l = 0\r\n  let r = listlen\r\n  if (listlen <= 0) return [0, false]\r\n  if (target < list(l)) return [0, false]\r\n\r\n  while (l < r - 1) {\r\n    const m = ((l + r) / 2) | 0\r\n    const v = list(m)\r\n    if (target < v) r = m\r\n    else if (v < target) l = m\r\n    else return [m + 1, true]\r\n  }\r\n  // l = m   -->   l >= r + 1   --> list(l) not tested equality\r\n  return [l + 1, list(l) === target]\r\n}","import React, { useEffect } from \"react\"\r\nimport { autorun, action } from \"mobx\"\r\nimport { startAnimation, stopAnimation } from \"../../../../Common/animation\"\r\nimport { Music } from \"../../../states\"\r\nimport { MappingState } from \"../sharedState\"\r\nimport ActionPreview from \"./ActionPreview\"\r\nimport GridLayer from \"./GridLayer\"\r\nimport NotesLayer from \"./NotesLayer\"\r\nimport ProgressLine from \"./ProgressLine\"\r\nimport { state } from \"./state\"\r\nimport { useStyles } from \"./styles\"\r\nimport InfoWindow from \"./InfoWindow\"\r\nimport { scope } from \"../../../../MappingScope/scope\"\r\nimport BarLayer from \"./BarLayer\"\r\nimport WarningLayer from \"./WarningLayer\"\r\nimport { binarySearch } from \"../../../../Common/binarySearch\"\r\n\r\nconst transY = (viewTime: number) => `translateY(${MappingState.timeHeightFactor * viewTime}px)`\r\n\r\nconst handleScroll = action((e: React.WheelEvent<HTMLDivElement>) => {\r\n  e.stopPropagation()\r\n  const dt = e.deltaY / MappingState.timeHeightFactor\r\n  const target = MappingState.getViewposition() - dt\r\n  MappingState.setViewposition(target)\r\n})\r\n\r\nconst flushPointerPos = action((e: MouseEvent | TouchEvent) => {\r\n  if (\"buttons\" in e) {\r\n    state.pointerClientX = e.clientX\r\n    state.pointerClientY = e.clientY\r\n  } else {\r\n    const touches = Array.from(e.changedTouches)\r\n    if (touches.length <= 0) return\r\n    state.pointerClientX = touches.reduce((a, b) => a + b.clientX, 0) / touches.length\r\n    state.pointerClientY = touches.reduce((a, b) => a + b.clientY, 0) / touches.length\r\n  }\r\n})\r\n\r\nlet selectPointer = -1\r\nconst handleDown = action((e: MouseEvent | TouchEvent) => {\r\n  e.stopPropagation()\r\n  e.preventDefault()\r\n  if (document.activeElement && \"blur\" in document.activeElement) {\r\n    (document.activeElement as HTMLElement).blur()\r\n  }\r\n  if (selectPointer < 0) {\r\n    if (\"buttons\" in e) {\r\n      if (!(e.buttons & 3)) return\r\n      selectPointer = e.button\r\n    } else {\r\n      selectPointer = e.changedTouches[0].identifier\r\n    }\r\n  }\r\n  flushPointerPos(e)\r\n  state.selectingStartLeft = state.pointerLeftPercent\r\n  state.selectingStartTime = state.pointerTime\r\n  if (!e.ctrlKey) {\r\n    state.selectedNotes.clear()\r\n  }\r\n})\r\nconst stopSelect = action(() => {\r\n  if (!state.selecting) return\r\n  selectPointer = -1\r\n  state.selecting = false\r\n  for (const n of state.selectingNotes)\r\n    state.selectedNotes.add(n)\r\n  state.selectingNotes = []\r\n  state.preventClick++\r\n  setTimeout(() => state.preventClick--, 50)\r\n})\r\nwindow.addEventListener(\"mouseup\", e => {\r\n  if (e.button === selectPointer) stopSelect()\r\n})\r\nwindow.addEventListener(\"touchend\", e => {\r\n  if (e.changedTouches[0].identifier === selectPointer) stopSelect()\r\n})\r\n\r\nconst handleMove = action((e: MouseEvent | TouchEvent) => {\r\n  flushPointerPos(e)\r\n  if (!(\"buttons\" in e) || e.buttons & 3) {\r\n    if (state.draggingNote < 0 && !state.selecting)\r\n      if (Math.abs(state.pointerTime - state.selectingStartTime) > 50 / MappingState.timeHeightFactor\r\n        || Math.abs(state.pointerLeftPercent - state.selectingStartLeft) > 10) {\r\n        state.selecting = true\r\n        state.slideNote1Beat = undefined\r\n      }\r\n  } else {\r\n    if (state.selecting) stopSelect()\r\n  }\r\n  if (state.selecting) {\r\n    const list = MappingState.noteListOrdered\r\n    const start = binarySearch(i => list[i].realtimecache, list.length, state.pointerTime)[0]\r\n    const end = binarySearch(i => list[i].realtimecache, list.length, state.selectingStartTime)[0]\r\n    state.selectingNotes = (list.slice(Math.min(start, end), Math.max(start, end)))\r\n      .filter(x => {\r\n        const left = x.lane * 10 + 20\r\n        const min = Math.min(state.pointerLeftPercent, state.selectingStartLeft)\r\n        const max = Math.max(state.pointerLeftPercent, state.selectingStartLeft)\r\n        if (left >= min && left <= max) return true\r\n        return false\r\n      }).map(x => x.id)\r\n  }\r\n})\r\n\r\nconst handleClick = action((e: React.MouseEvent<HTMLDivElement>) => {\r\n  flushPointerPos(e.nativeEvent)\r\n  e.stopPropagation()\r\n  e.preventDefault()\r\n  if (state.preventClick) return\r\n  const beat = state.pointerBeat\r\n  const lane = state.pointerLane\r\n  if (!beat || lane < 0) return\r\n  switch (MappingState.tool) {\r\n    case \"single\":\r\n      scope.map.addSingle(beat.timepoint.id, beat.offset, lane)\r\n      break\r\n    case \"slide\":\r\n      if (state.slideNote1Beat) {\r\n        scope.map.addSlide(state.slideNote1Beat.timepoint.id, state.slideNote1Beat.offset, state.slideNote1Lane,\r\n          beat.timepoint.id, beat.offset, lane)\r\n        state.slideNote1Beat = undefined\r\n      } else {\r\n        state.slideNote1Beat = beat\r\n        state.slideNote1Lane = lane\r\n      }\r\n      break\r\n    default:\r\n      return\r\n  }\r\n})\r\n\r\nconst Track = () => {\r\n  const cn = useStyles()\r\n\r\n  useEffect(() => autorun(() => {\r\n    if (state.panelRef.current) {\r\n      state.panelRef.current.style.height = (MappingState.paddedDuration * MappingState.timeHeightFactor) + \"px\"\r\n      if (Music.playing && MappingState.tracking) {\r\n        startAnimation(state.panelRef.current, \"transform\", MappingState.getViewposition(),\r\n          MappingState.viewduration, transY, Music.remaintime())\r\n      } else {\r\n        stopAnimation(state.panelRef.current, \"transform\", MappingState.getViewposition(), transY)\r\n      }\r\n    }\r\n  }), [])\r\n\r\n  useEffect(() => {\r\n    window.addEventListener(\"mousedown\", handleDown)\r\n    window.addEventListener(\"mousemove\", handleMove)\r\n    return () => {\r\n      window.removeEventListener(\"mousedown\", handleDown)\r\n      window.removeEventListener(\"mousemove\", handleMove)\r\n    }\r\n  }, [])\r\n\r\n  return (\r\n    <div className={cn.track}>\r\n      <div className={cn.panel} ref={state.panelRef} onWheel={handleScroll} onClick={handleClick}>\r\n        <GridLayer />\r\n        <BarLayer />\r\n        <NotesLayer />\r\n        {scope.settings.editor.warn_for_same_pos_notes && <WarningLayer />}\r\n        <ActionPreview />\r\n      </div>\r\n      {scope.settings.editor.show_info_window && <InfoWindow />}\r\n      <ProgressLine />\r\n    </div>)\r\n}\r\n\r\nexport default Track","import { MappingState, GridD1 } from \"../sharedState\"\r\nimport { range, TimeToString, assert } from \"../../../../Common/utils\"\r\nimport { scope } from \"../../../../MappingScope/scope\"\r\nimport { NoteType } from \"../../../../MappingScope/EditMap\"\r\n\r\nexport const barTimeHeightFactor = 30\r\n\r\nconst getX = (lane: number) => lane * 10 + 15\r\nconst getY = (time: number) => (MappingState.paddedDuration - time) * barTimeHeightFactor\r\n\r\n\r\nfunction drawLine(ctx: CanvasRenderingContext2D, xfrom: number, xto: number, y: number) {\r\n  ctx.beginPath()\r\n  ctx.moveTo(xfrom, y)\r\n  ctx.lineTo(xto, y)\r\n  ctx.stroke()\r\n}\r\nfunction drawBar(ctx: CanvasRenderingContext2D, fromx: number, fromy: number, tox: number, toy: number) {\r\n  ctx.beginPath()\r\n  ctx.lineTo(fromx, fromy)\r\n  ctx.lineTo(fromx + 10, fromy)\r\n  ctx.lineTo(tox + 10, toy)\r\n  ctx.lineTo(tox, toy)\r\n  ctx.fill()\r\n}\r\nfunction drawDiamond(ctx: CanvasRenderingContext2D, x: number, y: number) {\r\n  ctx.beginPath()\r\n  ctx.lineTo(x, y)\r\n  ctx.lineTo(x + 5, y + 3)\r\n  ctx.lineTo(x + 10, y)\r\n  ctx.lineTo(x + 5, y - 3)\r\n  ctx.fill()\r\n}\r\nfunction drawOval(ctx: CanvasRenderingContext2D, x: number, y: number) {\r\n  ctx.beginPath()\r\n  ctx.lineTo(x, y)\r\n  ctx.arcTo(x + 5, y + 5, x + 10, y, 7)\r\n  ctx.arcTo(x + 5, y - 5, x, y, 7)\r\n  ctx.fill()\r\n}\r\nfunction drawCircle(ctx: CanvasRenderingContext2D, x: number, y: number) {\r\n  ctx.beginPath()\r\n  ctx.ellipse(x, y, 5, 5, 0, 0, 2 * Math.PI)\r\n  ctx.fill()\r\n}\r\n\r\nexport const drawScrollBar = (canvas: HTMLCanvasElement) => {\r\n  const ctx = canvas.getContext(\"2d\")\r\n  if (!ctx) return\r\n  const timelist = range(0, MappingState.paddedDuration, 2)\r\n  ctx.clearRect(0, 0, canvas.width, canvas.height)\r\n  ctx.font = \"12px\"\r\n  ctx.lineWidth = 1\r\n\r\n  ctx.strokeStyle = \"gray\"\r\n  for (const t of GridD1()) {\r\n    drawLine(ctx, 15, 85, getY(t.time))\r\n  }\r\n\r\n  ctx.fillStyle = \"aquamarine\"\r\n  ctx.strokeStyle = \"aquamarine\"\r\n  for (const t of scope.map.timepointlist) {\r\n    const y = getY(t.time)\r\n    drawLine(ctx, 0, 100, y)\r\n    ctx.fillText(t.bpm + \"\", 80, y - 3)\r\n  }\r\n\r\n  ctx.fillStyle = \"white\"\r\n  for (const t of timelist) {\r\n    ctx.fillText(TimeToString(t).split(\".\")[0], 0, getY(t) - 3)\r\n  }\r\n\r\n  ctx.fillStyle = \"rgb(173,255,47,0.2)\"\r\n  for (const s of scope.map.slidelist) {\r\n    let from = assert(scope.map.notes.get(s.notes[0]))\r\n    let to: NoteType\r\n    for (let i = 1; i < s.notes.length; i++) {\r\n      to = assert(scope.map.notes.get(s.notes[i]))\r\n      drawBar(ctx, getX(from.lane), getY(from.realtimecache), getX(to.lane), getY(to.realtimecache))\r\n      from = to\r\n    }\r\n  }\r\n\r\n  for (const n of scope.map.notelist) {\r\n    switch (n.type) {\r\n      case \"single\":\r\n        ctx.fillStyle = \"rgba(21,224,225)\"\r\n        drawOval(ctx, getX(n.lane), getY(n.realtimecache))\r\n        break\r\n      case \"flick\":\r\n        ctx.fillStyle = \"rgba(255,59,114)\"\r\n        drawDiamond(ctx, getX(n.lane), getY(n.realtimecache))\r\n        break\r\n      case \"slide\":\r\n        const slide = assert(scope.map.slides.get(n.slide))\r\n        ctx.fillStyle = \"rgba(1,219,1)\"\r\n        if (n.id === slide.notes[0]) {\r\n          drawOval(ctx, getX(n.lane), getY(n.realtimecache))\r\n        } else if (n.id === slide.notes[slide.notes.length - 1]) {\r\n          if (slide.flickend) {\r\n            ctx.fillStyle = \"rgba(255,59,114)\"\r\n            drawDiamond(ctx, getX(n.lane), getY(n.realtimecache))\r\n          } else {\r\n            drawOval(ctx, getX(n.lane), getY(n.realtimecache))\r\n          }\r\n        } else {\r\n          ctx.strokeStyle = \"rgba(1,219,1)\"\r\n          ctx.lineWidth = 2\r\n          const x = getX(n.lane)\r\n          drawLine(ctx, x, x + 10, getY(n.realtimecache))\r\n        }\r\n        break\r\n    }\r\n  }\r\n}\r\n\r\nexport const drawWarning = (canvas: HTMLCanvasElement) => {\r\n  const ctx = canvas.getContext(\"2d\")\r\n  if (!ctx) return\r\n  ctx.fillStyle = \"#ff8800\"\r\n  for (const nid of MappingState.samePosNotes) {\r\n    const n = scope.map.notes.get(nid)\r\n    if (!n) return\r\n    const y = getY(n.realtimecache)\r\n    drawCircle(ctx, 93, y)\r\n  }\r\n}","import { observable, computed } from \"mobx\"\r\nimport { MappingState } from \"../sharedState\"\r\nimport { barTimeHeightFactor } from \"./drawCanvas\"\r\n\r\nclass State {\r\n  @observable containerHeight = 0\r\n  @computed get barHeight() { return MappingState.paddedDuration * barTimeHeightFactor }\r\n  @computed get viewportheight() { return this.containerHeight / MappingState.timeHeightFactor * barTimeHeightFactor }\r\n  \r\n  progressTransY = (playtime: number) => `translateY(${- barTimeHeightFactor * playtime}px)`\r\n  barTransY = (viewtime: number) => {\r\n    const height = this.barHeight\r\n    if (height <= this.containerHeight) return \"\"\r\n    const p = viewtime / MappingState.paddedDuration\r\n    const transx = this.containerHeight * p - height * p\r\n    return `translateY(${-transx}px)`\r\n  }\r\n  viewTransY = (viewtime: number) => {\r\n    let h = this.containerHeight\r\n    if (this.barHeight < this.containerHeight) h = this.barHeight\r\n    const transx = (h * viewtime) / MappingState.paddedDuration\r\n    return `translateY(${-transx}px)`\r\n  }\r\n}\r\n\r\nexport const state = new State()\r\n","import React, { useRef, useEffect } from \"react\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\nimport { autorun } from \"mobx\"\r\nimport { Music } from \"../../../states\"\r\nimport { startAnimation, stopAnimation } from \"../../../../Common/animation\"\r\nimport { state } from \"./state\"\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  progress: {\r\n    position: \"absolute\", width: \"100%\", borderBottom: \"2px solid red\",\r\n    bottom: 0, willChange: \"transform\", opacity: 0.7\r\n  },\r\n}))\r\n\r\nconst ProgressLine = () => {\r\n\r\n  const cn = useStyles()\r\n  const div = useRef<HTMLDivElement>(null)\r\n\r\n  useEffect(() => autorun(() => {\r\n    if (div.current) {\r\n      const current = Music.position()\r\n      if (Music.playing) {\r\n        startAnimation(div.current, \"transform\", current, Music.duration, state.progressTransY, Music.remaintime())\r\n      } else {\r\n        stopAnimation(div.current, \"transform\", current, state.progressTransY)\r\n      }\r\n    }\r\n  }), [])\r\n\r\n  return <div className={cn.progress} ref={div}></div>\r\n}\r\n\r\nexport default ProgressLine","import React, { useRef, useEffect } from \"react\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\nimport { autorun, observable } from \"mobx\"\r\nimport { Music } from \"../../../states\"\r\nimport { startAnimation, stopAnimation } from \"../../../../Common/animation\"\r\nimport { state } from \"./state\"\r\nimport { MappingState } from \"../sharedState\"\r\nimport { drawScrollBar, drawWarning } from \"./drawCanvas\"\r\nimport ProgressLine from \"./ProgressLine\"\r\nimport { scope } from \"../../../../MappingScope/scope\"\r\n\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  bar: { position: \"absolute\", width: \"100%\", bottom: 0, willChange: \"transform\" },\r\n  canvas: { width: \"100%\", height: \"100%\" },\r\n}))\r\n\r\nconst canvas = observable({\r\n  current: null as HTMLCanvasElement | null\r\n})\r\n\r\nautorun(() => {\r\n  if (canvas.current) {\r\n    canvas.current.height = state.barHeight\r\n    drawScrollBar(canvas.current)\r\n    if (scope.settings.editor.warn_for_same_pos_notes)\r\n      drawWarning(canvas.current)\r\n  }\r\n})\r\n\r\nconst Canvas = () => {\r\n  const cn = useStyles()\r\n  const ref = useRef<HTMLCanvasElement>(null)\r\n\r\n  useEffect(() => {\r\n    canvas.current = ref.current\r\n    return () => { canvas.current = null }\r\n  }, [])\r\n\r\n  return <canvas ref={ref} className={cn.canvas} width={100}></canvas>\r\n}\r\n\r\nconst handelMouseTouch = (e: React.MouseEvent<HTMLDivElement> | React.TouchEvent<HTMLDivElement>) => {\r\n  let clientY: number\r\n  if (\"buttons\" in e) {\r\n    if (!(e.buttons & 3)) return\r\n    clientY = e.clientY\r\n  } else {\r\n    clientY = e.changedTouches[0].clientY\r\n  }\r\n\r\n  const target = (e.currentTarget.getBoundingClientRect().bottom - clientY - state.viewportheight / 2)\r\n    / state.barHeight * MappingState.paddedDuration\r\n\r\n  MappingState.setViewposition(target)\r\n}\r\n\r\nconst CanvasBar = () => {\r\n\r\n  const cn = useStyles()\r\n  const bar = useRef<HTMLDivElement>(null)\r\n\r\n  useEffect(() => autorun(() => {\r\n    if (bar.current) {\r\n      bar.current.style.height = state.barHeight + \"px\"\r\n      if (Music.playing && MappingState.tracking) {\r\n        startAnimation(bar.current, \"transform\", MappingState.getViewposition(),\r\n          MappingState.viewduration, state.barTransY, Music.remaintime())\r\n      } else {\r\n        stopAnimation(bar.current, \"transform\", MappingState.getViewposition(), state.barTransY)\r\n      }\r\n    }\r\n  }), [])\r\n\r\n  return (\r\n    <div className={cn.bar} ref={bar} onTouchStart={handelMouseTouch}\r\n      onMouseDown={handelMouseTouch}>\r\n      <Canvas />\r\n      <ProgressLine />\r\n    </div>)\r\n}\r\n\r\nexport default CanvasBar","import React, { useRef, useEffect } from \"react\"\r\nimport { autorun } from \"mobx\"\r\nimport { Music } from \"../../../states\"\r\nimport { startAnimation, stopAnimation } from \"../../../../Common/animation\"\r\nimport { state } from \"./state\"\r\nimport { MappingState } from \"../sharedState\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  viewport: {\r\n    position: \"absolute\", width: \"100%\", backgroundColor: \"#fff\", opacity: 0.2, transition: \"opacity 0.2s\",\r\n    bottom: 0, willChange: \"opacity, transform\", \"&:hover\": { opacity: 0.4 }\r\n  },\r\n}))\r\n\r\nconst touchState = {\r\n  identifier: -1,\r\n  /**\r\n   * the offset from touch/mouse point to the bottom of viewport rectangle\r\n   * positive\r\n   */\r\n  offsetY: 0,\r\n\r\n  container: null as HTMLElement | null\r\n}\r\n\r\nconst handelMouseTouchStart = (e: React.MouseEvent<HTMLDivElement> | React.TouchEvent<HTMLDivElement>) => {\r\n  e.stopPropagation()\r\n  const viewport = e.currentTarget\r\n  const bottom = viewport.getBoundingClientRect().bottom\r\n  if (touchState.identifier < 0) {\r\n    if (\"buttons\" in e) {\r\n      if (!(e.buttons & 3)) return\r\n      touchState.identifier = e.button\r\n      touchState.offsetY = bottom - e.clientY\r\n    } else {\r\n      touchState.identifier = e.changedTouches[0].identifier\r\n      touchState.offsetY = bottom - e.changedTouches[0].clientY\r\n    }\r\n  }\r\n  touchState.container = e.currentTarget.parentElement\r\n}\r\n\r\nconst handleMove = (e: MouseEvent | TouchEvent) => {\r\n  let clientY: number\r\n  if (\"buttons\" in e) {\r\n    if (touchState.identifier !== e.button) return\r\n    clientY = e.clientY\r\n  } else {\r\n    if (touchState.identifier !== e.changedTouches[0].identifier) return\r\n    clientY = e.changedTouches[0].clientY\r\n  }\r\n  if (!touchState.container) return\r\n  e.stopPropagation()\r\n\r\n  const TimeYtoBottom = touchState.container.getBoundingClientRect().bottom - clientY - touchState.offsetY\r\n\r\n  let h = state.containerHeight\r\n  if (state.barHeight < state.containerHeight) h = state.barHeight\r\n\r\n  let target = TimeYtoBottom / h * MappingState.paddedDuration\r\n\r\n  MappingState.setViewposition(target)\r\n}\r\n\r\n\r\nwindow.addEventListener(\"mouseup\", () => touchState.identifier = -1)\r\nwindow.addEventListener(\"mouseleave\", () => touchState.identifier = -1)\r\ndocument.addEventListener(\"mousemove\", handleMove)\r\ndocument.addEventListener(\"touchmove\", handleMove)\r\n\r\nconst ViewPort = () => {\r\n\r\n  const cn = useStyles()\r\n  const div = useRef<HTMLDivElement>(null)\r\n\r\n  useEffect(() => autorun(() => {\r\n    if (div.current) {\r\n      div.current.style.height = state.viewportheight + \"px\"\r\n      if (Music.playing && MappingState.tracking) {\r\n        startAnimation(div.current, \"transform\", MappingState.getViewposition(),\r\n          MappingState.viewduration, state.viewTransY, Music.remaintime())\r\n      } else {\r\n        stopAnimation(div.current, \"transform\", MappingState.getViewposition(), state.viewTransY)\r\n      }\r\n    }\r\n  }), [])\r\n\r\n  return <div className={cn.viewport} ref={div}\r\n    onMouseDown={handelMouseTouchStart}\r\n    onTouchStart={handelMouseTouchStart} />\r\n}\r\n\r\nexport default ViewPort\r\n","import React, { useRef, useEffect } from \"react\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\nimport { state } from \"./state\"\r\nimport CanvasBar from \"./CanvasBar\"\r\nimport ViewPort from \"./ViewPort\"\r\nimport { MappingState } from \"../sharedState\"\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  scrollbar: { position: \"relative\", width: 100 },\r\n}))\r\n\r\nconst handleScroll = (e: React.WheelEvent) => {\r\n  e.stopPropagation()\r\n  const dt = e.deltaY / 100\r\n  const target = MappingState.getViewposition() - dt\r\n  MappingState.setViewposition(target)\r\n}\r\n\r\nconst ScrollBar = () => {\r\n  const cn = useStyles()\r\n  const container = useRef<HTMLDivElement>(null)\r\n\r\n  useEffect(() => {\r\n    const listener = () => container.current && (state.containerHeight = container.current.clientHeight)\r\n    listener()\r\n    window.addEventListener(\"resize\", listener)\r\n    return () => window.removeEventListener(\"resize\", listener)\r\n  }, [])\r\n\r\n\r\n  return (\r\n    <div className={cn.scrollbar} ref={container} onWheel={handleScroll}>\r\n      <CanvasBar />\r\n      <ViewPort />\r\n    </div>)\r\n}\r\n\r\nexport default ScrollBar","import { once, assert, itemList } from \"../../../Common/utils\"\r\nimport { AudioSource, loadFromUrl, AudioInstance } from \"../../../Common/AudioCtx\"\r\nimport assets from \"../../assets\"\r\nimport { useEffect } from \"react\"\r\nimport { MappingState } from \"./sharedState\"\r\nimport { Music } from \"../../states\"\r\nimport { binarySearch } from \"../../../Common/binarySearch\"\r\nimport { createAnimLoop } from \"../../../Common/hooks\"\r\nimport { autorun, observable } from \"mobx\"\r\nimport { scope } from \"../../../MappingScope/scope\"\r\n\r\nconst sounds = once(() => ({\r\n  perfect: AudioSource.from(loadFromUrl(assets.perfect)).load(),\r\n  flick: AudioSource.from(loadFromUrl(assets.flick)).load(),\r\n}))\r\n\r\nconst images = once(() => {\r\n  const list: (keyof typeof assets)[] = [\"note_flick\", \"note_long\", \"note_normal\", \"note_slide_among\"]\r\n  list.forEach(async key => {\r\n    const res = await fetch(assets[key])\r\n    const file = await res.blob()\r\n    assets[key] = URL.createObjectURL(file)\r\n  })\r\n})\r\n\r\nlet noSoundUntil = -1\r\n\r\nconst soundlist = observable({\r\n  get list() {\r\n    return MappingState.noteListOrdered.map(x => {\r\n      if (x.type === \"single\") return { time: x.realtimecache, type: \"single\" }\r\n      if (x.type === \"flick\") return { time: x.realtimecache, type: \"flick\" }\r\n      const slide = assert(scope.map.slides.get(x.slide))\r\n      if (x.id === slide.notes[slide.notes.length - 1] && slide.flickend)\r\n        return { time: x.realtimecache, type: \"flick\" }\r\n      return { time: x.realtimecache, type: \"single\" }\r\n    })\r\n  }\r\n})\r\n\r\nconst toBeStopped = new Set<AudioInstance>()\r\n\r\nfunction animloop() {\r\n  if (Music.playing) {\r\n    const list = soundlist.list\r\n    const position = Music.position()\r\n\r\n    if (list.length <= 0) return\r\n    let [index] = binarySearch(i => list[i].time, list.length, position)\r\n    while (index < list.length && list[index].time <= position) index++\r\n    if (index >= list.length) return\r\n\r\n    const time = list[index].time\r\n    if (time > position + 0.05) return\r\n    if (time < noSoundUntil) return\r\n    noSoundUntil = time + 0.01 * Music.playbackrate\r\n\r\n    const s = sounds()\r\n\r\n    while (index < list.length && list[index].time < noSoundUntil) {\r\n      const au = new AudioInstance(list[index].type === \"single\" ? s.perfect : s.flick)\r\n      au.play((list[index].time - position) / Music.playbackrate)\r\n      au.onend.add(() => toBeStopped.delete(au))\r\n      toBeStopped.add(au)\r\n      index++\r\n    }\r\n\r\n  } else {\r\n    noSoundUntil = -1\r\n    for (const au of itemList(toBeStopped)) {\r\n      au.stop()\r\n    }\r\n    toBeStopped.clear()\r\n  }\r\n}\r\n\r\nautorun(() => {\r\n  if (Music.position()) noSoundUntil = -1\r\n})\r\n\r\nexport function useSoundEffect() {\r\n\r\n  useEffect(() => {\r\n    images()\r\n  }, [])\r\n\r\n  useEffect(() => createAnimLoop(animloop), [])\r\n\r\n  useEffect(() => autorun(() => {\r\n    const s = sounds()\r\n    s.perfect.volume = scope.settings.general.effect_volume\r\n    s.flick.volume = scope.settings.general.effect_volume\r\n  }), [])\r\n}","import React from \"react\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\nimport Box from \"@material-ui/core/Box\"\r\nimport Tools from \"./Tools\"\r\nimport Track from \"./Track\"\r\nimport ScrollBar from \"./ScrollBar\"\r\nimport { useSoundEffect } from \"./soundEffect\"\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  root: {\r\n    position: \"absolute\", width: \"100%\", height: \"100%\", display: \"flex\",\r\n    justifyContent: \"space-between\", alignItems: \"stretch\", overflow: \"hidden\"\r\n  },\r\n}))\r\n\r\n\r\nconst MappingPage = () => {\r\n\r\n  const cn = useStyles()\r\n\r\n  useSoundEffect()\r\n\r\n  return (\r\n    <Box className={cn.root} onContextMenu={e => { e.stopPropagation(); e.preventDefault() }}>\r\n      <Tools />\r\n      <Track />\r\n      <ScrollBar />\r\n    </Box>)\r\n}\r\n\r\nexport default MappingPage","import React from \"react\"\r\nimport Grid from \"@material-ui/core/Grid\"\r\nimport NumberField from \"../../../../Common/Components/NumberField\"\r\nimport {useTranslation} from \"react-i18next\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\n\r\nconst BpmCalculator = () => {\r\n    const [bpm, setBpm] = React.useState(0)\r\n    const [offset, setOffset] = React.useState(0)\r\n    const [insert, setInsert] = React.useState(\"0.000\")\r\n    const [remove, setRemove] = React.useState(\"0.000\")\r\n    const updateResult = (bpm: number, offset: number) => {\r\n        setBpm(bpm)\r\n        setOffset(offset)\r\n        const accurateFloat = (num: number, precision = 15) => parseFloat(num.toPrecision(precision))\r\n        const beat = accurateFloat(bpm / 60 * offset)\r\n        const secondPerBeat = accurateFloat(60 / bpm)\r\n        const up = Math.ceil(beat)\r\n        const down = Math.floor(beat)\r\n        const upTime = accurateFloat(up * secondPerBeat)\r\n        const downTime = accurateFloat(down * secondPerBeat)\r\n        const insert = upTime - offset\r\n        const remove = offset - downTime\r\n        setInsert(isNaN(insert) ? \"0.000\" : insert.toFixed(3))\r\n        setRemove(isNaN(remove) ? \"0.000\" : remove.toFixed(3))\r\n    }\r\n\r\n    const {t} = useTranslation()\r\n\r\n    return (\r\n        <Grid item container spacing={2}>\r\n            <Grid item xs={12}>\r\n                <Typography variant=\"h6\">{t(\"BpmCalculator\")}</Typography>\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <Typography variant=\"caption\">{t(\"BpmCalcTip\")}</Typography>\r\n            </Grid>\r\n            <Grid item xs={12} md={6}>\r\n                <NumberField fullWidth number={bpm} onNumberChange={(e, v) => updateResult(v, offset)} label=\"BPM\" />\r\n            </Grid>\r\n            <Grid item xs={12} md={6}>\r\n                <NumberField fullWidth number={offset} onNumberChange={(e, v) => updateResult(bpm, v)} label=\"Offset\" />\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                { t(\"BpmCalcResult\", { insert, remove }) }\r\n            </Grid>\r\n        </Grid>\r\n    )\r\n}\r\n\r\nexport default BpmCalculator\r\n","import React from \"react\"\r\nimport {makeStyles} from \"@material-ui/core/styles\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport BpmCalculator from \"./BpmCalculator\";\r\nimport Link from \"@material-ui/core/Link\";\r\nimport {useTranslation} from \"react-i18next\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\n\r\nconst useStyles = makeStyles(() => ({\r\n    panel: { width: \"100%\", maxWidth: 600, margin: \"64px auto\", },\r\n}))\r\n\r\nconst ToolsPage = () => {\r\n    const cn = useStyles()\r\n    const {t} = useTranslation()\r\n\r\n    const BestdoriChartChecker = () =>\r\n        <Grid item container spacing={2}>\r\n            <Grid item xs={12}>\r\n                <Typography variant=\"h6\">{t(\"Others\")}</Typography>\r\n            </Grid>\r\n            <Grid item xs={12}>\r\n                <Link target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://check.bestdori.sayobot.tech/\">\r\n                    { t(\"BestdoriChartCheck\") }\r\n                </Link>\r\n            </Grid>\r\n        </Grid>\r\n\r\n    return (\r\n        <Grid className={cn.panel} container direction=\"column\" spacing={4}>\r\n            <BpmCalculator />\r\n            <BestdoriChartChecker />\r\n        </Grid>)\r\n}\r\n\r\nexport default ToolsPage\r\n","import React, { useEffect } from \"react\"\r\nimport { observable, reaction } from \"mobx\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\nimport MetaPage from \"./Pages/MetaPage\"\r\nimport TimingPage from \"./Pages/TimingPage\"\r\nimport SettingsPage from \"./Pages/SettingsPage\"\r\nimport MappingPage from \"./Pages/MappingPage\"\r\nimport ToolsPage from \"./Pages/ToolsPage\"\r\n\r\nconst routes = {\r\n  \"#meta\": MetaPage,\r\n  \"#timing\": TimingPage,\r\n  \"#mapping\": MappingPage,\r\n  \"#settings\": SettingsPage,\r\n  \"#tools\": ToolsPage\r\n}\r\nexport type RoutePath = keyof typeof routes\r\n\r\nconst router = observable({\r\n  path: window.location.hash as RoutePath || \"#meta\"\r\n})\r\n\r\nreaction(() => router.path, p => window.location.hash = p)\r\n\r\nexport const useHashRoutes = (): [RoutePath, React.ComponentType<{}>] => {\r\n\r\n  const path = useObserver(() => router.path)\r\n\r\n  const ContentComponent = routes[path]\r\n\r\n  useEffect(() => {\r\n    if (!ContentComponent) {\r\n      router.path = \"#meta\"\r\n    }\r\n  }, [ContentComponent])\r\n\r\n  return [path, ContentComponent || (() => null)]\r\n}\r\n\r\nexport const NavigateTo = (path: RoutePath) => router.path = path\r\n\r\n","import React from \"react\"\r\nimport Fade from \"@material-ui/core/Fade\"\r\nimport Box from \"@material-ui/core/Box\"\r\nimport { useHashRoutes } from \"../routes\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  content: { flexGrow: 1, position: \"relative\", overflow: \"hidden\", },\r\n  wrapping: {\r\n    width: \"100%\", height: \"100%\", overflowX: \"hidden\", overflowY: \"auto\",\r\n    \"-webkit-overflow-scrolling\": \"touch\", position: \"absolute\"\r\n  }\r\n}))\r\n\r\nconst MainContent = () => {\r\n\r\n  const cn = useStyles()\r\n  const [path, Component] = useHashRoutes()\r\n\r\n  return (\r\n    <Fade in key={path}>\r\n      <Box className={cn.content}>\r\n        <Box className={cn.wrapping}>\r\n          <Component />\r\n        </Box>\r\n      </Box>\r\n    </Fade>)\r\n}\r\n\r\n\r\nexport default MainContent","import { useEffect, useState } from \"react\"\r\n\r\nlet statelistener = () => { }\r\n\r\nexport function useGameState() {\r\n\r\n  const [hash, setHash] = useState(\"\")\r\n\r\n  useEffect(() => {\r\n    const listener = () => {\r\n      setHash(window.location.hash)\r\n    }\r\n    statelistener = listener\r\n    window.addEventListener(\"popstate\", listener)\r\n    return () => window.addEventListener(\"popstate\", listener)\r\n  }, [])\r\n\r\n  return hash === \"#game\"\r\n}\r\n\r\nexport function startGame() {\r\n  window.history.pushState({}, \"\", \"#game\")\r\n  statelistener()\r\n}\r\n","import React, { useEffect, useState } from \"react\"\r\nimport Box from \"@material-ui/core/Box\"\r\nimport IconButton from \"@material-ui/core/IconButton\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\nimport Tab from \"@material-ui/core/Tab\"\r\nimport Tabs from \"@material-ui/core/Tabs\"\r\nimport PlayCircleFilledIcon from '@material-ui/icons/PlayCircleFilled'\r\nimport RedoIcon from '@material-ui/icons/Redo'\r\nimport SaveAltIcon from '@material-ui/icons/SaveAlt'\r\nimport UndoIcon from '@material-ui/icons/Undo'\r\nimport DoneOutlineIcon from '@material-ui/icons/DoneOutline'\r\nimport { useHashRoutes, NavigateTo } from \"../routes\"\r\nimport { scope } from \"../../MappingScope/scope\"\r\nimport { addHotkey } from \"../../Common/hooks\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport { userMessage } from \"../../Common/Components/GlobalSnackbar\"\r\nimport { startGame } from \"../../GamePage/gamestate\"\r\nimport i18n from \"../../i18n\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  tabs: { flexGrow: 1, height: \"100%\" }\r\n}))\r\n\r\nconst HeaderTabs = () => {\r\n\r\n  const cn = useStyles()\r\n  const { t } = useTranslation()\r\n  const [path] = useHashRoutes()\r\n\r\n  const tabs = {\r\n    \"#meta\": t(\"Meta\"),\r\n    \"#timing\": t(\"Timing\"),\r\n    \"#mapping\": t(\"Mapping\"),\r\n    \"#tools\": t(\"Tools\"),\r\n    \"#settings\": t(\"Settings\")\r\n  }\r\n\r\n  return (\r\n    <Tabs indicatorColor=\"primary\" className={cn.tabs} value={path in tabs ? path : \"#meta\"} onChange={(e, v) => NavigateTo(v)}>\r\n      {Object.keys(tabs).map(key =>\r\n        <Tab key={key} value={key} label={tabs[key as keyof typeof tabs]} />)}\r\n    </Tabs>)\r\n}\r\n\r\nconst save = (e: { preventDefault: () => void }) => {\r\n  scope.save()\r\n  e.preventDefault()\r\n  userMessage(i18n.t(\"Saved into browser storage\"), \"success\")\r\n}\r\n\r\nconst SaveIcon = () => {\r\n  const [noticed, setNoticed] = useState(0)\r\n  const lastsave = useObserver(() => scope.lastSave)\r\n\r\n  useEffect(() => {\r\n    if (!lastsave || lastsave.getTime() === noticed) return\r\n    const to = setTimeout(() => {\r\n      setNoticed(lastsave.getTime())\r\n    }, 3000)\r\n    return () => clearTimeout(to)\r\n  })\r\n\r\n\r\n  if (!lastsave || lastsave.getTime() === noticed)\r\n    return <SaveAltIcon />\r\n  return <DoneOutlineIcon />\r\n}\r\n\r\nconst HeaderActions = () => {\r\n\r\n  useEffect(() => addHotkey(\"ctrl+z\", scope.map.Undo), [])\r\n  useEffect(() => addHotkey(\"ctrl+shift+z\", scope.map.Redo), [])\r\n  useEffect(() => addHotkey(\"ctrl+s\", save), [])\r\n\r\n  const { t } = useTranslation()\r\n\r\n  const actionlist1 = useObserver(() => [\r\n    {\r\n      children: <UndoIcon />, onClick: scope.map.Undo, disabled: !scope.map.canUndo,\r\n      title: t(\"Hotkey: {{ hotkey }}\", { hotkey: \"ctrl + z\" })\r\n    },\r\n    {\r\n      children: <RedoIcon />, onClick: scope.map.Redo, disabled: !scope.map.canRedo,\r\n      title: t(\"Hotkey: {{ hotkey }}\", { hotkey: \"ctrl + shift + z\" })\r\n    },\r\n    { children: <SaveIcon />, onClick: save, title: t(\"Hotkey: {{ hotkey }}\", { hotkey: \"ctrl + s\" }) },\r\n  ])\r\n  const actionlist2 = [\r\n    { children: <PlayCircleFilledIcon />, onClick: startGame },\r\n  ]\r\n\r\n  return <>\r\n    {actionlist1.map((item, i) =>\r\n      <Box key={i}><IconButton {...item} /></Box>)}\r\n    <Box width={2} />\r\n    {actionlist2.map((item, i) =>\r\n      <Box key={i}><IconButton {...item} /></Box>)}\r\n  </>\r\n}\r\n\r\nconst HeaderBar = () => {\r\n\r\n  return (<>\r\n    <HeaderTabs />\r\n    <HeaderActions />\r\n  </>)\r\n}\r\n\r\nexport default HeaderBar\r\n","import React, { useRef, useEffect } from \"react\"\r\nimport clsx from \"clsx\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\nimport { Music } from \"../../states\"\r\nimport { createAnimLoop } from \"../../../Common/hooks\"\r\nimport { TimeToString } from \"../../../Common/utils\"\r\nimport { scope } from \"../../../MappingScope/scope\"\r\nimport { startAnimation, stopAnimation } from \"../../../Common/animation\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\nimport { autorun } from \"mobx\"\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  flex: { display: \"flex\", alignItems: \"center\" },\r\n  center: { justifyContent: \"center\" },\r\n  bar: { flexGrow: 1, height: \"100%\", position: \"relative\", },\r\n  time: { margin: theme.spacing(0, 2), width: 80, textAlign: \"center\" },\r\n  layer: { position: \"absolute\", width: \"100%\", height: \"100%\" },\r\n  midline: { width: \"100%\", borderBottom: \"1px solid white\" },\r\n  progress: { position: \"absolute\", height: \"100%\", borderLeft: \"4px solid red\" },\r\n  timepoint: {\r\n    position: \"absolute\", height: \"50%\", borderLeft: \"1px solid aquamarine\", transition: \"left 0.2s\"\r\n  }\r\n}))\r\n\r\nconst leftStyle = (time: number) => `${(time / Music.duration) * 100}%`\r\n\r\nconst TimepointLines = () => {\r\n\r\n  const cn = useStyles()\r\n\r\n  return useObserver(() => <>\r\n    {scope.map.timepointlist.map(tp =>\r\n      <div key={tp.id} className={cn.timepoint} style={{ left: leftStyle(tp.time) }} />)}\r\n  </>)\r\n}\r\n\r\nconst ProgressLine = () => {\r\n\r\n  const cn = useStyles()\r\n  const div = useRef<HTMLDivElement>(null)\r\n\r\n  useEffect(() => autorun(() => {\r\n    if (div.current) {\r\n      const current = Music.position() / Music.duration\r\n      if (Music.playing) {\r\n        startAnimation(div.current, \"left\", current * 100, 100, \"%\", Music.remaintime())\r\n      } else {\r\n        stopAnimation(div.current, \"left\", current * 100, \"%\")\r\n      }\r\n    }\r\n  }), [])\r\n\r\n  return <div className={cn.progress} ref={div}></div>\r\n}\r\n\r\nconst PlayTime = () => {\r\n\r\n  const cn = useStyles()\r\n  const div = useRef<HTMLDivElement>(null)\r\n  const lasttime = useRef(-1)\r\n\r\n  useEffect(() => createAnimLoop(() => {\r\n    const time = Music.position()\r\n    if (div.current && lasttime.current !== time) {\r\n      div.current.innerText = TimeToString(time)\r\n      lasttime.current = time\r\n    }\r\n  }), [])\r\n\r\n  return <div className={clsx(cn.flex, cn.center, cn.time)} ref={div} />\r\n}\r\n\r\nconst handleMouse = (e: React.MouseEvent<HTMLDivElement>) => {\r\n  if (!(e.buttons & 3)) return // if not left or right down\r\n  const bar = e.currentTarget\r\n  const x = e.pageX - bar.offsetLeft\r\n  Music.seek(x / bar.clientWidth * Music.duration)\r\n}\r\n\r\nconst handleTouch = (e: React.TouchEvent<HTMLDivElement>) => {\r\n  const bar = e.currentTarget\r\n  const x = e.changedTouches[0].pageX - bar.offsetLeft\r\n  Music.seek(x / bar.clientWidth * Music.duration)\r\n}\r\n\r\nconst handleScroll = (e: React.WheelEvent) => {\r\n  e.stopPropagation()\r\n  const dt = e.deltaY / 100\r\n  const target = Music.position() - dt\r\n  Music.seek(target)\r\n}\r\n\r\nconst ProgressBar = () => {\r\n\r\n  const cn = useStyles()\r\n\r\n  return useObserver(() =>\r\n    <div className={clsx(cn.flex, cn.bar)} style={{ overflow: \"hidden\" }} onWheel={handleScroll}>\r\n      <PlayTime />\r\n      <div className={cn.bar}\r\n        onMouseDown={handleMouse} onMouseMove={handleMouse}\r\n        onTouchStart={handleTouch} onTouchMove={handleTouch}>\r\n        <div className={clsx(cn.flex, cn.layer, cn.center)}>\r\n          <div className={cn.midline}></div>\r\n        </div>\r\n        <div className={cn.layer}>\r\n          <TimepointLines />\r\n        </div>\r\n        <div className={cn.layer}>\r\n          <ProgressLine />\r\n        </div>\r\n      </div>\r\n      <div className={clsx(cn.flex, cn.center, cn.time)}>\r\n        {TimeToString(Music.duration)}\r\n      </div>\r\n    </div>)\r\n}\r\n\r\nexport default ProgressBar","import React, { useEffect } from \"react\"\r\nimport IconButton from \"@material-ui/core/IconButton\"\r\nimport StopIcon from '@material-ui/icons/Stop'\r\nimport PauseIcon from '@material-ui/icons/Pause'\r\nimport PlayArrowIcon from '@material-ui/icons/PlayArrow'\r\nimport Box from \"@material-ui/core/Box\"\r\nimport Slider from \"@material-ui/core/Slider\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport { Music } from \"../../states\"\r\nimport { useObserver } from \"mobx-react-lite\"\r\nimport { addHotkey } from \"../../../Common/hooks\"\r\n\r\nconst Tools = () => {\r\n\r\n  const { t } = useTranslation()\r\n\r\n  useEffect(() => addHotkey(\"space\", Music.toggle), [])\r\n\r\n  return useObserver(() => <>\r\n    <IconButton onClick={Music.toggle} disabled={!Music.loaded}\r\n      title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"space\" })}>\r\n      {Music.playing ?\r\n        <PauseIcon /> : <PlayArrowIcon />}\r\n    </IconButton>\r\n    <IconButton onClick={Music.stop} disabled={!Music.loaded}>\r\n      <StopIcon />\r\n    </IconButton>\r\n    <Box width=\"120px\" ml={3} mr={4}>\r\n      <Slider value={Music.playbackrate} step={null} min={0.15} max={1}\r\n        title={t(\"Playback rate\")} color=\"secondary\"\r\n        onChange={(e, v) => Music.playbackrate = v as number}\r\n        marks={[\r\n          { value: 0.25, label: \"25%\" },\r\n          { value: 0.5, label: \"50%\" },\r\n          { value: 0.75, label: \"75%\" },\r\n          { value: 1, label: \"100%\" },]}\r\n      />\r\n    </Box>\r\n  </>)\r\n}\r\n\r\nexport default Tools","import React from \"react\"\r\nimport ProgressBar from \"./ProgressBar\"\r\nimport Tools from \"./Tools\"\r\n\r\n\r\nconst FooterBar = () => {\r\n\r\n  return (<>\r\n    <ProgressBar />\r\n    <Tools />\r\n  </>)\r\n}\r\n\r\nexport default FooterBar","import React, { useEffect } from \"react\"\r\nimport Box from \"@material-ui/core/Box\"\r\nimport CssBaseline from \"@material-ui/core/CssBaseline\"\r\nimport Fade from \"@material-ui/core/Fade\"\r\nimport { makeStyles, ThemeProvider } from \"@material-ui/core/styles\"\r\nimport BackgroundImage from \"./Components/BackgroundImage\"\r\nimport { theme } from \"./theme\"\r\nimport MainContent from \"./Components/MainContent\"\r\nimport HeaderBar from \"./Components/HeaderBar\"\r\nimport FooterBar from \"./Components/FooterBar\"\r\nimport GlobalSnackbar from \"../Common/Components/GlobalSnackbar\"\r\nimport { Music } from \"./states\"\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  content: { position: \"fixed\", display: \"flex\", flexDirection: \"column\", top: 0, bottom: 0, left: 0, right: 0 },\r\n  bar: { display: \"flex\", alignItems: \"center\", height: 50, width: \"100%\", backgroundColor: \"rgba(128, 128, 128, 0.4)\" },\r\n}))\r\n\r\nconst MappingPage = () => {\r\n\r\n  const cn = useStyles()\r\n\r\n  useEffect(() => () => {\r\n    if (Music.playing)\r\n      Music.toggle()\r\n  }, [])\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <CssBaseline />\r\n      <Fade in>\r\n        <Box className={cn.content}>\r\n          <BackgroundImage />\r\n          <Box className={cn.bar}>\r\n            <HeaderBar />\r\n          </Box>\r\n          <MainContent />\r\n          <Box className={cn.bar}>\r\n            <FooterBar />\r\n          </Box>\r\n        </Box>\r\n      </Fade>\r\n      <GlobalSnackbar />\r\n    </ThemeProvider>)\r\n}\r\n\r\nexport default MappingPage","import React, { useEffect, useRef } from \"react\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\nimport { Game } from \"bangbangboom-game\"\r\nimport { Music, Background } from \"../MappingPage/states\"\r\nimport { userMessage } from \"../Common/Components/GlobalSnackbar\"\r\nimport i18n from \"../i18n\"\r\nimport { scope } from \"../MappingScope/scope\"\r\nimport { toGameContent } from \"../MapFormats/bbbgame\"\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  root: { position: \"fixed\", left: 0, right: 0, top: 0, bottom: 0 },\r\n  canvas: { width: \"100%\", height: \"100%\" }\r\n}))\r\n\r\nconst GamePage = () => {\r\n\r\n  const cn = useStyles()\r\n  const container = useRef<HTMLDivElement>(null)\r\n  const canvas = useRef<HTMLCanvasElement>(null)\r\n\r\n  useEffect(() => {\r\n    if (!canvas.current) return\r\n    if (!Music.musicfile) {\r\n      window.history.back()\r\n      setTimeout(() => {\r\n        userMessage(i18n.t(\"No music selected\"))\r\n      }, 100)\r\n      return\r\n    }\r\n    const musicSrc = URL.createObjectURL(Music.musicfile)\r\n    const game = new Game(canvas.current, {\r\n      judgeOffset: scope.settings.game.judge_offset,\r\n      visualOffset: scope.settings.game.visual_offset,\r\n      speed: scope.settings.game.speed,\r\n      resolution: scope.settings.game.resolution,\r\n      noteScale: scope.settings.game.note_scale,\r\n      barOpacity: scope.settings.game.bar_opaciry,\r\n      backgroundDim: scope.settings.general.background_dim,\r\n      effectVolume: scope.settings.general.effect_volume,\r\n      showSimLine: scope.settings.game.show_sim_line,\r\n      laneEffect: scope.settings.game.lane_effect,\r\n      mirror: scope.settings.game.mirror,\r\n      beatNote: scope.settings.game.beat_note\r\n    }, {\r\n      musicSrc,\r\n      backgroundSrc: Background.src || process.env.PUBLIC_URL + '/assets/mapping/bg_normal.png',\r\n      songName: scope.meta.name,\r\n      skin: process.env.PUBLIC_URL + \"/assets/skins/\" + scope.settings.game.skin,\r\n      sound: process.env.PUBLIC_URL + \"/assets/skins/\" + scope.settings.game.skin,\r\n      mapContent: () => toGameContent(scope.map as any)\r\n    })\r\n    game.ondestroyed = () => {\r\n      window.history.back()\r\n    }\r\n    game.start()\r\n    return () => {\r\n      URL.revokeObjectURL(musicSrc)\r\n    }\r\n  }, [])\r\n\r\n  return <div ref={container} className={cn.root}>\r\n    <canvas ref={canvas} className={cn.canvas} /></div>\r\n}\r\n\r\nexport default GamePage\r\n","import { RawMap, NoteType, Slide } from \"bangbangboom-game/build/Core/RawMap\"\r\nimport { EditMap } from \"../MappingScope/EditMap\"\r\n\r\nexport function toGameContent(map: EditMap): RawMap {\r\n  const notes: NoteType[] = []\r\n  const slides: Slide[] = []\r\n\r\n  const slideIdIndex: { [key: number]: number } = {}\r\n\r\n  for (const [id, s] of map.slides) {\r\n    slideIdIndex[id] = slides.length\r\n    slides.push({ id: slides.length, flickend: s.flickend })\r\n  }\r\n\r\n  for (const [, n] of map.notes) {\r\n    if (n.type === \"single\")\r\n      notes.push({ type: \"single\", time: n.realtimecache, lane: n.lane, onbeat: n.offset % 24 === 0 })\r\n    else if (n.type === \"flick\")\r\n      notes.push({ type: \"flick\", time: n.realtimecache, lane: n.lane })\r\n    else\r\n      notes.push({ type: \"slide\", time: n.realtimecache, lane: n.lane, slideid: slideIdIndex[n.slide] })\r\n  }\r\n\r\n  return { notes, slides }\r\n}\r\n","import React, { useEffect } from 'react'\r\nimport MappingPage from './MappingPage'\r\nimport { useGameState } from './GamePage/gamestate'\r\nimport GamePage from './GamePage'\r\n\r\n\r\nconst App = () => {\r\n\r\n  useEffect(() => {\r\n    document.getElementById(\"loader\")?.remove()\r\n    document.getElementById(\"loader-style\")?.remove()\r\n\r\n    gtag('event', 'timing_complete', {\r\n      'name' : 'app_load',\r\n      'value' : performance.now(),\r\n    })\r\n  }, [])\r\n\r\n  const inGame = useGameState()\r\n\r\n  if (inGame) return <GamePage />\r\n\r\n  return <MappingPage />\r\n}\r\n\r\nexport default App\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n  // [::1] is the IPv6 localhost address.\r\n  window.location.hostname === '[::1]' ||\r\n  // 127.0.0.0/8 are considered localhost for IPv4.\r\n  window.location.hostname.match(\r\n    /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n  )\r\n)\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(\r\n      process.env.PUBLIC_URL,\r\n      window.location.href\r\n    )\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config)\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n            'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          )\r\n        })\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config)\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing\r\n        if (installingWorker == null) {\r\n          return\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              )\r\n\r\n              window.addEventListener(\"beforeunload\", () => {\r\n                installingWorker.postMessage({ type: 'SKIP_WAITING' })\r\n              })\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration)\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.')\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration)\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error)\r\n    })\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' }\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type')\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload()\r\n          })\r\n        })\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config)\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      )\r\n    })\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister()\r\n    })\r\n  }\r\n}\r\n","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport './index.css'\r\nimport \"./i18n\"\r\nimport App from './App'\r\nimport * as serviceWorker from './serviceWorker'\r\nimport { userMessage } from './Common/Components/GlobalSnackbar'\r\nimport i18n from './i18n'\r\nimport { scope } from './MappingScope/scope'\r\n\r\nwindow.addEventListener(\"error\", ev => {\r\n  gtag('event', 'exception', {\r\n    'description': ev.error,\r\n    'fatal': true\r\n  })\r\n})\r\n\r\nReactDOM.render(<App />, document.getElementById('root'))\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.register({\r\n  onUpdate() {\r\n    userMessage(i18n.t(\"An update is available. Please close ALL tabs of this site or press Ctrl + F5 reload.\"), \"info\")\r\n    scope.update = true\r\n  }\r\n})\r\n"],"sourceRoot":""}